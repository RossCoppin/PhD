---
title: Using numerical modelling to investigate temperature and wave exposure as drivers
  of macroalgal morphological characteristics
author: "R. Coppin, C. Rautenbach, T. Ponton and A.J Smit"
abstract: "**Abstract**: Macroalgae morphological characteristics are determined by a combination of environmental factors with wave exposure and temperature being identified as the main drivers of morphological adaptation. Macroalgae have shown to exhibit different responses to different magnitudes of exposure, such as reduction in overall size and strength increasing traits. In terms of temperature, warmer environments have been shown to reduce the overall size of resident and transplanted species. However, none of the past studies have identified specific wave and temperature metrics responsible for the morphological adaptation macroalgae exhibit. Past research has often used simple or two dimensional models of wave exposure which does not take into account important aspects of the nearshore environment such as wave breaking, refraction and diffraction. Furthermore, past studies have often used satellite as sources for temperature data which has been shown to have large bias when measuring the nearshore environment. This study used *in situ* temperature data and wave power calculated from a 3D-numerical model to identify specific temperature and wave metrics responsible for morphological adaptation.  The results identify wave exposure as the main driver of morphological adaptation while identifying specific wave metrics. Furthermore, the results show differences in wave metrics between species; and between deep and shallow populations."
fontsize: 10pt
output:
  word_document:
    reference_docx: frontiers_template.docx
  pdf_document: 
    fig_caption: yes
geometry: margin=1in
papersize: A4
tables: yes
bibliography: references.bib
---

```{r include=FALSE}
knitr::opts_chunk$set(cache=FALSE)
knitr::opts_chunk$set(fig.align = "center")
```

# Introduction

Kelps are a group of large seaweeds of the order Laminariales (Ochrophyta), which despite their relatively low taxonomic diversity of species in genera [@Bolton2010], form the basis of one of the most productive ecosystems globally [@Mann1973].  Kelps generally have a dependence on cool-temperate and arctic seawater temperatures [@Bolton2010; @Mohring2014-bk; @Cavanaugh2011-ib; @Dayton1985], and dominate the nearshore biomass within the rocky shallow coasts in both hemispheres [@Steneck2002]. Their size and complex morphology provide a heterogeneous habitat structure [@Steneck2002] that accommodate a multitude of turf and sub-canopy seaweed species, and diverse assemblages of sessile and mobile invertebrates and vertebrates [@Mann1973; @Steneck2002]; each depending on a wide suite of ecological services provided by kelp forests [@Gaines1987-bg; @Paul1993-bm; @Levin1994-qf; @Willis2003-xo; @anderson1997; @Dayton1985]. Wave exposure and temperature are regarded as important environmental drivers of kelp forests, and play a role in the distribution [@Gorman2013-nj], abundance [@Cavanaugh2011-ib; @Dayton1998-xw], diversity [@Wing2007-tv; @Wernberg2008], composition [@Leliaert2000a; @Dayton1985; @Norderhaug2012-ks; @Harley2012], growth [@Cousens1982-ck] and productivity [@Pedersen2012-vr; @Dayton1998-xw; @Krumhansl2012] of kelps. 

Given kelps are cool-temperate organisms which are vulnerable to dislodgement under high wave exposure scenarios, changes in ocean temperature and an increase in storm frequency and magnitude pose the biggest direct threats to their survival. Warmer temperatures reduces the resilience of kelp individuals to storm disturbance [@wernberg2010], causes fragmentation through weakening tissues [@Simonson2015] and reduces growth and productivity [@bearham2013; @gerard1997; @gao2013; @zimmerman1986]; while storms and high wave energy dislodge and break kelps [@byrnes2011; @graham2004; @seymour1989]. Despite these threats and disturbances kelps persist across a broad range of environments which is largely due to their morphological plasticity [@FowlerWalker2006; @wernberg2010]. A study by @Wernberg2003-mp investigated the morphology of *E. radiata* in order to quantify the morphological variation and whether it was dependent on spatial differences along the Australasian coast. They found no correlation between spatial distance and morphological similarity, and rather the morphology of kelps was representative of multiple environmental forcings on different morphological characters at different spatial scales [@Wernberg2003-mp]. Due to the complex effects of environmental drivers on kelp morphology, one can also expect differences in morphology between deep and shallow water populations of the same species. Deep and shallow water environments may differ in abiotic processes such as the degree of water column mixing [@Smit2013a], solar heating [@Dellatorre2012; @Dunne2001] and effects of wave dampening [@Kobayashi1993-os; Mia2013; @Dubi1995]. 

Although multiple environmental factors play a role in kelp morphological adaptation, wave exposure and temperature have been identified as the main drivers across various kelp species [@bekkby2014; @Wernberg2005c; @Denny2002; @Hurd2000; @FowlerWalker2005; @Thomsen2004; @mabin2013]. For example, a study by @Serisawa2002-dc compared the morphology of *Ecklonia cava* Kjellman growing at warmer and cooler sites, and showed wrinkling of the blade and reduced size to be a characteristic of higher temperature ranges. Warmer temperature effects important kelp physiological processes such as photosynthesis and respiration, which influences growth and productivity and ultimately leads to a reduction in size [@bearham2013; @gerard1997; @gao2013; @zimmerman1986]. Past research has shown that in highly wave exposed areas kelp morphology tends to take on characteristics which reduce drag, increase strength and increase flexibility [@Denny2002; @Hurd2000; @FowlerWalker2005; @Thomsen2004]. For example, a study by @Wernberg2005c examined the consistency of wave exposure as a driver of *Ecklonia radiata*  (C. Agardh) J. Agardh. across a broad geographic range, and showed trends towards drag-reducing (small size, narrow laterals and blades, low spinosity) and increased strength (large holdfast, thick stipe and thick blades and lamina) at high wave exposure sites.

Measures of wave exposure in ecological studies often incorporate integrative measures of hydrodynamic conditions at a particular site which are based on cartographical models of exposure. Cartographical models of wave exposure are 'fetch-based-models' which measure the length of open water associated with a particular site in a straight line, and are regarded as simple measures of wave exposure. Advances in numerical modelling based on physical/linear wave theory incorporate more complexity (wind forcing, wave-wave interactions, wave breaking, diffraction and variation in wave direction) into the models and allow for a quantitative, reproducible approach for characterising the hydrodynamic environment. Although @mabin2013 investigated kelp morphological characteristics using a 2D WAM model, currently no studies investigating macroalgal morphological characteristics in relation to the wave environment have incorporated 3D spectral numerical modelling. Furthermore no current studies have identified specific wave metrics that drive kelp morphological characteristics, which the current work will aim to achieve. Other considerations such as possible differences in morphology between sub-canopy and canopy species, and shallow and deep water kelp populations have not been considered using advanced numerical and statistical tools. 

The kelps *Laminaria pallida* and *Ecklonia maxima* (Osbeck) Papenfuss are important habitat forming seaweeds that exist around the coast of South Africa and offer a unique opportunity to investigate the drivers of macroalgal morphological characteristics between canopy and sub-canopy species, as well as between deep and shallow water environments. Although both these species exist in the sub-tidal, *L. pallida* dominates deeper waters while *E. maxima* forms dense surface canopies in the sub-tidal to shallower waters. Therefore, *E. maxima* may be exposed to variations in wind driven surface waves, swell waves and temperature; while *L. pallida* is exposed to variations in swell waves and temperature. @Molloy1996-la investigated the effect of depth and wave exposure on *L. pallida* at different depths and wave exposure and showed that depth had a greater effect than wave exposure when considering all the morphological characteristics (wave exposure alters with depth); when considering individual characteristics, however, wave exposure had the most significant effect on blade thickness. Another study by @Rothman2017-pn investigated the changes in morphology in shallow populations of *L. pallida* and *E. maxima* along the South African coastline and into Namibia; *E. maxima* exhibited no morphological changes along the coast but the stipes of *L. pallida* become increasingly hollow further north along the coastline. The authors suggested that turbidity in relation to light attenuation was the environmental driver responsible for this change. 

The aim of this study is, therefore, to understand how temperature and wave exposure can influence the morphology of sub-canopy and canopy kelps, as well as between deep and shallow populations of the same species. The current study will also aim to identify specific temperature and wave metrics which drive kelp morphological characteristics.  This will be achieved by initially understanding the variation in temperature and waves using an advanced numerical model. The numerical model will then be used as a basis for investigating the consequences for morphological characteristics of *E. maxima* and *L. pallida* using advanced statistical tools. 

# Materials and methods
## Site selection

Sites were chosen to represent an array of temperature and wave gradients, as indicated in figure \ref{fig:map study sites}. St. Helena Bay and Betty's Bay constituted the north western and south eastern boundary sites, respectively. These sites are roughly 300 km apart, lie within separate marine provinces, and span across the majority of the south-west coast, in varying thermal and wave energy regimes. The region is dominated by kelp communities that persist in contrasting abiotic environments. The west coast region has been termed as cool-temperate, which is defined as a region where mean monthly temperatures are always above 10°C and always below 15°C [@Smit2013a]. East of Cape Point marks the beginning of an overlap or transition area, which is also referred to as the Benguela-Agulhas Transition Zone [@Smit2013a]. The Agulhas Marine Province is characterised by a wide temperature range of up to 7°C difference between mean monthly temperatures between summer and winter and is classified as warm-temperate [@Smit2013a]. 

```{r map study sites, echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, fig.cap="\\label{fig:map study sites}Map of the study area and sampling sites. The red dot indicates the position of Cape Town for sake of reference."}

library(png)
library(grid)
library(gridExtra)

map <- readPNG("figures/sa_map.png")
grid.raster(map)
```

The annual and seasonal patterns in both wind influence the thermal regime around the coastline by inducing upwelling. Upwelling brings deep, cool nutrient rich water to coastal areas which induces a decrease in temperature [@Field1980a; @Andrews1980; @Gill1974-nt; @Cram1970-jw; @Rouault2010-gi; @Blanke2002]. The wind speed and wind direction help drive upwelling in summer on the western side of the Cape peninsula, where southerly winds blow parallel to the coast and trigger upwelling events [@Field1980a; @Rouault2010-gi]. This is not the case for False Bay which is shielded from the dominating wind and swell the Cape Peninsula is subject to, with the exception being the winter months where upwelling becomes more favourable for the region due to the change in swell and wind direction, causing lower temperatures to dominate during this time [@Rouault2010-gi; @Andrews1980]. Due to the Cape Peninsula temperate latitude, winter months bring an increased frequency of frontal depressions that originate from the Southern Ocean [@Reason2006]. These low pressures are joined by large swells with increased wave energy. The nearshore environment, with the accompanied biota, therefore experiences high wave energy events, with increased frequency in winter [@Veitch2019]. The large peninsula acts as an obstruction for large south westerly swells, providing decreased wave energy along the west side of False Bay [@Shipley1964]. Conversely, the west coast of Cape Point is battered by these large swells. Multiple sites, therefore, exist where kelps grow in diverse temperature and wave energy climates, in close proximity. The topography and elevation along the Cape Peninsula channel and shield winds along False Bay. This is however absent in winter, where strong northerly winds are prevalent from St. Helena Bay to Betty's Bay [@Field1980a; @Jury1985-nr; @Andrews1980; @Jury1980-ov]. 

## Abiotic environment

In order to compare abiotic variables for sites around the coast, large historical databases for temperature, wave energy and wind were accessed. 

### Temperature

Shallow water temperatures were sourced from The South African Coastal Temperature Network (SACTN) website (https://github.com/ajsmit/SACTN). In terms of nearshore temperature, *in situ* data are preferred over satellite SST, which have shown to exhibit large biases [@Smit2013a]. Linear interpolated SST were calculated for sites where *in situ* recorders were absent. These data were used to group sites into 'Cool temperate' and 'Warm temperate' categorisations to investigate the possible effect of thermal regime on kelp morphological characteristics. 

### Wave environment

Wave model variable data formed part of the South African Coastal Vulnerability Assessment, presented to the Department of Environmental Affairs (DEA) and produced by the Council for Scientific and Industrial Research (CSIR) [@Rautenbach2015a]. The South African wave climate was modeled via 20 spectral numerical wave models that simulated the offshore wave climate to the nearshore. The boundary conditions of these models were obtained by using the NOAA Wave Watch III (WWIII) model output, distributed via the National Centers for Environmental Prediction (NCEP) product (Office of the Director 2000; Environmental Modeling Center / Marine Modeling Branch 2005). The particular hindcast product utilised during the DEA-CSIR study spans 1994-2013 at a 3-hour resolution. These data were then used to model swell propagation into the coastal models while wind waves (seas) were generated via stationary computations in the Simulating Waves in the Nearshore SWAN model [@Booij1997-nx]. The assumption of stationary computations are acceptable as the model domains were small enough so the temporal variation of the model boundary were slower than the time it takes for that boundary condition to propagate to the coast. SWAN allows one to extract wave variables from specific gridded locations in the nearshore. For False Bay, a resolution of 200 meters was modelled and output produced at both the 7 meter and 15 meter isobaths. A 200 meter resolution was used as the False Bay computational grid was nested within a larger grid (1 kilometer resolution). This allowed for a computational effective wave resolution of increasing resolution, from the NCEP, low resolution output to nested, high resolution coastal output. For Table Bay and east of Cape Hangklip the resolution was 500 meters and also had output at the 7 meters and 15 meter isobaths. These contour outputs were chosen in the original study by the CSIR as most engineering run-up calculations require wave parameter information at these contour depths and were the main focus of the original study. For this study the 7 meter contours were used. These data were then used to calculate over all wave power (kW/m) as this was considered the best measure of overall wave exposure. Annual wave power was plotted and categorised into different wave exposure categories which ranged from fully sheltered to extremely exposed.

### Collection of kelp morphological characteristics

The morphological characteristics of both species are presented in figure \ref{fig:schematic}. *Laminaria pallida* is characterised by a single smooth blade which is divided longitudinally into sections, and develops from a single meristematic region located at the junction between the blade and the stipe [@Dyer2018-rv]. This species has a solid stipe along the south-west coast but develops a hollow stipe along the west coast northward and into Namibia [@Rothman2017-pn]. *Ecklonia maxima* consists of a single primary blade which develops above a gas-filled float and a hollow stipe below. Secondary blades are produced laterally from the primary blade from several meristematic regions along the margins of the primary blade [@Dyer2018-rv]. Both species are held to the substrate by finger-like haptera, collectively known as the holdfast. 

```{r schematic, echo=FALSE, fig.cap='\\label{fig:schematic}Schematic of *L. pallida* and *E. maxima* morphology [@Dyer2018-rv].', fig.height=6, fig.width=6}

schematic <- readPNG("figures/kelp_diagram.png")
grid.raster(schematic)
```

Morphological measurements of *L. pallida* and *E. maxima* were collected at 18 sites along the Western Cape coast of South Africa (Fig. 1) between October 2014 and April 2015. In each instance only the thirteen largest individuals were sampled to ensure that only mature and fully grown sporophytes were measured. In instances where one of the species was not present a site, the nearest population of the missing species was sampled. Because the macroalgae differ in morphological features, species-specific morphological characteristics were included and are presented in Tables 1 and 2. Between February 2017 and November 2018, morphological measurements for *E. maxima* individuals in shallow water (<1m) at seven sites along the Western Cape coast of South Africa were also collected. The same morphological characteristic measurements were taken as for the deeper *E. maxima*, and this allowed comparison between morphological characteristics between deep and shallow individuals within sites. Measurements were not collected for *L. pallida* in the shallow depths, as this species is largely absent from the shallow in this portion of the South African coastline. 

## Statistical analyses 

Summary statistics were calculated for each site and regions for each of the environmental variables considered in this study, and are presented in Table 3. The summary statistics calculated for temperature, waves and wind variables were minimum, maximum, mean, range and standard deviation for annual timescales. In addition, annual median wave and wind direction were also calculated. The median was calculated for wind and wave direction, as issues arise when calculating the mean and standard deviation for compass metrics. Dot and whisker plots were used to present the summary statistics for both temperature and wave variables. Summary statistics for wind was not plotted and instead are discussed, as the data was course relative to the other environmental variables considered in this study. 

Morphological characteristics in relation to temperature and wave exposure were investigated using non-parametric statistical methods. Morphological characteristics were categorised according to temperature regime and wave exposure category for each species and population of kelp in this study. Significant differences between temperature regimes and across wave exposure categories were tested with wilcox tests and kruskal tests respectively, and notched boxplots allowed comparison between individual categories of wave exposure. In order to investigate specific drivers of morphological characteristics a distance-based redundancy analysis was performed using the *rda* function in the *vegan* software package [@Oksanen2015-vj] in R (R Core Team, 2019). The abiotic data covered all study sites for both species of kelp. Both morphology and abiotic data (temperature, waves and wind) were standardised using the *decostand* function in the *vegan* software package; morphology data were used as response variables and the abiotic data as explanatory variables. To determine the explanatory variables that best describe patterns in the response data, a full RDA was performed using a complete set of explanatory variables. Forward selection was then used to reduce the number of explanatory variables, as well as prevent the inflation of overall type I error. To further improve the model, pairwise coefficients and Variance Inflation Factor (VIF) were calculated to identify variables with high multicollinearity. The computation of the parsimonious RDA was followed by permutation tests of the adjusted *R*^2^ to assess significance of constraints. 

# Results

```{r software packages and intial data prep, message=TRUE, warning=FALSE, include=FALSE, echo=FALSE}

library(tidyverse)
library(ggpubr)
library(gridExtra)
library(ggplot2)
library(ggord)
library(vegan)

# Ecklonia
eck_data <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop")
eck_data$site <- as.character(eck_data$site)

# Laminaria
lam_data <- read.csv("data/morph_data/lam_morph_data.csv", sep = ";") %>%
  # NB: This may also not be an appropriate change
  # Not using Rocky Bank in this study
  filter(site != "Rocky Bank")
lam_data$site <- as.character(lam_data$site)

meta_all <- read.csv("metadata/site_meta_complete.csv", sep = ";")

```

## Abiotic environment
### Temperature

The mean annual coastal water temperature for the study sites located on the western side of the peninsula ranged from 14.5 ± 0.9 ℃ (mean ± SD) at St. Helena Bay, the most northern site on the western side of the peninsula, to 14.6 ± 0.3 ℃ at Olifantsbos, the most southern site on the western side of the peninsula (see figure \ref{fig:Temperature variables plot}A). For sites located on the eastern side of the peninsula (within False Bay), the annual mean coastal water temperatures ranged from 15.5 ± 0.9 ℃ at Buffelsbaai to 15.0 ± 0.9 ℃ at Betty’s Bay, the most eastern site on the coastline in this study (see figure \ref{fig:Temperature variables plot}A). Oudekraal had the lowest annual mean coastal water temperature of 12.3 ± 0.9. Annual maximum coastal temperatures for study sites located on the western side of the peninsula ranged from 16.3 ℃ at St. Helena Bay to 15.1 ℃ at Olifantsbos. For sites located east of the peninsula, annual maximum coastal water temperatures ranged from 16 ℃ at Buffelsbaai to 16.5 ℃ at Betty’s Bay. Amongst all sites, Kalk Bay had the highest annual maximum temperature of 19 ℃. Annual minimum coastal water temperatures for the study sites on the western side of the peninsula ranged from 12.9 ℃ at St. Helena Bay to 14.1 ℃ at Olifantsbos, and on the western side of the peninsula ranged from 15.0 ℃ at Buffelsbaai to 13.6 ℃ at Betty’s Bay.  The annual range in temperature on the western side on the peninsula was 3.4 at St. Helena Bay to 0.9 at Olifantsbos, and on the eastern side on of the peninsula was 1.0 at Buffelsbaai to 2.9 at Betty’s Bay. 

```{r Temperature data prep, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}
## Data wrangling and preparation
## Preparing data
# Complete lon/lats

# NB: (RWS) I have removed Roman Rock as this has less than a year of temperature data

# The SACTN monthly data
load("data/temp_data/SACTNmonthly_v4.1.Rdata")

# The missing site temperatures
load("data/temp_data/interp_sites.Rdata")

# The patched Roman Rock temperatures
load("data/temp_data/rr_patch.Rdata")

## Subset temperatures for collection sites
temps <- SACTNmonthly_v4.1 %>% 
  filter(site %in% eck_data$site | site %in% lam_data$site) %>% 
  select(site, date, temp) %>% 
  rbind(., interp_sites) %>% 
  filter(site!= "Roman Rock") %>% 
  rbind(., rr_patch)

## Temperature analyses
# Up next we need to calculate the relevant temperature statistics for each site. These are: #mean, range, and sd, for Annual climatology.
# Annual clims
temp_ann <- temps %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>%
  group_by(site, date) %>% 
  summarise(mean_temp = mean(temp, na.rm = T),
            min_temp = min(temp, na.rm = T),
            max_temp = max(temp, na.rm = T),
            range_temp = range(temp, na.rm = T)[2]-range(temp, na.rm = T)[1],
            sd_temp = sd(temp, na.rm = T)) %>% 
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean(., na.rm = T))) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything())
```

```{r Temperature variable processing, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}
### Plots for temperature variables 
positions_temp <- c("Betty's Bay", "Roman Rock","Kalk Bay", "A-Frame", "Miller's Point", "Baboon Rock", "Batsata Rock","Bordjies Deep","Buffelsbaai","Buffelsbaai South","Olifantsbos","Scarborough", "Soetwater", "Kommetjie","Hout Bay","Oudekraal","Sea Point","St Helena Bay")

# Annual temp
temp_plot <- ggplot(data = temp_ann, aes(x = site, y = mean_temp)) +
  geom_point(show.legend = FALSE) + 
  scale_x_discrete(limits = positions_temp) + 
  ylim(9, 21) + 
  geom_errorbar(aes(x = site, ymin = mean_temp - sd_temp, ymax = mean_temp + sd_temp)) + 
  geom_point(data = temp_ann, aes(x = site, y = max_temp), show.legend = FALSE, shape = 17, size =2) + 
  geom_point(data = temp_ann, aes(x = site, y = min_temp), show.legend = FALSE, shape = 6, size =2) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  coord_flip() + 
  theme_bw() + 
  theme(axis.text.y=element_text(vjust=0.3)) 

temp_ann_meta <- merge(meta_all, temp_ann, by = "site")
temp_ann_meta$site <- as.character(temp_ann_meta$site)

temp_boxplot <- ggplot(data = temp_ann_meta, aes(x = region, y = mean_temp, fill  = region)) + 
  geom_boxplot(show.legend = FALSE, width = 0.5) + 
  stat_compare_means(label.x = 2.5, label.y = 12.5, label = "p.format") +
  xlab("") + 
  ylab("") +
  coord_flip() + 
  theme_bw() +
  scale_fill_grey(start = 0.4, end = 0.8) + 
  theme(axis.text.y=element_text(vjust=0.3)) 
```

```{r Temperature variables plot, echo=FALSE, warning=FALSE, eval=TRUE,fig.height=5,fig.width=8, fig.cap='\\label{fig:Temperature variables plot}Temperature variables at the collection sites around the Cape Peninsula are represented in plot A. Temperature variables include minimum represented by inverted triangles, mean represented by black dots, maximum by black triangles, and whiskers standard deviation. Summary of temperature data for sites grouped by region are represented in plot B.'}
ggarrange(temp_plot, temp_boxplot, common.legend = FALSE, ncol = 2, nrow = 1, labels = c("AUTO"), align = c("hv"), legend = FALSE)
```

In general, the mean temperature increases for sites located within False Bay with less variation around the mean temperature compared to sites on the western side of the peninsula(\ref{fig:Temperature variables plot}A). This is verified by \ref{fig:Temperature variables plot}B, which shows a significantly lower (p < 0.05, figure \ref{fig:Temperature variables plot}B) mean temperature and less variation in temperature for sites located on the western side of the peninsula compared to sites on the eastern side. 

### Wave environment

Our data show the western side of the peninsula experiences higher significant wave heights and variation in wave heights compared to the eastern side of the peninsula on both an annual scale (see figure \ref{fig:wave variable plot}). Mean significant wave height ranged from 0.5 ± 0.2 m (mean ± SD) at St. Helena Bay to 2.3  ± 0.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side of the peninsula it ranged from 0.9 ± 0.4 m at Buffelsbaai to 1.9 ± 0.6 m at Betty’s Bay (see figure \ref{fig:wave variable plot}A). The maximum significant wave height ranged from 1.4 m at St. Helena Bay to 4.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side ranged from 2.6 m at Buffelsbaai to 4.2 m at Betty’s Bay. Mean peak period for sites on the western side of the peninsula ranged from 10.3 ± 3.5 s at St. Helena Bay to 11.0 ± 2.0 s at Olifantsbos, and ranged from 10.6 ± 3.0 s at Buffelsbaai to 10.8 ± 2.2 s at Betty’s Bay (see figure \ref{fig:wave variable plot}B). The data shows no trend in mean peak period for the coastline. These data show that the western side of the peninsula has a lower variation (SD) compared to the eastern side of the peninsula, with Miller’s point showing the highest variation across timescales. Maximum peak period ranged from 18.9 s at St. Helena Bay to 18.4 s at Olifantsbos for the western side of the peninsula, and ranged from 18.0 s at Buffelsbaai to 18.0 s at Betty’s Bay on the eastern side of the peninsula. When wave variables were grouped by region significant differences were found for both mean significant swell height and mean peak period. The western region The western region experiences a significantly higher mean significant swell height (p < 0.05; see figure \ref{fig:wave variable plot}C) and mean peak period (p < 0.05; see figure \ref{fig:wave variable plot}D).

```{r wave data prep, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE, eval=TRUE}
## Data wrangling and preparation
# Wave data 
# Load the loading functions
source("func/load.wave.R")
# Then load the data
fb_model <- load.model("data/wave_data/FB")
tb_model <- load.model("data/wave_data/TB")
he_model <- load.model("data/wave_data/HE")
sh_model <- load.model("data/wave_data/SH")

# Combine
wave_model <- rbind(fb_model, tb_model, he_model, sh_model)
rm(fb_model, tb_model)

# The site list key
wave_sites <- read_csv2("metadata/site_meta_complete.csv") %>% 
  select(site, wave_7, wave_15)
# Annual clims
wave_ann <- wave_model %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  filter(site != "FB025") %>% # FB_25 has issues with 'hs' and 'tp'
  group_by(site, date) %>% 
  summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T) %>%
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything()) %>% 
  group_by(site) %>% 
  left_join(wave_sites, by = c("site" = "wave_7")) %>% 
  ungroup() %>% 
  select(-site, wave_15) %>%
  rename(site = site.y) %>% 
  select(site, everything()) %>% 
  na.omit()

#remove useless coloumns
wave_ann <- wave_ann[-c(9,15,20,22), -c(2,23)]

wave_ann <- wave_ann %>% 
  select(site, hs_mean, hs_min, hs_max, hs_sd, tp_mean, tp_min, tp_max, tp_sd) 

# Subset directions out
dirs <- subset(wave_model, select = c(1, 2, 5, 6))

# Annual
dirs_ann <- dirs %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  group_by(site, date) %>% 
  summarise(dir_min = min(dir, na.rm = T),
            dir_max = max(dir, na.rm = T),
            dir_range = range(dir, na.rm = T)[2]-range(dir, na.rm = T)[1],
            dir_median = median(dir, na.rm = T), 
            dirw_min = min(dirw, na.rm = T),
            dirw_max = max(dirw, na.rm = T),
            dirw_range = range(dirw, na.rm = T)[2]-range(dirw, na.rm = T)[1],
            dirw_median = median(dirw, na.rm = T)) %>% 
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean(., na.rm = T))) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything())

# combine all direction metrics
dirs_ann <- dirs_ann %>% 
  group_by(site) %>% 
  gather(key = statistic, value = value, 
         3:4) %>% 
  mutate(clim_stat = paste(date, statistic, sep = "_")) %>% 
  select(-date, -statistic) %>% 
  spread(key = clim_stat, value = value) %>% 
  left_join(wave_sites, by = c("site" = "wave_7")) %>% 
  ungroup() %>% 
  select(-site, wave_15) %>%
  rename(site = site.y) %>% 
  select(site, everything()) %>% 
  na.omit()

# Combine
#these will be used later for the redudancy analysis
clim <- merge(wave_ann, dirs_ann, by = "site")  
clim <- clim[ , -c(12,13,16,17,18)]
#remove duplicate sites
clim <- clim[-c(1,6,7,8,12,18,20), ]

# merge temp and wave data to create environmental data-frame
abio_clim <- merge(temp_ann, clim, by = "site")
```

```{r wave variable processing, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}
### Plots for wave variables
#Annual wave plots
#combine with meta data for easier plotting
wave_ann_meta <- merge(meta_all, wave_ann, by = "site")
wave_ann_meta$site <- as.character(wave_ann_meta$site)#make character to ensure no issues arise for site and region names

positions_wave <- c("Betty's Bay", "Roman Rock","Kalk Bay", "A-Frame", "Millers Point", "Baboon Rock",  "Batsata Rock","Bordjies Deep","Buffelsbaai","Buffelsbaai South","Olifantsbos","Scarborough", "Soetwater", "Kommetjie","Hout Bay","Oudekraal","Sea Point","St Helena Bay")
#cols <- c("Betty's Bay" = "red", "Roman Rock"= "red","Kalk Bay"= "red", "A-Frame"= "red", "Miller's Point"= "red", "Baboon #Rock"= "red",  "Batsata Rock"= "red","Bordjies Deep"= "red","Buffelsbaai"= "red","Buffelsbaai South"= "red","Olifantsbos"= #"blue","Scarborough"= "blue", "Soetwater"= "blue", "Kommetjie"= "blue","Hout Bay"= "blue","Oudekraal"= "blue","Sea Point"= #"blue","St Helena Bay"= "blue") #  scale_colour_manual(values = cols) #script to assign colours to specific sites
 
wave_plot_1 <- ggplot(data = abio_clim, aes(x = site, y = hs_mean)) +
  geom_point(show.legend = FALSE, shape = 17, size = 2) + 
  scale_x_discrete(limits = positions_wave) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = hs_mean - hs_sd, ymax = hs_mean + hs_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  coord_flip() + 
  theme_bw() + 
  theme(axis.text.y=element_text(vjust=0.3)) 

wave_plot_2 <- ggplot(data = abio_clim, aes(x = site, y = tp_mean)) +
  geom_point(show.legend = FALSE, shape = 16, size = 2) + 
  scale_x_discrete(limits = positions_wave) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = tp_mean - tp_sd, ymax = tp_mean + tp_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  coord_flip() +
  theme_bw() + 
  theme(axis.text.y=element_text(vjust=0.3)) 

wave_boxplot_1 <- ggplot(data = wave_ann_meta, aes(x = region, y = hs_mean, fill  = region)) + 
  geom_boxplot(show.legend = FALSE) + 
  stat_compare_means(label.y =0.6 ,label.x = 2.5, label = "p.format") + 
  xlab("") + 
  ylab("") + 
  coord_flip() + 
  theme_bw() +
  scale_fill_grey(start = 0.4, end = 0.8) + 
  theme(axis.text.y=element_text(vjust=0.3)) 

wave_boxplot_2 <- ggplot(data = wave_ann_meta, aes(x = region, y = tp_mean, fill  = region)) + 
  geom_boxplot(show.legend = FALSE) + 
  stat_compare_means(label.y = 8.2, label.x = 2.5, label = "p.format") + 
  xlab("") + 
  ylab("") +
  ylim(8,12) + 
  coord_flip() + 
  theme_bw() +
  scale_fill_grey(start = 0.4, end = 0.8) + 
  theme(axis.text.y=element_text(vjust=0.3)) 

```

```{r wave variable plot, warning = FALSE, echo=FALSE, message = FALSE, include= TRUE, eval=TRUE,fig.height=7,fig.width=8, fig.cap='\\label{fig:wave variable plot}Mean significant wave height and mean significant peak period across sites and by region. Mean significant wave height across sites is presented in plot A and is represented by solid triangles and standard deviation by the whiskers. Differences in mean significant wave height between regions are presented in plot B. Mean significant peak period across sites is presented in plot C and is represented by solid dots and standard deviation by whiskers. Differences in mean significant peak period between regions are presented in plot D.'}
ggarrange(wave_plot_1,wave_boxplot_1, wave_plot_2, wave_boxplot_2, common.legend = FALSE, labels = c("A", "B", "C", "D"), align = "hv")
```

```{r wave rose, echo=FALSE, warning = FALSE, eval= TRUE, fig.align="center",fig.cap='\\label{fig:wave rose}The total and seasonal wave roses of the directional wave buoy just offshore from Cape Town is given form the years 2000 till end 2017 (the period for which directional wave spectra was available). Annual (top left), Austral summer (top right) and Austral winter (bottom) respectively'}

library(png)
library(grid)
library(gridExtra)

img_wave_rose <- readPNG("figures/wave_rose.png")
grid.raster(img_wave_rose)

```

Data for median wave direction showed no trend across timescales; however the variation (SD) in wave direction is lower on the western side of the peninsula compared to the eastern side both annually and for winter. Summer data were the exception and showed lower variation for the eastern side of the peninsula (see figure \ref{fig:wave rose}).

```{r wave power map, echo=FALSE, eval= TRUE, fig.cap='\\label{fig:wave power map}The total coastal wave exposure of the Cape Peninsula is given in terms of wave energy (kW per meter wave crest length. Annual total (A), summer (B), winter (C), spring (D) and autumn (D).'}

library(png)
library(grid)
library(gridExtra)

wp_1 <- rasterGrob(as.raster(readPNG("figures/CapePen_Total.PNG")), interpolate = FALSE)
wp_2 <- rasterGrob(as.raster(readPNG("figures/CapePen_Summer.PNG")), interpolate = FALSE)
wp_3 <- rasterGrob(as.raster(readPNG("figures/CapePen_Winter.PNG")), interpolate = FALSE)
wp_4 <- rasterGrob(as.raster(readPNG("figures/CapePen_Spring.PNG")), interpolate = FALSE)
wp_5 <- rasterGrob(as.raster(readPNG("figures/CapePen_Autumn.PNG")), interpolate = FALSE)
wp_6 <- rasterGrob(as.raster(readPNG("figures/CapePen_Legend.PNG")), interpolate = FALSE)
grid.arrange(wp_1, wp_2, wp_3, wp_4, wp_5, wp_6, ncol = 3, nrow = 2)

#wave_power_map <- readPNG("figures/wave_power_all_labels.png")
#grid.raster(wave_power_map)

```

In Figure \ref{fig:wave power map} the total coastal wave exposure of the Cape Peninsula is given in terms of wave energy (kW per meter wave crest length). The classification from fully sheltered to extremely exposed is based on the total wave energy upper and lower limits. The western periphery of the Cape peninsula is almost continuously exposed to high wave exposures while the eastern periphery of the peninsula (western coastline of False Bay) revealed sheltered wave exposures (see figure \ref{fig:wave power map}). There the marked seasonality, with higher energy waves during winter, may be clearly observed once more. 

```{r FB spectrum, echo=FALSE, eval= TRUE, fig.cap='\\label{fig:FB spectrum}The propagation of a typical offshore wave spectrum is given as produced from a single time-step in SWAN.'}

library(png)
library(grid)
library(jpeg)

img_fb <- readJPEG("figures/falsebay_spectrum.jpg")
grid.raster(img_fb)

```

To clarify the averaged wave exposure maps presented in figure \ref{fig:wave power map}, the propagation of a typical offshore wave spectrum as produced from a single time-step in SWAN is presented in figure \ref{fig:FB spectrum}. Tracing the wave height contours into False Bay its clear why this bay’s western periphery is predominantly sheltered. 

## Drivers of kelp morphological characteristics

Significant differences were found between cool temperate and warm temperate regimes for most *L. pallida* morphological characteristics with lamina length, number of digits and thallus mass the exceptions (see figure \ref{fig:lamanaria temp plots}). Certain morphological characteristics such as stipe mass, stipe length, total length and stipe diameter had significantly higher means for kelp from the cool temperate regime when compared to kelp from the warm temperate regime. Conversely, lamina weight and lamina thickness had significantly lower means for kelp from the cool temperate regime compared to kelp from the warm temperate regime. When *L. pallida* morphological characteristics were grouped to wave exposure categories kruskal-wallis tests revealed significant differences amongst categories for most morphological characteristics with lamina length, number of digits and thallus mass the exceptions. The morphological characteristics that were significantly different amongst sites exhibited similar patterns, with increasing mean values from the fully sheltered to extremely sheltered categories and a decrease in mean values for the remainder of the categories. Two morphological characteristics, namely lamina thickness and stipe diameter, both exhibited higher variations for the exposed categories compared to other morphological characteristics. 

```{r laminaria processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE, eval=TRUE}
#custom temperature categories position on x-axis
pos_temp <- c("Cool temperate", "Warm temperate")

#temperature and lamanaria  
LT1 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaWeight, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.62, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Lamina weight") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT2 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Lamina length") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT3 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaThickness, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Lamina thickness") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT4 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.65, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT5 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.65, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT6 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeDiameter, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.65, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe diameter (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT7 <- ggplot(data = lam_data, aes(x = temp_regime, y = digits, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("No. of digits") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT8 <- ggplot(data = lam_data, aes(x = temp_regime, y = thallusMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Thallus mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

LT9 <- ggplot(data = lam_data, aes(x = temp_regime, y = totalLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.65, label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)


lam_data$wave_exposure <- factor(lam_data$wave_exposure, levels=c("Very sheltered", "Very exposed", "Moderately exposed","Fully sheltered","Extremely sheltered"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed"))#wave exposure levels for lamanaria
pos_exposure_lam <- c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed")#custom positions

LW1 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaWeight, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.85, label.y.npc = c('top')) + 
  ylab("Lamina weight (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") 

LW2 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.82, label.y.npc = c('top')) + 
  ylab("Lamina length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("")

LW3 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaThickness, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.82, label.y.npc = c('top')) + 
  ylab("Lamina thickness") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") 

LW4 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.9, label.y.npc = c('top')) + 
  ylab("Stipe mass (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") 

LW5 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.9, label.y.npc = c('top')) + 
  ylab("Stipe length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") 

LW6 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeDiameter, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.9, label.y.npc = c('top')) + 
  ylab("Stipe diameter (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") 

LW7 <- ggplot(data = lam_data, aes(x = wave_exposure, y = digits, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.82, label.y.npc = c('top')) + 
  ylab("No. of digits") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("")

LW8 <- ggplot(data = lam_data, aes(x = wave_exposure, y = thallusMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.9, label.y.npc = c('top')) + 
  ylab("Thallus mass (kg)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("")
LW9 <- ggplot(data = lam_data, aes(x = wave_exposure, y = totalLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) +
  stat_compare_means(method = "kruskal.test", label = "p.format", label.x  = 0.9, label.y.npc = c('top')) + 
  ylab("Total length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("")
```

```{r laminaria temp plots, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, fig.cap='\\label{fig:lamanaria temp plots}Boxplots representing *L. pallida* morphological characteristics grouped by temperature regime measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The “whiskers” represent the range, solid black lines represent the median and black dots are outliers. Light grey boxes represent cool-temperate and dark grey warm-temperate.', fig.height=8, fig.width=8}
ggarrange(LT1, LT2,LT3,LT4,LT5,LT6,LT7,LT8,LT9, labels = c("AUTO"), common.legend = TRUE, legend = "none", align ='hv')
```

```{r lamanaria wave plots, echo=FALSE, warning=FALSE, eval=TRUE, message=FALSE, fig.height=8, fig.width=8, fig.cap='\\label{fig:lamanaria wave plots}Boxplots representing *L. pallida* morphological characteristics grouped by wave exposure category measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper hinges correspond to the first and third quartiles. The whiskers represent the range, solid black lines represent the median and black dots are outliers.'}
ggarrange(LW1, LW2,LW3,LW4,LW5,LW6,LW7,LW8,LW9, labels = c("AUTO"), common.legend = TRUE, legend = "bottom", align = "hv")
```

Six out of the ten deep *E. maxima* morphological characteristics showed differences between cool temperate and warm temperate regime except for frond mass, frond length, stipe mass and epiphyte length. Mean values for primary length, primary width and stipe circumference were significantly higher for kelp from the cool temperate regime than for kelp from the warm temperate regime (see figure \ref{fig:lamanaria wave plots}. The remaining morphological characteristics, stipe length, number of tufts and total length had significantly lower means for kelp from cool temperate compared to kelp from the warm temperate regime. Significant differences amongst wave exposure categories were found for all morphological characteristics of deep *E. maxima* populations. Certain morphological characteristics showed a gradual increase in mean value with increasing degree of wave exposure. The remaining morphological characteristics exhibited decreased means for only the higher wave exposure categories, followed by a sharp increase in mean value for the highest wave exposure category. 

```{r deep ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}
## Preparing data
# Ecklonia
# group_by(wave_exposure, frond_mass) %>% 
# summarise(mean = mean(frond_mass:total_length, na.rm = TRUE)) %>% 
# ungroup()
eck_deep <- eck_data %>% 
  filter(population == "Deep")
eck_shall <- eck_data %>% 
  filter(population == "Shallow") %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point"))
   
pos_temp <- c("Cool temperate", "Warm temperate") #custom temperature categories position on x-axis
#temperature plots made seperately for each morphological characteristic
ET1 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Frond mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET2 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Primary length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET3 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Primary width (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET4 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Frond length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET5 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET6 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET7 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe circ (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET8 <- ggplot(data = eck_deep, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("No. of tufts") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET9 <- ggplot(data = eck_deep, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Epi length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
ET10 <- ggplot(data = eck_deep, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = TRUE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x  = 0.6, label.y.npc = c('top')) + 
  ylab("Total length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4) 

eck_deep$wave_exposure <- factor(eck_deep$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"))

# custom positions for wave exposure categories and sites
pos_exposure <- c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed")
#morphology and wave exposure
EW1 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW2 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Primary length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW3 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW4 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW5 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW6 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW7 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Stipe circumference (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW8 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("No of Tufts") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW9 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW10 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
```

```{r deep ecklonia temp plot, echo=FALSE, fig.cap='Boxplots representing deep population *E. maxima* morphological characteristics grouped by temperature regime measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The “whiskers” represent the range, solid black lines represent the median and black dots are outliers. Light grey boxes represent cool-temperate and dark grey warm-temperate.', fig.height=8, fig.width=8, message=FALSE, warning=FALSE, eval=TRUE}
ggarrange(ET1,ET2,ET3,ET4,ET5,ET6,ET7,ET8,ET9,ET10, labels = "AUTO", common.legend = TRUE, legend = c("none"), ncol = 3, nrow = 4)
```

```{r deep ecklonia wave, echo=FALSE, warning=FALSE, eval=TRUE, message=FALSE, fig.cap='\\label{fig:deep ecklonia wave}Boxplots representing deep *E. maxima* morphological characteristics grouped by wave exposure category measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The “whiskers” represent the range, solid black lines represent the median and black dots are outliers.', fig.height=8, fig.width=8}
ggarrange(EW1,EW2,EW3,EW4,EW5,EW6,EW7,EW8,EW9,EW10, labels = "AUTO", common.legend = TRUE, legend = "bottom", ncol = 3, nrow = 4)
```

```{r shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE, eval=TRUE}
EST1 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Frond mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST2 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Primary length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST3 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Primary width (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") + 
  ylim(0, 20) +
  scale_fill_grey(start = 0.8, end = 0.4)
EST4 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Frond length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST5 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST6 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST7 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Stipe circ (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  ylim(0, 30) +
  scale_fill_grey(start = 0.8, end = 0.4)
EST8 <- ggplot(data = eck_shall, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("No. of tufts") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST9 <- ggplot(data = eck_shall, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Epi length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)
EST10 <- ggplot(data = eck_shall, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test", label = "p.format", label.x = 0.6, label.y.npc = c('top')) + 
  ylab("Total length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_grey(start = 0.8, end = 0.4)

# morphology grouped by wave exposure
eck_shall$wave_exposure <- factor(eck_shall$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"))
# custom positions for wave exposure categories and sites
pos_exposure_shall <- c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed")
#morphology and wave exposure
ESW1 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Frond mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW2 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Primary length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW3 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Primary width (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) + 
  ylim(0,25)
ESW4 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Frond length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW5 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Stipe mass (g)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW6 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Stipe length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW7 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
 ylim(0,30) +
  ylab("Stipe circumference (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW8 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("No of Tufts") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW9 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE)  + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Epi length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW10 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE) + 
  stat_compare_means(method = "kruskal.test", label = "p.format", label.y.npc = c('top')) + 
  ylab("Total length (cm)") +
  theme_bw() +
  theme(axis.text.x = element_blank()) + 
  xlab("") +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

```

```{r shallow ecklonia temp, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, fig.cap='\\label{fig:shallow ecklonia temp} Boxplots representing shallow *E. maxima* morphological characteristics  grouped by temperature regime measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The “whiskers” represent the range, solid black lines represent the median and black dots are outliers. Light grey boxes represent cool-temperate and dark grey warm-temperate.', fig.height=7, fig.width=8}
ggarrange(EST1,EST2,EST3,EST4,EST5,EST6,EST7,EST8,EST9,EST10, labels = "AUTO", common.legend = FALSE, legend = "bottom", ncol = 3, nrow = 4)
```

```{r shallow ecklonia wave, echo=FALSE, warning=FALSE, eval=TRUE, message=FALSE, fig.cap='\\label{fig:shallow ecklonia wave}Boxplots representing shallow *E. maxima* morphological characteristics grouped by wave exposure category measured around the Western Cape coastline, with the y-axis depicting the specific morphology measured, with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The “whiskers” represent the range, solid black lines represent the median and black dots are outliers.', fig.height=7, fig.width=8}
ggarrange(ESW1,ESW2,ESW3,ESW4,ESW5,ESW6,ESW7,ESW8, ESW9, labels = "AUTO", common.legend = TRUE, legend = "bottom", ncol = 3,nrow = 3)
```

### Abiotic drivers of *L. pallida* morphological characteristics

Forward selection, assessment of VIF and an examination of pairwise Pearson correlation coefficients allowed us to retain the most parsimonious descriptors of *L. pallida* morphological characteristics with an adjusted *R*2 of 0.49, explaining 72% of the variation (global permutation test on final model: d.f = 1, *F* = 8.51, *p* = 0.008). RDA1 was the only significant axis in the model and explained 48% of the variation while RDA2 was not significant and explained 63% of the variation. Total length, stipe length, stipe diameter and stipe mass were positively influenced (i.e., increased size corresponding with the environmental driver) by *hs_mean* and *dir_median* for kelp mostly from the western region and negatively influenced (i.e., decreased size corresponding with the environmental driver) by *tp_sd* and *mean_temp* for kelp from the eastern region. Although sites from from the western region did not cluster as closely as eastern region study sites, grouping according to region was still evident. 

### Abiotic drivers of *E. maxima* morphological characteristics

```{r rda analysis lamanaria, message=FALSE, warning=FALSE, include=FALSE, eval= TRUE}
#data processed in the temperature and wave sections will be used here eg. abio_clim
# remove unnecessary columns
lam_df <- subset(lam_data, select = -c(1,2,6))

#calculate mean values for lamanaria morphology
lam_mean <- lam_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  filter(site != "Roman Rock") %>% 
  ungroup()

#subset sites into seperate object for aligning data sets
lam_sites <- subset(lam_mean, select = c(1))

#standardise all abiotic measurements
bio_lam <- lam_mean %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

#bind site column back to dataframe
bio_lam <- cbind(lam_sites, bio_lam)

bio_lam <- bio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site lam_site to align appropriate data
abio_lam <- merge(lam_sites, abio_clim, by = "site")

#remove date column 
abio_lam <- abio_lam[ , -c(2)]

# standardise all abiotic measurements
abio_lam <- abio_lam %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

#have an issue with Miller's Point not merging so removing for now. creating temp site list for this
lam_sites_temp <- lam_sites[-c(9), ]
abio_lam <- cbind(lam_sites_temp, abio_lam)

abio_lam <- abio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")
#remove Millers from bio_lam to match up sites as I am still having issues
bio_lam <- bio_lam[-c(9), ]
#run RDA for abiotic variables
rda_all_lam <- rda(bio_lam ~ ., data = abio_lam)

#summary of rda output
summary(rda_all_lam)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_lam ~ 1, data = abio_lam),
                         scope=formula(rda_all_lam), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_lam)

#use pearson correlations to determine best abiotic variables for model
cor_lam_abio <- round(cor(abio_lam, use = "pair"), 2)
cor_lam_abio

# Parsimonious RDA
rda_lam <- rda(bio_lam ~ tp_sd + hs_mean + mean_temp + dir_median, data = abio_lam)
summary(rda_lam)
anova.cca(rda_lam, step = 1000)
anova.cca(rda_lam, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_lam)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_lam)$adj.r.squared
R2adj 

meta_lam_rda <- read.csv("metadata/site_meta_complete.csv", sep = ";")
meta_lam_rda <- merge(lam_sites, meta_lam_rda, by = "site")
meta_lam_rda <- meta_lam_rda[-c(9), ] #remove Miller's point as it is dropping during processing
  
# Plot RDA
lam_rda <- ggord(rda_lam, meta_lam_rda$region,ellipse = FALSE, hull = TRUE, grp_title = "Region", ptslab = TRUE, parse = TRUE, addsize = 3.5, repel = TRUE, ylims = c(-1.1,1.1), xlims = c(-1.1,1.1)) 
```

```{r rda deep ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}

#filter to select only deep population ecklonia
eck_df <- eck_data %>% 
  filter(population == "Deep")

# remove unnecessary columns
eck_df <- subset(eck_df, select = -c(1,2,3,4,8,9,10))

#calculate mean values for lamanaria morphology
eck_mean <- eck_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup()

#remove St Helena Bay for now as wave model not available for that site
eck_mean <- eck_mean %>% 
  filter(site != "Miller's Point")

#subset sites into seperate object for aligning data sets
eck_sites <- subset(eck_mean, select = c(1))

#standardise all abiotic measurements
bio_eck<- eck_mean %>%
  subset(select = -c(1)) %>%
  decostand(method = "standardize")

#bind site column back to dataframe
bio_eck <- cbind(eck_sites, bio_eck)

bio_eck <- bio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_eck <- merge(eck_sites, abio_clim, by = "site")

#remove date column and extra Betty's Bay row
abio_eck <- abio_eck[ , -c(2)]

# standardise all abiotic measurements
abio_eck <- abio_eck %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

abio_eck <- cbind(eck_sites, abio_eck)

abio_eck <- abio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_eck <- rda(bio_eck ~ ., data = abio_eck)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck ~ 1, data = abio_eck),
                         scope=formula(rda_all_eck), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_eck)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck <- rda(bio_eck ~ tp_mean + hs_mean + tp_sd + min_temp + dir_median, data = abio_eck)
summary(rda_eck)
anova.cca(rda_eck, step = 1000)
anova.cca(rda_eck, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck)$adj.r.squared
R2adj 

eck_meta_rda <- merge(eck_sites, meta_all, by = "site")
eck_meta_rda <- eck_meta_rda %>% 
  filter(population == "Deep")

# Plot RDA
rda_eck_deep <- ggord(rda_eck, eck_meta_rda$region ,ellipse = FALSE, hull = TRUE, ptslab = TRUE, parse = TRUE, addsize = 3.5, repel = TRUE, ylims = c(-1.1,1.1), xlims = c(-1.1,1.1))  
```

```{r rda shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, eval=TRUE}

#filter to select only deep population ecklonia and remove Millers B and C for now...
eck_df_sh <- eck_data %>%
  filter(population == "Shallow") %>% 
  mutate(site = replace(site, site == "Miller's Point A", "Miller's Point")) %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>% 
  filter(site != "Miller's Point B") %>% 
  filter(site != "Miller's Point C") %>% 
  filter(site != "Slangkop")

# remove unnecessary columns
eck_df_sh <- subset(eck_df_sh, select = -c(1,2,3,4,8,9,10))

#calculate mean values for shallow ecklonia morphology
eck_mean_sh <- eck_df_sh %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup() 
eck_mean_sh <- eck_mean_sh %>% 
  mutate(site = replace(site, site == "Yzerfontein", "St Helena Bay")) 

#subset sites into seperate object for aligning data sets
eck_sites_sh <- subset(eck_mean_sh, select = c(1)) 

#standardise all abiotic measurements
bio_eck_sh<- eck_mean_sh %>%
   subset(select = -c(1)) %>%
   decostand(method = "standardize")  

#bind site column back to dataframe
bio_eck_sh <- cbind(eck_sites_sh, bio_eck_sh)

bio_eck_sh <- bio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_clim_v2 <- abio_clim %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>% 
  mutate(site = replace(site, site == "Bordjies Deep", "Bordjies"))
  
abio_eck_sh <- merge(abio_clim_v2, eck_sites_sh, by = "site") 

#remove date column
abio_eck_sh <- abio_eck_sh[ , -c(2)]

# standardise all abiotic measurements
abio_eck_sh <- abio_eck_sh %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize") 

abio_eck_sh <- cbind(eck_sites_sh, abio_eck_sh)

abio_eck_sh <- abio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_ecksh <- rda(bio_eck_sh ~ ., data = abio_eck_sh)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck_sh ~ 1, data = abio_eck_sh),
                         scope=formula(rda_all_ecksh), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_ecksh)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck_sh, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck_shallow <- rda(bio_eck_sh ~ mean_temp + dirw_median + tp_max + max_temp, data = abio_eck_sh)
summary(rda_eck_shallow)
anova.cca(rda_eck_shallow, step = 1000)
anova.cca(rda_eck_shallow, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck_shallow)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck_shallow)$adj.r.squared
R2adj 

meta_all$site <- as.character(meta_all$site)
meta_shallow_rda <- meta_all %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>%  
  mutate(site = replace(site, site == "Yzerfontein", "St Helena Bay")) %>% 
  mutate(site = replace(site, site == "Bordjies Deep", "Bordjies"))
meta_shallow_rda <- merge(meta_shallow_rda, eck_sites_sh, by = "site")

# Plot RDA
rda_eck_shallow <- ggord(rda_eck_shallow,meta_shallow_rda$region,ellipse = FALSE, hull = TRUE, grp_title = "Sites", ptslab = TRUE, parse = TRUE, addsize = 3.5, coord_fix = TRUE, repel = TRUE, facet = FALSE, ylims = c(-1.1,1.1), xlims = c(-1.1,1.1))
```

Forward selection, assessment of VIF and Pearson correlation coefficients allowed us to retained as the most parsimonious descriptors of deep *E. maxima* morphological characteristics with an adjusted *R*2 of 0.39, explaining 67% of the variation (global permutation test on final model: d.f = 5, *F* = 2.4, *p* = 0.026). RDA1 was the only significant axis in the model (p = 0.03) and explained 72% of the variation. Primary length, primary width and stipe circumference were positively influenced by *hs_mean*, *tp_mean* and *dir_median* for for kelp from the western region. The remaining morphological characteristics were positivist influenced by *min_temp* and negatively influenced by *tp_sd* for kelp from the eastern region. 

```{r rda plots, echo=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, eval=TRUE, fig.cap="\\label{fig:rda plots}RDA output for *L. pallida* (A), deep *E. maxima* (B) and shallow *E. maxima* (C). The blue cluster represnts sites from the western region and the red represents sites from the eastern region."}
ggarrange(lam_rda, rda_eck_deep, rda_eck_shallow, legend = "none", labels = "AUTO", ncol = 2, nrow = 2, align = "hv")
```

Forward selection, assessment of VIF and Pearson correlation coefficients allowed us to retain the most parsimonious descriptors of shallow *E. maxima* morphological characteristics with an adjusted *R*2 of 0.36, explaining 61% of the variation (global permutation test on final model: d.f = 4, *F* = 2.41, *p* = 0.013). The model consisted of one significant axis, RDA1 (p = 0.02) and explained 62% of the variation. Stipe length, stipe mass and stipe circumference were positively influenced by *max_temp* and *mean_temp* along RDA1, and explained 50% and 55% of the variation respectively. The remaining morphological characteristics were positively influenced by *tp_max* and negatively influenced by *dirw_median* along RDA2 and explained 86% and 94% of the variation respectively. There was overlapping of clusters according to region with no clear patterns in sites evident. 

# Discussion

This study considered important drivers of kelp morphology that have been identified in previous research [@FowlerWalker2006; @Miller2011-pm; @FowlerWalker2005; @Stewart2009; @Wing2007-tv; @Molloy1996-la; @Pedersen2012-vr; @Wernberg2005c; @Thomsen2004], namely temperature and wave exposure, around the Cape Peninsula on two prolific kelp species. The complex geomorphology of the western Cape coastline creates an ideal natural laboratory for studies of kelps in interaction with their environment. Unlike previous research, this study used a numerical model to provide the various variables of wave exposure. We also considered wind in addition to temperature and wave variables, since wind is an important component of wind-driven surface gravity waves [@Holthuijsen2010-vl]. The results show that specific variables of wave exposure are the main drivers of kelp morphology with temperature only playing a minor role. Furthermore, the investigation of differences in morphological characteristics between shallow and deep populations of *E. maxima* suggests that in low wave exposure environments the role of temperature as a morphological driver increases, such as in False Bay. 

There were clear patterns and clines in both the temperature and wave exposure data. The thermal and wave exposure regimes around the Cape Peninsula are driven by a complex interaction between wind, temperature and wave metrics, which do not act independently but instead influence one another. The hydrodynamic regime is modulated by the relative sheltering against the predominant south-westerly swell direction and the size of the fetch for local wave generation. The direction of the dominant swell changes to the south west in winter, generated by strong low pressures that originate from the southern ocean [@Reason2006], which False Bay is sheltered from [@Shipley1964; @Atkins1970-bx; @Dufois2012-vy]. In summer, these swells rotate anticlockwise and are able to enter False Bay, providing an increased variability of swell height and peak period in this region. It should be noted that what is classified as sheltered around the South African coastline (a high energy coastline) might be classified as exposed in other regions of the world [@Norderhaug2012-ks; @Leliaert2000a]. It is due to the near consistent south-westerly swell and the complex orography around the peninsula that the wave energy distribution around the Cape Peninsula varies significantly over a small geographical area. The directional sheltering effect of the Cape Peninsula, against the dominant swell direction is clearly observed in the wave exposure maps presented in figure \ref{fig:wave power map}.It should be mentioned that some of the annual winter frontal depression systems pass the Cape Peninsula from the west to east, resulting in wave propagating towards the continent from much more southerly directions. This results in positive and negative wave exposure anomalies all around the peninsula. Increased wind speed at sites along the west side of the peninsula in a southerly direction trigger upwelling events along the western side of the peninsula [@Rouault2010-gi; @Field1980a]. In general, the western side of the peninsula is more exposed than the eastern side (False Bay) and experiences significantly higher mean significant swell height and mean significant peak period. This was also reflected in the wave exposure categories which show a trend of decreasing wave exposure (wave power) around the peninsula and into False Bay. There are also differences between the types of waves that each side of the peninsula experiences. The wave analysis shows the western side of the peninsula is not only more exposed but the hydrodynamics are largely swell driven, while on the eastern side most of the wave energy is driven by a combination of swell and wind with the latter being the predominant driver. 

We provide strong support that variations in the environmental variables, particularly wave exposure variables, are driving kelp morphological characteristics around the Cape Peninsula. Morphological adaptation due to water motion may manifest in a number of ways in high wave energy environments. For instance, reduction of blade thickness, blade elongation, increase of stipe length, increase in stipe circumference and force of attachment [@FowlerWalker2006; @Wernberg2005c; @Friedland1995-vi; @Denny2002; @bekkby2014; @Denny1997] have been identified in previous studies. Although this study did not measure force of attachment, other morphological responses to temperature and wave variables were evident. Species-specific responses are evident in both wave exposure and temperature. In cool temperate environments *L. pallida* tended to show increases in certain morphological characteristics (stipe mass, stipe length and stipe diameter) while in the warm-temperate environments these were significantly lower. This was also true for deep *E. maxima* populations, which had longer, thinner stipes for kelp from the warm temperate compared to kelp from the cool temperate. Reduction in certain morphological characteristics has been attributed to temperature by @Serisawa2002-dc in the kelp *E. cava*, which was smaller and shorter in warmer sites compared to cooler sites. The reduction in size of adult may be a response to low nutrient conditions, which has been shown to reduce growth rate and overall morphology [@Simonson2015]. Warmer temperatures are associated with low nutrient concentrations [@Waldron1992] and the low frequency of upwelling conditions in False Bay (low nutrient supply) coupled with warmer temperatures may be a contributing factor. It should be noted however, that from these analyses that in general the cool temperate region is more exposed to waves than that of the warm-temperate region. Therefore, the significantly larger morphological characteristics for kelp from the cool temperate region may overlap with responses to wave exposure. The response of kelp morphological characteristics to wave exposure was evident and both species exhibit tactics based on the magnitude of wave exposure. Strength increasing traits were exhibited for lower exposure levels while a 'go-with-the-flow' tactic for moderate levels of wave exposure. This suggests that how morphological characteristics manifest themselves is dependent on the magnitude of wave exposure. When grouped by wave exposure category, *L. pallida* characteristics showed a significant increase in length for the 'Extremely sheltered' category (6-10 kW/m; figure \ref{fig:wave power map}) compared to the fully sheltered category (<5 kW/m; see figure \ref{fig:wave power map}), which may be a 'go-with-the-flow' tactic. Kelp are able to increase flexibility by increasing stipe length which increases the extension capabilities of kelp to a passing wave [@Denny2002; @Hurd2000]. However, increasing stipe length is only beneficial under lower exposure levels as a long stipe actually increases overall drag on the plant under high wave exposure [@Denny2002; @Denny1997]. This is reflected in figure \ref{fig:lamanaria wave plots} which shows an overall reduction of *L pallida* morphological characteristics suggesting a size reducing tactic to cope with higher levels of wave exposure. The results suggest that deep *E. maxima* populations exhibit a different response, as well as a higher wave exposure threshold. Unlike *L. pallida*, *E. maxima* exhibits a size reducing tactic with increasing wave exposure by  decreasing stipe mass, stipe length, stipe circumference, total length and frond length. A magnitude related response has been suggested by @wernberg2010 who investigated the temporal and spatial variations of various environmental drivers of the kelp *E. radiata*. The authors identified wave exposure as the most important driver of kelp morphological characteristics and that the type of response elicited is dependent on the magnitude of wave exposure. 

A size reduction tactic has been shown before [@FowlerWalker2006; @Denny2002; @Hurd2000; @FowlerWalker2005] and is regarded as a strategy to reduce overall drag on the plant. However, *E. maxima* morphological characteristics changed significantly as wave exposure increases. When grouped to the higher wave exposure levels, *E. maxima* morphology exhibited a strength and flexibility increasing trait (see figure \ref{fig:deep ecklonia wave}). Furthermore, the morphological response of *E. maxima* to wave exposure only occurs at the 'Moderately exposed' (20-30 kW/m) level compared to *L. pallida* which exhibits a response at a lower wave exposure level. This suggests that *E. maxima* can tolerate higher exposure levels before having to exhibit a morphological response. The redundancy analysis performed confirms the patterns and responses observed as well as identifying specific temperature and wave variables as drivers of kelp morphology. Kelp morphology characteristics are largely wave driven for both species but differ in terms of specific temperature and wave metrics. For instance, both species morphological characteristics are determined by swell direction (*dir_median*), standard deviation in peak period (*tp_sd*) and mean significant swell height (*hs_mean*), but *L. pallida* temperature driver is mean temperature (*mean_temp*) and *E. maxima* by minimum temperature (*min_temp*). Minimum temperature as an important metric for *E. maxima* may be related to nutrient availability. Low temperatures are often associated with upwelling events which bring cool, nutrient rich water into the nearshore. False Bay has comparatively little upwelling events compared to the western side of the peninsula, and so nutrients may be a limiting factor for *E. maxima* populations within False Bay, hence the identification of minimum temperature (*min_temp*) as a driver. Mean temperature identified as a driver for *L. pallida* may be related to diurnal temperature fluctuations in the water column. Solar heating of the water surface in combination with wind-driven transport causes fluctuations within the water column, which can occur daily or seasonally [@Kaplan2003].  Vertical mixing of the water column for inshore regions are driven by several abiotic processes: (1) Turbulence of breaking waves inside or outside of the surf zone (2) convective mixing through a combination of cooling and evaporation (3) wind driven currents and (4) tidal mixing [@Smit2013a]. These abiotic processes cause effective vertical mixing of surface and deeper water stratification which leads to a homogeneous thermal environment, which in this study may be interpreted as the mean temperature. Therefore, the homogeneous thermal regime of inshore regions may be a reason why mean temperature is driver of *L. pallida* morphological characteristics. The difference in canopy type between the species may be the reason why *E. maxima* is driven by multiple wave metrics compared to *L. pallida*. Since *E. maxima* is a canopy-kelp, it is  exposed to all components of a wave compared to *L. pallida* which occurs deeper in the water column. 

Temperature variables were not a significant driver of kelp morphology in this study. Although temperature plays an important role in distribution [@Bolton2010; @Miller2011-pm; @Rinde2014] of kelp and physiological functioning of adults and gametophytes [@Mohring2014-bk; @Steneck2002; @gerard1997; @bearham2013; @Smale2017], there is little evidence in this study that temperature is an important driver of morphological variation. However, we suggest that temperature plays a larger role in determining kelp morphology at sites where wave energy is low enough not to elicit a response in morphological characteristics. Temperature metrics influence stipe length and frond length in shallow *E. maxima* individuals located at sites within False Bay; which was not the case for deeper *E. maxima* individuals as well as *L. pallida* which were largely driven by wave variables. The shallow *E. maxima* individuals may not experience the same amount of wave energy as do deeper populations. This may be due to wave dampening from deeper populations of *E. maxima*, which attenuate the wave energy entering coastal environments [@Kobayashi1993-os; @Jackson1984; @Mork1996-md]. The morphological variations in characteristics for deep *E. maxima* populations are not seen for shallow *E. maxima* populations. The lack of variation in shallow *E. maxima* populations was also found in previous research by [@Rothman2017-pn] who identified light as a significant driver. This influence of light may suggest photosynthetic ability and nutrient uptake as important drivers in shallow environments. Wave exposure may be reduced in shallow environments due to the wave damping effect of deep kelp and seaweed populations [@Kobayashi1993-os; @Mork1996-md; @Jackson1984] thereby reducing the need to adapt morphological characteristics to reduce drag. Furthermore, the reduction in differences between deep and shallow *E. maxima * at wave exposed sites on the western of the peninsula compared to sites in False Bay provides further evidence that wave exposure is not an important driver of shallow *E. maxima* populations. Increased temperatures corresponded with a reduction in stipe circumference, frond length, stipe length, total length and stipe mass resulting in slim or ‘skinny’ kelp individuals, which supports findings from previous research by [@mabin2013; @Serisawa2002-dc]. These findings were confirmed by the redundancy analysis which showed the contribution of wave variables as a driver of kelp morphological characteristics was lower compared to temperature variables. The sites do cluster by region but almost overlap entirely, further indicating wave variables are not the main driver. Although wave variables were not identified as an important driver, it is important to note the wave variables identified in the RDA differ to deep *E. maxima*. The identification of median wind direction (*dirw_median*) suggests that surface gravity waves as a driver compared to swell waves (*dir_median*) identified for *L. pallida* and *E. maxima*. 

# Conclusion

Past research shows that macroalgal morphological characteristics are largely driven by a wave exposure while others have suggested a complex interaction between various environmental variables. We confirm that wave variables are the main driver of kelp morphological characteristics in both *E. maxima *and *L. pallida* populations around the Cape Peninsula, and differences in morphological characteristics between shallow and deep populations of *E. maxima* may reflect differences in hydrodynamic and temperature regimes. This study also confirms the findings of previous research which shows morphological adaptation is dependent on the magnitude of wave exposure, but provides quantitative, reproducible measure of wave exposure while identifying the specific wave metrics and wave energy thresholds involved. Furthermore, the current study highlights the need to understand how kelp populations, which are not exposed to high wave energy and morphological characteristics are largely driven by temperature, are vulnerable to changes in storm frequency and magnitude. Kelp populations located in low wave energy environments, such as False Bay, may be more vulnerable to increased storm frequency and magnitude in future climate scenarios. 

# Conflict of Interest Statement

The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest

# Author Contributions

RC conceptualised the scope of the research reported in this paper, collected samples, undertook the majority of numerical and statistical analyses, made the first round of interpretation, and did the majority of the writing. AS and CR provided guidance in terms of  writing, statistical analyses, and the final draft of the paper, as well some writing in the relevant sections. RS aided in fieldwork and statistical analyses for the temperature data. TP performed the initial analyses and interpretation of the data.

# Funding 

The research was funded by the South African National Research Foundation ([http://www.nrf.ac.za](http://www.nrf.ac.za)) programme "Thermal characteristics of the South African nearshore:implications for biodiversity" (CPRR14072378735).

Aside from funding provided, the funders had no role in the study design, data collection and analysis, decision to publish, or preparation of the manuscript. 

# Acknowledgments

Thank you to AS and CR for their guidance, and the honours class of 2014-2015 that aided in fieldwork. Carla Louise for making the GIS plot etc. 

# Appendix

```{r}

```


```{r appendix figure 1, echo=FALSE, message=FALSE, warning=FALSE, fig.height=7,fig.width=8}
positionsLam <- c("Betty's Bay", "Roman Rock","A-Frame", "Miller's Point ", "Baboon Rock", 
                  "Batsata Rock", "Buffelsbaai","Buffelsbaai South","Bordjies Deep","Olifantsbos", "Kommetjie", "Sea Point")
lam_all_A <- ggplot(data = lam_data, aes(x = site, y = laminaWeight, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Lamina Weight (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("")
lam_all_B <- ggplot(data = lam_data, aes(x = site, y = laminaLength, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Lamina Length (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("")
lam_all_C <- ggplot(data = lam_data, aes(x = site, y = laminaThickness, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Lamina Thickness (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
lam_all_D <- ggplot(data = lam_data, aes(x = site, y = stipeMass, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Stipe Mass (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
lam_all_E <- ggplot(data = lam_data, aes(x = site, y = stipeLength, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Stipe Length (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
lam_all_F <- ggplot(data = lam_data, aes(x = site, y = stipeDiameter, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Stipe Diameter (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("")
lam_all_G <- ggplot(data = lam_data, aes(x = site, y = digits, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("No. of Digits") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
lam_all_H <- ggplot(data = lam_data, aes(x = site, y = thallusMass, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Thallus Mass (g)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
lam_all_I <- ggplot(data = lam_data, aes(x = site, y = totalLength, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsLam) + 
           ylab("Total length (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 

ggarrange(lam_all_A,lam_all_B,lam_all_C,lam_all_D,lam_all_E,lam_all_F,lam_all_G,lam_all_H,lam_all_I, ncol = 3, nrow = 3, common.legend = TRUE)

```

```{r appendix figure 2, echo=FALSE, message=FALSE, warning=FALSE, fig.height=7,fig.width=8}
# Order site names by location west to east

positionsEck <- c("Betty's Bay", "Kalk Bay", "A-Frame", 
                  "Miller's Point", "Baboon Rock", "Batsata Rock", 
                  "Buffels Bay", "Scarborough", 
                  "Soetwater","Kommetjie","Hout Bay", 
                  "Oudekraal", "St. Helena Bay")

eck_all_A <- ggplot(data = eck_data, aes(x = site, y = frond_mass, fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Frond mass (g)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_B <- ggplot(data = eck_data, aes(x = site, y = primary_length , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Primary Length  (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_C <- ggplot(data = eck_data, aes(x = site, y = primary_width , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Primary Width (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_D <- ggplot(data = eck_data, aes(x = site, y = frond_length , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Frond length (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_E <- ggplot(data = eck_data, aes(x = site, y = stipe_mass , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe mass (g)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_F <- ggplot(data = eck_data, aes(x = site, y = stipe_length , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe length (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_G <- ggplot(data = eck_data, aes(x = site, y = stipe_circ , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe circ (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_H <- ggplot(data = eck_data, aes(x = site, y = tufts , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("No. of tufts") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 
eck_all_I <- ggplot(data = eck_data, aes(x = site, y = epi_length , fill = wave_exposure)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Epi Length  (cm)") + 
           scale_fill_brewer(palette="OrRd") +
           coord_flip() +
           guides(fill=guide_legend(title="Wave Exposure")) +
           xlab("") 

ggarrange(eck_all_A,eck_all_B,eck_all_C,eck_all_D,eck_all_E,eck_all_F,eck_all_G,eck_all_H,eck_all_I, ncol = 3, nrow = 3, common.legend = TRUE, legend = FALSE)
```

# References







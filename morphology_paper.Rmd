---
title: Using numerical modelling to investigate temperature and wave exposure as drivers of macroalgal characteristics
author: "R. Coppin, C. Rautenbach, T. Ponton and A.J Smit"
geometry: margin=1in
output:
  word_document:
    reference_docx: frontiers_template.docx
  html_document:
    df_print: paged
  pdf_document:
    fig_caption: yes
    fig_crop: no
    fig_height: 7
    fig_width: 7
  html_notebook:
    fig_caption: yes
    fig_height: 7
    fig_width: 7
papersize: A4
tables: yes
fontsize: 10pt
---

```{r include=FALSE}
knitr::opts_chunk$set(cache=FALSE)
```

# Introduction

Kelps are a group of large seaweeds of the order Laminariales (Ochrophyta), which despite their relatively low taxonomic diversity of species in genera (Bolton 2010), nevertheless form the basis of one of the most productive ecosystems globally (Mann 1973). Kelps generally have a dependence on cool, temperate and arctic seawater temperatures (Bolton 2010; Mohring et al. 2014; Cavanaugh et al. 2011; Dayton 1985), and dominate the nearshore biomass within the rocky shallow coasts in both hemispheres (Steneck et al. 2002). Their size and complex morphology provide a heterogeneous habitat structure (Steneck et al. 2002) that accommodate a multitude of turf and subcanopy seaweed species, and diverse assemblages of sessile and mobile invertebrates and vertebrates (Mann 1973; Steneck et al. 2002), each depending on a wide suite of ecological services provided by the kelp forests (Gaines & Roughgarden 1987; Paul & Steneck 1993; Levin 1994; Willis & Anderson 2003; Anderson et al. 1997; Dayton 1985). Wave exposure and temperature are regarded as important environmental drivers of kelp forests, and play a role in the distribution (Gorman et al. 2013), abundance (Cavanaugh et al. 2011; Dayton et al. 1998), diversity (Wing et al. 2007; Wernberg & Goldberg 2008), composition (Leliaert et al. 2000; Dayton 1985; Norderhaug et al. 2012; Harley et al. 2012), growth (Cousens 1982) and productivity (Pedersen & Nejrup 2012; Dayton et al. 1998; Krumhansl & Scheibling 2012) of kelps. 

Temperature and wave exposure have been shown to play a role in driving kelp morphology. For example, a study by Serisawa et al. (2002) compared the morphology of Ecklonia cava Kjellman growing in warm temperate and cool temperate morphologies. The results showed that wrinkles in the blade seem to be a characteristic of warm temperate regions. However this study did not take into account the interaction with other environmental variables such as wave exposure. Wave exposure has also been shown to be the main drivers of morphological adaptation across various kelp species. Past research has shown that in highly wave exposed areas kelp morphology tends to take on characteristics which reduce drag, increase strength and increase flexibility (Denny & Gaylord 2002). For example, a study by Wernberg & Thomsen (2005) examined the consistency of wave exposure as a driver of *Ecklonia radiata* (C. Agardh) J. Agardh across a broad geographic range, and  showed trends towards drag-reducing (small size, narrow laterals and blades, low spinosity) and increased strength (large holdfast, thick stipe and thick blades and lamina) at high wave exposure sites. The morphological adaptation to wave exposure must be kept in balance with other important processes, such as nutrient assimilation and light absorption, which are dependent on the amount of surface area of the blades. Therefore, there is a trade-off between reducing overall drag and maintaining nutrient and photosynthetic ability.  The morphological adapatibility of kelps is driven by a combination of environmental factors that in turn do not act independently of one another. A study by Wernberg et al. (2003) investigated the morphology of *E. radiata* in order to quantify the morphological variation and whether it was dependent on spatial differences along the Australasian coast. They found no correlation between spatial distance and morphological similarity and rather the morphology of kelps was representative of multiple environmental forcings on different morphological characters at different spatial scales (Wernberg et al. 2003). Due to the complex effects of environmental drivers on kelp morphology, one can also expect differences in morphology between deep and shallow water populations of the same species. Wave exposure may be greater in shallower environments, or it may be reduced through damping effects of kelp further offshore and natural barriers such as rock outcrops; also, seawater temperature may be higher in shallow water environments due to higher solar irradiance. 

Other species of kelp, such as *Laminaria pallida* and *Ecklonia maxima* (Osbeck) Papenfuss which are important habitat forming seaweeds that exist around the coast of South Africa, offer a unique opportunity to investigate the drivers of macroalgal morphological characteristics between deep and shallow water environments. Although both these species exist in the subtidal, *L. pallida* dominates deeper waters while *E. maxima* forms dense surface canopies in from the subtidal to shallower waters. Therefore, *E. maxima* is exposed to variations in wave, swell and temperature, while *L. pallida* is exposed to variations in waves and temperature. (Molloy & Bolton 1996) investigated the effect of depth and wave exposure on *L. pallida* at different depths and wave exposure and showed that depth had a greater effect than wave exposure when considering all the morphological characteristics; when considering individual characteristics, however, wave exposure had the most significant effect on blade thickness. Another study by Rothman et al. (2017) investigated the changes in morphology in shallow populations of *L. pallida* and *E. maxima* along the South African coastline and into Namibia; *E. maxima* exhibited no morphological changes along the coast but the stipes of *L. pallida* become increasingly hollow further north along the coastline. They suggested that turbidity was the environmental driver responsible for this change. 

Measures of wave exposure in ecological studies often incorporate integrative measures of hydrodynamic conditions at a particular site which are based on cartographical models of wave exposure. Cartographical models of wave exposure are regarded as 'fetch-based-models' which measure the length of open water associated with a particular site in a straight line, and are regarded as simple measures of wave exposure. Advances in numerical modelling based on physical/linear wave theory incorporate more complexity (wind forcing, wave-wave interactions, wave breaking, diffraction and variation in wave direction) into the models and allow for a quantitave, reproducible approach for measuring wave exposure. Currently, no ecological studies investigating macroalgal morphological characteristics in relation to the wave environment have incorporated 3D spectral numerical modelling. Previous research investigating drivers of kelp morphological characteristics used qualitative estimates of wave exposure and did not consider other morphological characteristics. Furthermore, possible differences in morphology between shallow and deep water populations have not been considered in previous research which ignores the effects of wave damping. The aim of this study is, therefore, to understand how temperature and wave exposure can influence the morphology in two species of kelps around South Africa, as well as between deep and shallow populations of the same species. This will be achieved by initially understanding the variation in temperature and waves using advanced numerical models. These numerical models will then be used as a basis for investigating the consequences for morphological chracteristics of *E. maxima* and *L. pallida* using statistical tools. 

# Materials and methods
## Site selection

Sites were chosen to represent an array of environmental gradients, as indicated in Fig. 1. St. Helena Bay and Betty's Bay constituted the north western and south eastern boundary sites, respectively. These sites are roughly 300 km apart, and lie within separate marine provinces[3] and cover a cline in wave exposure and temperature. Study sites span across the majority of the south-west coast, in varying thermal and wave energy regimes. The region is dominated by kelp communities that persist in contrasting abiotic environments. The west coast region has been termed as a cool temperate region, which is defined as a region where mean monthly temperatures are always above 10°C and always below 15°C (Smit et al. 2013). East of Cape Point marks the beginning of an overlap or transition area, which is also referred to as the Benguela-Agulhas Transition Zone (Smit et al. 2013). The Agulhas Marine Province is characterised by a wide temperature range of up to 7°C difference between mean monthly temperatures between summer and winter and is classified as warm temperate region (Smit et al. 2013). Due to the Cape Peninsula temperate latitude, winter months bring an increased frequency of frontal depressions that originate from the Southern Ocean (Reason et al. 2006). These low pressures are joined by large swells with increased wave energy. The nearshore environment, with the accompanied biota, therefore experiences high wave energy events, with increased frequency in winter (Veitch et al. 2018). The large peninsula acts as an obstruction for large south westerly swells, providing decreased wave energy along the west side of False Bay (Shipley 1964). Conversely, the west coast of Cape Point is battered by these large swells. Multiple sites, therefore, exist where kelps grow in diverse temperature and wave energy climates, in close proximity. 

The topography and elevation along the Cape Peninsula channel and shield winds along False Bay. This is however absent in winter, where strong northerly winds are prevalent from St. Helena Bay to Betty's Bay (Field et al. 1980; Jury et al. 1985; Andrews & Hutchings 1980; Jury 1980). Patterns are also evident in the wave data. Seasonal variations in significant wave height (Hs), wave period and wave direction are also present. The direction of the dominant swell changes to the south west in winter, generated by strong low pressures that originate from the southern ocean (Reason et al. 2006), which False Bay is sheltered from (Shipley 1964; Atkins 1970; Dufois & Rouault 2012). In summer, these swells rotate anticlockwise and are able to enter False Bay, providing an increased variability of Hs and Tp in this region. It should be noted that what is classified as sheltered around the South African coastline (a high energy coastline) might be classified as exposed in other regions of the world (Norderhaug et al. 2012; Leliaert et al. 2000). It is due to the near consistent south-westerly swell and the complex orography around the peninsula that the wave energy distribution around the Cape Peninsula varies significantly over a small geographical area.

## Abiotic environment

In order to compare abiotic variables for sites around the coast, large historical databases for temperature, wave energy and wind were accessed. 

### Temperature

Shallow water temperatures were sourced from The South African Coastal Temperature Network (SACTN) website (https://github.com/ajsmit/SACTN). In terms of nearshore temperature, *in situ* data are preferred over satellite SST, which have shown to exhibit large biases (Smit et al. 2013). Linear interpolated SST were calculated for sites where *in situ* recorders were absent. These data were used to group sites into 'Cool temperate' and 'Warm temperate' categorisations to investigate the possible affect of thermal regime on kelp morphological characteristics. 

### Wave environment

Wave model variable data formed part of the South African Coastal Vulnerability Assessment, presented to the Department of Environmental Affairs (DEA) and produced by the Council for Scientific and Industrial Research (CSIR) (Rautenbach 2015). The South African wave climate was modeled via 20 spectral numerical wave models that simulated the offshore wave climate to the nearshore. The boundary conditions of these models were obtained by using the NOAA Wave Watch III (WWIII) model output, distributed via the National Centers for Environmental Prediction (NCEP) product (Office of the Director 2000; Environmental Modeling Center / Marine Modeling Branch 2005). The particular hindcast product utilised during the DEA-CSIR study spans 1994-2013 at a 3-hour resolution. These data were then used to model swell propagation into the coastal models while wind waves (seas) were generated via stationary computations in the Simulating Waves in the Nearshore SWAN model (Booij et al. 1997). The assumption of stationary computations are acceptable as the model domains were small enough so the temporal variation of the model boundary were slower than the time it takes for that boundary condition to propagate to the coast. SWAN allows one to extract wave variables from specific gridded locations in the nearshore. For False Bay, a resolution of 200 meters was modelled and output produced at both the 7 meter and 15 meter isobaths. A 200 meter resolution was used as the False Bay computational grid was nested within a larger grid (1 kilometer resolution). This allowed for a computational effective wave resolution of increasing resolution, from the NCEP, low resolution output to nested, high resolution coastal output. For Table Bay and east of Cape Hangklip the resolution was 500 meters and also had output at the 7 meters and 15 meter isobaths. These contour outputs were chosen in the original study by the CSIR as most engineering run-up calculations require wave parameter information at these contour depths and were the main focus of the original study. For this study the 7 meter contours were used. These data were then used to calculate over all wave power (kW/m) as this was considered the best measure of overall wave exposure. Annual wave power was plotted and categorised into different wave exposure categories which ranged from fully sheltered to extremely exposed.

### Collection of kelp morphological characteristics

The morphological characteristics of both species are presented in Fig. 2. *Laminaria pallida* is characterised by a single smooth blade which is divided longitudinally into sections, and develops from a single meristematic region located at the junction between the blade and the stipe (Dyer 2018). This species has a solid stipe but develops a hollow stipe along the west coast northward and into Namibia (Rothman et al. 2017). *Ecklonia maxima* consists of a single primary blade which develops above a gas-filled float and a hollow stipe below. Secondary blades are produced laterally from the primary blade from several meristematic regions along the margins of the primary blade, known as digits (Dyer 2018). Both species are held to the substrate by finger-like haptera, collectively known as the holdfast. 

```{r schematic, echo=FALSE, fig.cap='Schematic of *L. pallida* and *E. maxima* morphology.'}
library(png)
library(grid)

img <- readPNG("figures/kelp_diagram.png")
grid.raster(img)
```

Morphological measurements of *L. pallida* and *E. maxima* were collected at 18 sites along the Western Cape coast of South Africa (Fig. 1) between October 2014 and April 2015. In each instance only the largest individuals were sampled to ensure that only mature and fully grown sporophytes were measured. Thirteen samples were collected for each species at each of the sites. The morphological traits named in Tables 1 and 2 were measured for comparison between sites. Because the macroalgae differ in morphological features, species-specific morphological characteristics were included. This allowed comparison between adjacent and non-adjacent sites around the peninsula. Between February 2017 and November 2018, morphological measurements for *E. maxima* individuals in shallow water (<1m) at seven sites along the Western Cape coast of South Africa were also collected. The same morphological characteristic measurements were taken as for the deeper *E. maxima*, and this allowed comparison between morphological characteristics between deep and shallow individuals within sites. Measurements were not collected for *L. pallida* in the shallow depths, as this species is largely absent from the shallow in this portion of the South African coastline. 

## Statisical analyses 

Summary statistics were calculated for each site and regions for each of the environmental variables considered in this study. The summary statistics calculated for temperature, waves and wind variables were minimum, maximum, mean, range and standard deviation for annual timescales. In addition, annual median wave and wind direction were also calculated; all summary data and their respective abbreviation are presented in Table 3. The median was calculated for wind and wave direction, as issues arise when calculating the mean and standard deviation for compass metrics. Dot and whisker plots were used to present the summary statistics for both temperature and wave variables. Summary statistics for wind was not plotted and instead are discussed, as the data was course relative to the other environmental variables considered in this study. 

Characterisation of morphological characteristics in relation to temperature and wave exposure non-parametric statistical methods were used. Morphological characteristics were categorised according to temperature regime and wave exposure category for each each species and population of kelp in this study. Significant differences between temperatre regime and wave exposure categories were tested with wilcox tests. Notched boxplots allowed comparison between individual categories of wave exposure. In order to investigate specific drivers of morphological characteristics a distance-based redundancy analysis was performed using the *rda* function in the *vegan* software package (Oksanen et al. 2016) in R (R Core Team, 2019). The abiotic data covered all study sites for both species of kelp. Both morphology and abiotic data (temperature, waves and wind) were standardised using the *decostand* function in the *vegan* software package; morphology data were used as response variables and the abiotic data as explanatory variables. To determine the explanatory variables that best describe patterns in the response data, a full RDA was performed using a complete set of explanatory variables. Forward selection was then used to reduce the number of explanatory variables as well as prevent the inflation of overall type I error. To further improve the model, pairwise coefficients and Variance Inflation Factor (VIF) were calculated to identify variables with high multicollinearity. The computation of the parsimonious RDA was followed by permutation tests of the adjusted *R*2 to assess significance of constraints. 

# Results

```{r software packages and intial data prep, message=TRUE, warning=FALSE, include=FALSE, echo=FALSE}

library(tidyverse)
library(ggpubr)
library(gridExtra)
library(ggplot2)
library(ggord)
library(vegan)

# Ecklonia
eck_data <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop")
eck_data$site <- as.character(eck_data$site)

# Laminaria
lam_data <- read.csv("data/morph_data/lam_morph_data.csv", sep = ";") %>%
  # NB: This may also not be an appropriate change
  # Not using Rocky Bank in this study
  filter(site != "Rocky Bank")
lam_data$site <- as.character(lam_data$site)

meta_all <- read.csv("metadata/site_meta_complete.csv", sep = ";")

```

## Abiotic environment
### Temperature

The mean annual coastal water temperature for the study sites located on the western side of the peninsula ranged from 14.5 ± 0.9 ℃ (mean ± SD) at St. Helena Bay, the most northern site on the western side of the peninsula, to 14.6 ± 0.3 ℃ at Olifantsbos, the most southern site on the western side of the peninsula. For sites located on the eastern side of the peninsula (within False Bay), the annual mean coastal water temperatures ranged from 15.5 ± 0.9 ℃ at Buffelsbaai to 15.0 ± 0.9 ℃ at Betty’s Bay, the most eastern site on the coastline in this study. Oudekraal had the lowest annual mean coastal water temperature of 12.3 ± 0.9. Annual maximum coastal temperatures for study sites located on the western side of the peninsula ranged from 16.3 ℃ at St. Helena Bay to 15.1 ℃ at Olifantsbos. For sites located east of the peninsula, annual maximum coastal water temperatures ranged from 16 ℃ at Buffelsbaai to 16.5 ℃ at Betty’s Bay. Amongst all sites, Kalk Bay had the highest annual maximum temperature of 19 ℃. Annual minimum coastal water temperatures for the study sites on the western side of the peninsula ranged from 12.9 ℃ at St. Helena Bay to 14.1 ℃ at Olifantsbos, and on the western side of the peninsula ranged from 15.0 ℃ at Buffelsbaai to 13.6 ℃ at Betty’s Bay.  The annual range in temperature on the western side on the peninsula was 3.4 at St. Helena Bay to 0.9 at Olifantsbos, and on the eastern side on of the peninsula was 1.0 at Buffelsbaai to 2.9 at Betty’s Bay. As can be seen in Fig 3, the trend in the range of temperature decreases from St. Helena Bay to Miller’s point and then increases from Kalk Bay to Betty’s Bay. Also, annual range in temperatures within False Bay are larger in winter (August) compared to summer (February).

```{r Temperature data prep, message=FALSE, warning=FALSE, include=FALSE}
## Data wrangling and preparation
## Preparing data
# Complete lon/lats

# NB: (RWS) I have removed Roman Rock as this has less than a year of temperature data

# The SACTN monthly data
load("data/temp_data/SACTNmonthly_v4.1.Rdata")

# The missing site temperatures
load("data/temp_data/interp_sites.Rdata")

# The patched Roman Rock temperatures
load("data/temp_data/rr_patch.Rdata")

## Subset temperatures for collection sites
temps <- SACTNmonthly_v4.1 %>% 
  filter(site %in% eck_data$site | site %in% lam_data$site) %>% 
  select(site, date, temp) %>% 
  rbind(., interp_sites) %>% 
  filter(site!= "Roman Rock") %>% 
  rbind(., rr_patch)

## Temperature analyses
# Up next we need to calculate the relevant temperature statistics for each site. These are: #mean, range, and sd, for Annual climatology.
# Annual clims
temp_ann <- temps %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>%
  group_by(site, date) %>% 
  summarise(mean_temp = mean(temp, na.rm = T),
            min_temp = min(temp, na.rm = T),
            max_temp = max(temp, na.rm = T),
            range_temp = range(temp, na.rm = T)[2]-range(temp, na.rm = T)[1],
            sd_temp = sd(temp, na.rm = T)) %>% 
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean(., na.rm = T))) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything())
```

```{r Temperature variable processing, message=FALSE, warning=FALSE, include=FALSE}
### Plots for temperature variables 
positions_temp <- c("Betty's Bay", "Roman Rock","Kalk Bay", "A-Frame", "Miller's Point", "Baboon Rock", "Batsata Rock","Bordjies Deep","Buffelsbaai","Buffelsbaai South","Olifantsbos","Scarborough", "Soetwater", "Kommetjie","Hout Bay","Oudekraal","Sea Point","St Helena Bay")

# Annual temp
temp_plot <- ggplot(data = temp_ann, aes(x = site, y = mean_temp)) +
  geom_point() + 
  scale_x_discrete(limits = positions_temp) + 
  ylim(9, 21) + 
  geom_errorbar(aes(x = site, ymin = mean_temp - sd_temp, ymax = mean_temp + sd_temp)) + 
  geom_point(data = temp_ann, aes(x = site, y = max_temp, colour = "blue")) + 
  geom_point(data = temp_ann, aes(x = site, y = min_temp, colour = "pink")) + 
  xlab("") + 
  ylab("") + 
  theme(plot.title = element_text(hjust = 0)) +
  theme(legend.position = "none") + 
  coord_flip() 

temp_ann_meta <- merge(meta_all, temp_ann, by = "site")
temp_ann_meta$site <- as.character(temp_ann_meta$site)

temp_boxplot <- ggplot(data = temp_ann_meta, aes(x = region, y = mean_temp, fill  = region)) + 
  geom_boxplot() + 
  scale_fill_discrete(breaks=c("Western","Eastern"), name = "Region") +
  xlab("") + 
  ylab("") 
```

```{r Temperature variables plot, echo=FALSE, warning=FALSE,fig.height=5,fig.width=6, fig.cap='Temperature variables at the collection sites around the Cape Peninsula. Temperature variables include minimum represented by blue dots, mean represented by balc dots, maximum by red dots and whiskers standard deviation.'}
ggarrange(temp_plot, temp_boxplot, common.legend = FALSE, ncol = 1, nrow = 2, labels = c("AUTO"))
```

### Wave environment

Our data show the western side of the peninsula experiences higher significant wave heights and variation in wave heights compared to the eastern side of the peninsula on both an annual and seasonal scale. Annual mean significant wave height ranged from 0.5 ± 0.2 m (mean ± SD) at St. Helena Bay to 2.3  ± 0.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side of the peninsula it ranged from 0.9 ± 0.4 m at Buffelsbaai to 1.9 ± 0.6 m at Betty’s Bay. Annual mean wave peak period for sites on the western side of the peninsula ranged from 10.3 ± 3.5 s at St. Helena Bay to 11.0 ± 2.0 s at Olifantsbos, and ranged from 10.6 ± 3.0 s at Buffelsbaai to 10.8 ± 2.2 s at Betty’s Bay. The data shows no trend in mean peak wave period for the coastline. Annual peak wave period was 10.0 ± 3.0 s and 9.2 ± 3.1 s in winter and summer respectively, Miller’s point and had the lowest peak wave period amongst all sites. These data show that the western side of the peninsula has a lower variation (SD) compared to the eastern side of the peninsula, with Miller’s point showing the highest variation across timescales.  Annual maximum peak wave period ranged from 18.9 s at St. Helena Bay to 18.4 s at Olifantsbos for the western side of the peninsula, and ranged from 18.0 s at Buffelsbaai to 18.0 s at Betty’s Bay on the eastern side of the peninsula. 

```{r wave data prep, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
## Data wrangling and preparation
# Wave data 
# Load the loading functions
source("func/load.wave.R")
# Then load the data
fb_model <- load.model("data/wave_data/FB")
tb_model <- load.model("data/wave_data/TB")
he_model <- load.model("data/wave_data/HE")
sh_model <- load.model("data/wave_data/SH")

# Combine
wave_model <- rbind(fb_model, tb_model, he_model, sh_model)
rm(fb_model, tb_model)

# The site list key
wave_sites <- read_csv2("metadata/site_meta_complete.csv") %>% 
  select(site, wave_7, wave_15)
# Annual clims
wave_ann <- wave_model %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  filter(site != "FB025") %>% # FB_25 has issues with 'hs' and 'tp'
  group_by(site, date) %>% 
  summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T) %>%
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything()) %>% 
  group_by(site) %>% 
  left_join(wave_sites, by = c("site" = "wave_7")) %>% 
  ungroup() %>% 
  select(-site, wave_15) %>%
  rename(site = site.y) %>% 
  select(site, everything()) %>% 
  na.omit()

#remove useless coloumns
wave_ann <- wave_ann[-c(9,15,20,22), -c(2,23)]

wave_ann <- wave_ann %>% 
  select(site, hs_mean, hs_min, hs_max, hs_sd, tp_mean, tp_min, tp_max, tp_sd) 

# Subset directions out
dirs <- subset(wave_model, select = c(1, 2, 5, 6))

# Annual
dirs_ann <- dirs %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  group_by(site, date) %>% 
  summarise(dir_min = min(dir, na.rm = T),
            dir_max = max(dir, na.rm = T),
            dir_range = range(dir, na.rm = T)[2]-range(dir, na.rm = T)[1],
            dir_median = median(dir, na.rm = T), 
            dirw_min = min(dirw, na.rm = T),
            dirw_max = max(dirw, na.rm = T),
            dirw_range = range(dirw, na.rm = T)[2]-range(dirw, na.rm = T)[1],
            dirw_median = median(dirw, na.rm = T)) %>% 
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean(., na.rm = T))) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything())

# combine all direction metrics
dirs_ann <- dirs_ann %>% 
  group_by(site) %>% 
  gather(key = statistic, value = value, 
         3:4) %>% 
  mutate(clim_stat = paste(date, statistic, sep = "_")) %>% 
  select(-date, -statistic) %>% 
  spread(key = clim_stat, value = value) %>% 
  left_join(wave_sites, by = c("site" = "wave_7")) %>% 
  ungroup() %>% 
  select(-site, wave_15) %>%
  rename(site = site.y) %>% 
  select(site, everything()) %>% 
  na.omit()

# Combine
#these will be used later for the redudancy analysis
clim <- merge(wave_ann, dirs_ann, by = "site")  
clim <- clim[ , -c(12,13,16,17,18)]
#remove duplicate sites
clim <- clim[-c(1,6,7,8,12,18,20), ]

# merge temp and wave data to create environmental data-frame
abio_clim <- merge(temp_ann, clim, by = "site")
```

```{r wave variable processing, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
### Plots for wave variables
#Annual wave plots
#combine with meta data for easier plotting
wave_ann_meta <- merge(meta_all, wave_ann, by = "site")
wave_ann_meta$site <- as.character(wave_ann_meta$site)#make character to ensure no issues arise for site and region names

positions_wave <- c("Betty's Bay", "Roman Rock","Kalk Bay", "A-Frame", "Miller's Point", "Baboon Rock",  "Batsata Rock","Bordjies Deep","Buffelsbaai","Buffelsbaai South","Olifantsbos","Scarborough", "Soetwater", "Kommetjie","Hout Bay","Oudekraal","Sea Point","St Helena Bay")

wave_plot_A <- ggplot(data = wave_ann, aes(x = site, y = hs_mean)) +
  geom_point() + 
  scale_x_discrete(limits = positions_wave) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = hs_mean - hs_sd, ymax = hs_mean + hs_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  theme(plot.title = element_text(hjust = 0)) + 
  coord_flip()  

wave_plot_B <- ggplot(data = wave_ann, aes(x = site, y = tp_mean)) +
  geom_point() + 
  scale_x_discrete(limits = positions_wave) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = tp_mean - tp_sd, ymax = tp_mean + tp_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  theme(plot.title = element_text(hjust = 0)) + 
  coord_flip() 

wave_boxplot_1 <- ggplot(data = wave_ann_meta, aes(x = region, y = hs_mean, fill  = region)) + 
  geom_boxplot() + 
  scale_x_discrete(limit = c("Western", "Eastern")) + 
  scale_fill_discrete(name="Region") +
  stat_compare_means() + 
  xlab("") + 
  ylab("")

wave_boxplot_2 <- ggplot(data = wave_ann_meta, aes(x = region, y = tp_mean, fill  = region)) + 
  geom_boxplot() + 
  scale_x_discrete(limit = c("Western", "Eastern")) +
  scale_fill_discrete(name="Region") +
  stat_compare_means() + 
  xlab("") + 
  ylab("")
```

```{r wave variable plot, warming = FALSE, echo=FALSE, message = FALSE, include= TRUE,fig.height=7,fig.width=7, fig.cap='Wave variables at each collection site around the Western Cape coast. Mean variables are represented by dots and standard deviation by whiskers.'}
ggarrange(wave_plot_A,wave_boxplot_1, wave_plot_B, wave_boxplot_2, common.legend = TRUE, labels = c("AUTO"))
```

Our data show the western side of the peninsula experiences higher significant wave heights and variation in wave heights compared to the eastern side of the peninsula on both an annual and seasonal scale. Annual mean significant wave height ranged from 0.5 ± 0.2 m (mean ± SD) at St. Helena Bay to 2.3  ± 0.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side of the peninsula it ranged from 0.9 ± 0.4 m at Buffelsbaai to 1.9 ± 0.6 m at Betty’s Bay (Fig. 4). The annual maximum significant wave height ranged from 1.4 m at St. Helena Bay to 4.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side ranged from 2.6 m at Buffelsbaai to 4.2 m at Betty’s Bay. These wave heights and their variability are modulated by the relative sheltering against the predominant south-westerly swell direction and the size of the fetch for local wave generation. 

```{r wave rose figure, echo=FALSE, eval= FALSE, fig.cap='Wave rose figure'}

img_wave_rose <- readPNG("figures/wave_rose.png")
grid.raster(wave rose)
```
**insert wave roses here**
Annual mean wave peak period for sites on the western side of the peninsula ranged from 10.3 ± 3.5 s at St. Helena Bay to 11.0 ± 2.0 s at Olifantsbos, and ranged from 10.6 ± 3.0 s at Buffelsbaai to 10.8 ± 2.2 s at Betty’s Bay ([Fig. 4]. Annual peak wave period was 10.0 ± 3.0 s and 9.2 ± 3.1 s in winter and summer respectively, Miller’s point and had the lowest peak wave period amongst all sites. These data show that the western side of the peninsula has a lower variation (SD) compared to the eastern side of the peninsula, with Miller’s point showing the highest variation across timescales.  Annual maximum peak wave period ranged from 18.9 s at St. Helena Bay to 18.4 s at Olifantsbos for the western side of the peninsula, and ranged from 18.0 s at Buffelsbaai to 18.0 s at Betty’s Bay on the eastern side of the peninsula. Data for median wave direction showed no trend across timescales; however the variation (SD) in wave direction is lower on the western side of the peninsula compared to the eastern side both annually and for winter. Summer data were the exception and showed lower variation for the eastern side of the peninsula [Fig. 4]. Wave variables divided into Annual (top), Austral summer (middle) and Austral winter (bottom) respectively. This phenomenon can be explained by the sheltering effect of the Cape Peninsula, resulting in a wave climate with a narrower directional spreading on the eastern side of the peninsula (refer to Fig. 7). 

```{r wave power map, echo=FALSE, eval= FALSE, fig.cap='Wave power map'}

library(png)
library(grid)

img_wavepower <- readPNG("figures/CapePen_Total.PNG")
legend_wave_power <- readPNG("figures/CapePen_Legend.PNG")
grid.raster(img_wavepower,legend_wave_power)
```
**insert wave power map here**
In Figure 5 the total coastal wave exposure of the Cape Peninsula is given in terms of wave energy (kW per meter wave crest length). The directional sheltering effect of the Cape Peninsula, against the dominant swell direction is clearly observed in the wave exposures presented in [Fig. 6]. The classification from fully sheltered to extremely exposed is based on the total wave energy upper and lower limits. The western periphery of the Cape peninsula is almost continuously exposed to high wave exposures while the eastern periphery of the peninsula (western coastline of False Bay) revealed sheltered wave exposures [Fig. 6]. THere the marked seasonality, with higher energy waves during winter, may be clearly observed once more. To clarify the averaged wave exposure maps presented, the propagation of a typical offshore wave spectrum as produced from a single time-step in SWAN is presented in [Fig. 7]. Tracing the wave height contours into False Bay its clear why this bay’s western periphery is predominantly sheltered. It should be mentioned that some of the annual winter frontal depression systems pass the Cape Peninsula from the west to east, resulting in wave propagating towards the continent from much more southerly directions. This results in positive and negative wave exposure anomalies all around the peninsula.

## Drivers of kelp morphological characteristics

Significant differences were found between cool temperate and warm temperate regimes for all *L. pallida* morphological characteristics with lamina length, number of digits and thallus mass the exceptions. Certian morphological characteristics such as stipe mass, stipe length, total length and stipe diameter had significanlty higher means for kelps in cool temperate regimes when compared to kelps for the warm temperate regime. Conversely, lamina weight and lamina thickness had significantly lower means for kelps in the cool temperate regime compared to kelps in the warm temperate regime. When *L. pallida* morphological characteristics were grouped to wave exposure categories kruskal-wallis tests revealed significant differences amoungst categories for all morphological characteristics with lamina length, number of digits and thallus mass the exceptions. The morphological characteristics that were significantly different amoungst sites exibited similar patterns, with increasing mean values from the full sheltered to extremely sheltered categories and a decrease in mean values for the remainder of the categories. Two morphological characteristics, namely lamina thickness and stipe diameter, both exibit higher variations for the exposed categories compared to other morphological characteristics. 

```{r laminaria processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
#custom temperature categories position on x-axis
pos_temp <- c("Cool temperate", "Warm temperate")

#temperature and lamanaria  
LT1 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaWeight, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina weight") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT2 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina length") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT3 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaThickness, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina thickness") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT4 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT5 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT6 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeDiameter, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe diameter (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT7 <- ggplot(data = lam_data, aes(x = temp_regime, y = digits, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of digits") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT8 <- ggplot(data = lam_data, aes(x = temp_regime, y = thallusMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Thallus mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT9 <- ggplot(data = lam_data, aes(x = temp_regime, y = totalLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

lam_data$wave_exposure <- factor(lam_data$wave_exposure, levels=c("Very sheltered", "Very exposed", "Moderately exposed","Fully sheltered","Extremely sheltered"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed"))#wave exposure levels for lamanaria
pos_exposure_lam <- c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed")#custom positions

LW1 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaWeight, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina weight (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))

LW2 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))

LW3 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaThickness, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina thickness") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW4 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe mass (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW5 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW6 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeDiameter, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe diameter (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW7 <- ggplot(data = lam_data, aes(x = wave_exposure, y = digits, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("No. of digits") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW8 <- ggplot(data = lam_data, aes(x = wave_exposure, y = thallusMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Thallus mass (kg)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW9 <- ggplot(data = lam_data, aes(x = wave_exposure, y = totalLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Total length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
```

```{r laminaria temp plots, echo=FALSE, fig.cap='Boxplots of *L. pallida* morphological characteristics group by temperature regime.', fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
ggarrange(LT1, LT2,LT3,LT4,LT5,LT6,LT7,LT8,LT9, labels = c("AUTO"), common.legend = TRUE, legend = "bottom")
```

```{r lamanaria wave plots, echo=FALSE, fig.cap='Boxplots of *L. pallida* morphological characteristics group by wave exposure category.', fig.height=6, fig.width=6, warning=FALSE}
ggarrange(LW1, LW2,LW3,LW4,LW5,LW6,LW7,LW8,LW9, labels = c("AUTO"), common.legend = TRUE, legend = "bottom")
```

Six out of the ten deep *E. maxima* morphological characteristics showed differences between cool temperate and warm temperate regime except for frond mass, frond length, stipe mass and epiphyte length. Mean values for primary length, primary width and stipe circumference were significantly higher for kelps from cool temperate regions than for kelps from warm temperate regions. The remaining morphological characteristics, stipe length, number of tufts and total length had significanlty lower values for kelps from cool temperate compared to kelps from the warm temperate regime. Significant differences amoungst wave exposure categories were found for all morphological characteristics of deep *E. maxima* populations. Certian morphological characteristics showed a gradual increase in value with increasing degree of wave exposure. The remaining morphological characteristics exhibited decreased values for only the higher wave exposure categories and then a sharp increase in value for the highest wave exposure category. 

```{r deep ecklonia processing, message=FALSE, warning=FALSE, include=FALSE}
## Preparing data
# Ecklonia
# group_by(wave_exposure, frond_mass) %>% 
# summarise(mean = mean(frond_mass:total_length, na.rm = TRUE)) %>% 
# ungroup()
eck_deep <- eck_data %>% 
  filter(population == "Deep")
eck_shall <- eck_data %>% 
  filter(population == "Shallow") %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point"))
  
pos_temp <- c("Cool temperate", "Warm temperate") #custom temperature categories position on x-axis
#temperature plots made seperately for each morphological characteristic
ET1 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET2 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET3 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET4 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET5 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET6 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET7 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe circ (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
ET8 <- ggplot(data = eck_deep, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET9 <- ggplot(data = eck_deep, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET10 <- ggplot(data = eck_deep, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

eck_deep$wave_exposure <- factor(eck_deep$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"))

# custom positions for wave exposure categories and sites
pos_exposure <- c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed")
#morphology and wave exposure
EW1 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW2 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW3 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW4 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW5 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW6 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW7 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe circumference (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW8 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("No of Tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW9 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW10 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
```

```{r deep ecklonia temp plot, echo=FALSE, fig.cap='Boxplot of morphological characteristics for deep population *E. maxima* grouped by temperature.', fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
ggarrange(ET1,ET2,ET3,ET4,ET5,ET6,ET7,ET8,ET9,ET10, labels = "AUTO", common.legend = TRUE, legend = "bottom")
```

```{r deep ecklonia wave plots, echo=FALSE, fig.cap='Boxplot of morphological characteristics for deep population *E. maxima* grouped by wave exposure.', fig.height=6, fig.width=6, warning=FALSE}
ggarrange(EW1,EW2,EW3,EW4,EW5,EW6,EW7,EW8,EW9,EW10, labels = "AUTO", common.legend = TRUE, legend = "bottom")
```

```{r shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
EST1 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST2 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST3 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) + 
  ylim(0, 20)
EST4 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST5 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST6 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST7 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe circ (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(0, 30)
EST8 <- ggplot(data = eck_shall, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST9 <- ggplot(data = eck_shall, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST10 <- ggplot(data = eck_shall, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

# morphology grouped by wave exposure
eck_shall$wave_exposure <- factor(eck_shall$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"))
# custom positions for wave exposure categories and sites
pos_exposure_shall <- c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed")
#morphology and wave exposure
ESW1 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW2 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW3 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) + 
  ylim(0,25)
ESW4 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW5 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW6 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW7 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
 ylim(0,30) +
  xlab("") + 
  ylab("Stipe circumference (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW8 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("No of Tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW9 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW10 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

```

```{r shallow ecklonia temp plots, echo=FALSE, fig.cap='Boxplot of morphological characteristics for shallow population *E. maxima* grouped by temperature regime.', fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
ggarrange(EST1,EST2,EST3,EST4,EST5,EST6,EST7,EST8,EST9,EST10, labels = "AUTO", common.legend = FALSE, legend = "bottom")
```

```{r shallow rda wave plots, echo=FALSE, fig.cap='Boxplot of morphological characteristics for shallow population *E. maxima* grouped by wave exposure.', fig.height=6, fig.width=6, warning=FALSE}
ggarrange(ESW1,ESW2,ESW3,ESW4,ESW5,ESW6,ESW7,ESW8, ESW9, labels = "AUTO", common.legend = TRUE, legend = "bottom")
```

```{r rda analysis lamanaria, message=FALSE, warning=FALSE, include=FALSE}
#data processed in the temperature and wave sections will be used here eg. abio_clim
# remove unnecessary columns
lam_df <- subset(lam_data, select = -c(1,2,6))

#calculate mean values for lamanaria morphology
lam_mean <- lam_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  filter(site != "Roman Rock") %>% 
  ungroup()

#subset sites into seperate object for aligning data sets
lam_sites <- subset(lam_mean, select = c(1))

#standardise all abiotic measurements
bio_lam <- lam_mean %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

#bind site column back to dataframe
bio_lam <- cbind(lam_sites, bio_lam)

bio_lam <- bio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site lam_site to align appropriate data
abio_lam <- merge(lam_sites, abio_clim, by = "site")

#remove date column 
abio_lam <- abio_lam[ , -c(2)]

# standardise all abiotic measurements
abio_lam <- abio_lam %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

#have an issue with Miller's Point not merging so removing for now. creating temp site list for this
lam_sites_temp <- lam_sites[-c(9), ]
abio_lam <- cbind(lam_sites_temp, abio_lam)

abio_lam <- abio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")
#remove Millers from bio_lam to match up sites as I am still having issues
bio_lam <- bio_lam[-c(9), ]
#run RDA for abiotic variables
rda_all_lam <- rda(bio_lam ~ ., data = abio_lam)

#summary of rda output
summary(rda_all_lam)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_lam ~ 1, data = abio_lam),
                         scope=formula(rda_all_lam), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_lam)

#use pearson correlations to determine best abiotic variables for model
cor_lam_abio <- round(cor(abio_lam, use = "pair"), 2)
cor_lam_abio

# Parsimonious RDA
rda_lam <- rda(bio_lam ~ tp_sd + hs_mean + mean_temp + dir_median, data = abio_lam)
summary(rda_lam)
anova.cca(rda_lam, step = 1000)
anova.cca(rda_lam, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_lam)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_lam)$adj.r.squared
R2adj 

meta_lam_rda <- read.csv("metadata/site_meta_complete.csv", sep = ";")
meta_lam_rda <- merge(lam_sites, meta_lam_rda, by = "site")
meta_lam_rda <- meta_lam_rda[-c(9), ] #remove Miller's point as it is dropping during processing
  
# Plot RDA
lam_rda <- ggord(rda_lam, meta_lam_rda$region,ellipse = TRUE, hull = FALSE, grp_title = "Region", ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.9) 
```

### Abiotic drivers of *L. pallida* morphological characteristics

Forward selection, assessment of VIF and an examination of pairwise Pearson correlation coefficients allowed us to retain the most parsimonious descriptors of *L. pallida* morphological characteristics with an adjusted *R*2 of 0.49, explaining 72% of the variation (global permutation test on final model: d.f = 1, *F* = 8.51, *p* = 0.008). RDA1 was the only significant axis in the model and explained 48% of the variation while RDA2 was not significant and explained 63% of the variation. Total length, stipe length, stipe diameter and stipe mass were postivley influenced (i.e., increased size corresponding with the environmental driver) by *hs_mean* and *dir_median* for kelps mostly from the western region and negativley influenced (i.e., decreased size corresponding with the environmental driver) by *tp_sd* and *mean_temp* for kelps from the eastern region. Although sites from from the western region did not cluster as closely as eastern region study sites, grouping according to region was still evident. 

```{r rda deep ecklonia processing, message=FALSE, warning=FALSE, include=FALSE}

#filter to select only deep population ecklonia
eck_df <- eck_data %>% 
  filter(population == "Deep")

# remove unnecessary columns
eck_df <- subset(eck_df, select = -c(1,2,3,4,8,9,10))

#calculate mean values for lamanaria morphology
eck_mean <- eck_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup()

#remove St Helena Bay for now as wave model not available for that site
eck_mean <- eck_mean %>% 
  filter(site != "Miller's Point")

#subset sites into seperate object for aligning data sets
eck_sites <- subset(eck_mean, select = c(1))

#standardise all abiotic measurements
bio_eck<- eck_mean %>%
  subset(select = -c(1)) %>%
  decostand(method = "standardize")

#bind site column back to dataframe
bio_eck <- cbind(eck_sites, bio_eck)

bio_eck <- bio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_eck <- merge(eck_sites, abio_clim, by = "site")

#remove date column and extra Betty's Bay row
abio_eck <- abio_eck[ , -c(2)]

# standardise all abiotic measurements
abio_eck <- abio_eck %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

abio_eck <- cbind(eck_sites, abio_eck)

abio_eck <- abio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_eck <- rda(bio_eck ~ ., data = abio_eck)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck ~ 1, data = abio_eck),
                         scope=formula(rda_all_eck), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_eck)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck <- rda(bio_eck ~ tp_mean + hs_mean + tp_sd + min_temp + dir_median, data = abio_eck)
summary(rda_eck)
anova.cca(rda_eck, step = 1000)
anova.cca(rda_eck, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck)$adj.r.squared
R2adj 

eck_meta_rda <- merge(eck_sites, meta_all, by = "site")
eck_meta_rda <- eck_meta_rda %>% 
  filter(population == "Deep")

# Plot RDA
rda_eck_deep <- ggord(rda_eck, eck_meta_rda$region ,ellipse = TRUE, hull = FALSE, ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.95)  # looking at the raw code, this is plotting the 'wa scores', the blue 
```

### Abiotic drivers of *E. maxima* morphological characteristics

Forward selection, assessment of VIF and Pearson correlation coefficients allowed us to retained as the most parsimonious descriptors of deep *E. maxima* morphological characteristics with an adjusted *R*2 of 0.39, explaining 67% of the variation (global permutation test on final model: d.f = 5, *F* = 2.4, *p* = 0.026). RDA1 was the only significant axis in the model (p = 0.03) and explained 72% of the variation. The non-significant axis for the model explained 17% of the variation. Primary length, primary width and stipe circumference were positivley influenced by *hs_mean*, *tp_mean* and *dir_median* for for kelps from the western region. The remaining morphological characteristics were postivley inlfuenced by *min_temp* and negatively influenced by *tp_sd* for kelps from the eastern region. 

```{r rda shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE}

#filter to select only deep population ecklonia and remove Millers B and C for now...
eck_df_sh <- eck_data %>%
  filter(population == "Shallow") %>% 
  mutate(site = replace(site, site == "Miller's Point A", "Miller's Point")) %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>% 
  filter(site != "Miller's Point B") %>% 
  filter(site != "Miller's Point C") %>% 
  filter(site != "Slangkop")

# remove unnecessary columns
eck_df_sh <- subset(eck_df_sh, select = -c(1,2,3,4,8,9,10))

#calculate mean values for shallow ecklonia morphology
eck_mean_sh <- eck_df_sh %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup() 
eck_mean_sh <- eck_mean_sh %>% 
  mutate(site = replace(site, site == "Yzerfontein", "St Helena Bay")) 

#subset sites into seperate object for aligning data sets
eck_sites_sh <- subset(eck_mean_sh, select = c(1)) 

#standardise all abiotic measurements
bio_eck_sh<- eck_mean_sh %>%
   subset(select = -c(1)) %>%
   decostand(method = "standardize")  

#bind site column back to dataframe
bio_eck_sh <- cbind(eck_sites_sh, bio_eck_sh)

bio_eck_sh <- bio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_clim_v2 <- abio_clim %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>% 
  mutate(site = replace(site, site == "Bordjies Deep", "Bordjies"))
  
abio_eck_sh <- merge(abio_clim_v2, eck_sites_sh, by = "site") 

#remove date column
abio_eck_sh <- abio_eck_sh[ , -c(2)]

# standardise all abiotic measurements
abio_eck_sh <- abio_eck_sh %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize") 

abio_eck_sh <- cbind(eck_sites_sh, abio_eck_sh)

abio_eck_sh <- abio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_ecksh <- rda(bio_eck_sh ~ ., data = abio_eck_sh)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck_sh ~ 1, data = abio_eck_sh),
                         scope=formula(rda_all_ecksh), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_ecksh)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck_sh, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck_shallow <- rda(bio_eck_sh ~ mean_temp + dirw_median + tp_max + max_temp, data = abio_eck_sh)
summary(rda_eck_shallow)
anova.cca(rda_eck_shallow, step = 1000)
anova.cca(rda_eck_shallow, step = 1000, by = "axis")

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck_shallow)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck_shallow)$adj.r.squared
R2adj 

meta_all$site <- as.character(meta_all$site)
meta_shallow_rda <- meta_all %>% 
  mutate(site = replace(site, site == "Bakoven", "Sea Point")) %>%  
  mutate(site = replace(site, site == "Yzerfontein", "St Helena Bay")) %>% 
  mutate(site = replace(site, site == "Bordjies Deep", "Bordjies"))
meta_shallow_rda <- merge(meta_shallow_rda, eck_sites_sh, by = "site")

# Plot RDA
rda_eck_shallow <- ggord(rda_eck_shallow,meta_shallow_rda$region,ellipse = TRUE, hull = FALSE, grp_title = "Sites", ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.9, coord_fix = TRUE)  # looking at the raw code, this is plotting the 'wa scores', the blue 

```

```{r rda plots, echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
ggarrange(lam_rda, rda_eck_deep, rda_eck_shallow, common.legend = TRUE)
```

Forward selection, assessment of VIF and Pearson correlation coefficients allowed us to retian the most parsimonious descriptors of shallow *E. maxima* morphological characteristics with an adjusted *R*2 of 0.36, explaining 61% of the variation (global permutation test on final model: d.f = 4, *F* = 2.41, *p* = 0.013). The model consisted of one significant axis, RDA1 (p = 0.02) and explained 62% of the variation. Stipe length, stipe mass and stipe circumference were positivley influenced by *max_temp* and *mean_temp* along RDA1, and explained 50% and 55% of the variation respectivley. The remaining morphological characteristics were positivley influenced by by *tp_max* and negativley inlfuenced by *dirw_median* along RDA2 and explained 86% and 94% of the variation respectivley. There was overlapping of clusters according to region with no clear patterns in sites evident. 

# Discussion

This study considered important drivers of kelp morphology that have been identified in previous research (Fowler-Walker et al. 2006; Miller et al. 2011; Fowler-Walker et al. 2005; Stewart et al. 2009; Wing et al. 2007; Molloy & Bolton 1996; Pedersen & Nejrup 2012; Wernberg & Thomsen 2005), namely temperature and wave exposure, around the Cape Peninsula on two prolific kelp species. Unlike previous research, this study used a numerical model to provide the various variables of wave exposure. We also considered wind in addition to temperature and wave variables, since wind has been shown to influence the extension capabilities of canopy kelp species (Denny et al. 1997). Furthermore, the protrusion of the primary blade of *E. maxima* out of the water may result in some direct effects of wind-drag on morphology. The results show that wave exposure the main driver of kelp morphology with temperature and wind playing only minor roles. Furthermore, the investigation of differences in morphological characteristics between shallow and deep populations of *E. maxima *suggests that in low wave exposure environments the role of temperature as a morphological driver increases. 

The complex geomorphology of the western Cape coastline creates an ideal natural laboratory for studies of kelps in interaction with their environment. The annual and seasonal patterns in both wind influence the thermal regime around the coastline by inducing upwelling. Upwelling brings deep, cool nutrient rich water to coastal areas and therefore induces a decrease in temperature (Field et al. 1980; Andrews & Hutchings 1980; Gill & Clarke 1974; Cram 1970; Rouault et al. 2010; Blanke et al. 2002. The wind speed and wind direction help drive upwelling in summer on the western side of the Cape peninsula, where southerly winds blow parallel to the coast and trigger upwelling (Field et al. 1980; Rouault et al. 2010). This is not the case for False Bay which is shielded from the dominating wind and swell the Cape Peninsula is subject to, with the exception being the winter months where upwelling becomes more favourable for the region due to the change in swell and wind direction, causing lower temperatures to dominate during this time (Rouault et al. 2010; Andrews & Hutchings 1980). Increased wind speed at sites along the west side of the peninsula in a southerly direction trigger upwelling events along the western side of the peninsula (Rouault et al. 2010; Field et al. 1980). We however see a possible lack of upwelling events for sites such as Betty’s Bay and Batsata Rock. 

We provide strong support for the idea that variations in the environmental variables, particularly wave exposure variables, are driving kelp morphological characteristics around the Cape Peninsula. Morphological adaptation due to water motion may manifest in a number of ways in high wave energy environments. For instance, reduction of blade thickness, blade elongation, increase of stipe length, increase in stipe circumference and force of attachment (Fowler-Walker et al. 2006; Wernberg & Thomsen 2005; Friedland & Denny 1995; Denny & Roberson 2002; Bekkby et al. 2014; Denny et al. 1997; Denny & Gaylord 2002) have been suggested in previous studies. Although this study did not measure force of attachment, other morphological responses to wave variables were evident. Higher temperatures tended to be assocaited with reduced measurements of stipe mass, stipe circumference/diameter and stipe length for the sub-canopy species *L. pallida*, which suggests that there is a reduction in overall surface area of the plant in warm temperate environments. The ecological consequence of this is unclear...The canopy species *E. maxima* exibits increased stipe length and decreased stipe circumference in warm temperate areas for both deep and shallow populations, which suggests a 'slender kelp' tactic and has been shown in previous work.**add examples here**. The response of kelp morphological characteristics to wave exposure was evident and both species show a tactics based on the magnitde of wave exposure. Strength increasing traits were exibited for lower exposure levels while a 'go-with-the-flow' tactic for moderate levels of wave exposure. Denny and Galord ??? showed that increased flexiblity or a 'go-with-the-flow' tactic has a threshold value, where increased stipe length actaully increase drag under high wave exposure scenarios. Therefore, under high wave exposure scenarios size reducing traits, such as reduced surface area of the overall plant should be favoured instead. This was evident in the results which showed that stipe length decreases under high wave exposure categories. This suggests that how morphological characteristcs manifest themselves is dependent on the magnitude of wave exposure. Furthermore, the results suggest that in the absence of wave exposure, temperatre becomes the dominant morphological driver. This is evident from the redundancy analysis for each species and deep populations of *E. maxima* which show clustering of study sites according to the region; wave variables drive morphological characteristics for kelps from the western region and temperature variables for kelps from the eastern region. Clustering of sites according to region overlapped almost completey for the RDA analysis of shallow *E. maxima* suggesting that for shallow kelp the effect of wave exposure is less variable. 

# Conclusion

Past research shows that macroalgal morphological characteristics are largely driven by a wave exposure while others have suggested a complex interaction between various environmental variables. We confirm that wave variables are the main driver of kelp morphological characteristics in both *E. maxima *and *L. pallida* populations around the Cape Peninsula, and differences in shallow and deep populations of *E. maxima* may reflect small differences in wave and temperature variables as drivers of kelp morphological characteristics. 

# Conflict of Interest Statement

The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest

# Author Contributions

RC conceptualised the scope of the research reported in this paper, collected samples, undertook the majority of numerical and statistical analyses, made the first round of interpretation, and did the majority of the writing. AS and CR provided guidance in terms of  writing, statistical analyses, and the final draft of the paper, as well some writing in the relevant sections. RS aided in fieldwork and statistical analyses for the temperature data. TP performed the initial analyses and interpretation of the data.

# Funding 

The research was funded by the South African National Research Foundation ([http://www.nrf.ac.za](http://www.nrf.ac.za)) programme "Thermal characteristics of the South African nearshore:implications for biodiversity" (CPRR14072378735).

Aside from funding provided, the funders had no role in the study design, data collection and analysis, decision to publish, or preparation of the manuscript. 

# Acknowledgments

Thank you to AS and CR for their guidance, and the honours class of 2014-2015 that aided in fieldwork. Carla Louise for making the GIS plot etc. 














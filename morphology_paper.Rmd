---
title: Temperature and wave exposure as drivers of morphology in two kelp species
  along the coast of South Africa
author: "R. Coppin, C. Rautenbach, T. Ponton and A.J Smit"
geometry: margin=1in
output:
  html_notebook: default
  pdf_document:
    fig_caption: yes
    fig_crop: no
    fig_height: 7
    fig_width: 7
  html_document:
    df_print: paged
  word_document:
    reference_docx: frontiers_template.docx
papersize: A4
tables: yes
fontsize: 10pt
---

# Introduction

Kelps are a group of large seaweeds of the order Laminariales (Ochrophyta), which despite their relatively low taxonomic diversity of species in genera (Bolton 2010), nevertheless form the basis of one of the most productive ecosystems globally (Mann 1973). Kelps generally have a dependence on cool, temperate and arctic seawater temperatures (Bolton 2010; Mohring et al. 2014; Cavanaugh et al. 2011; Dayton 1985), and dominate the nearshore biomass within the rocky shallow coasts in both hemispheres (Steneck et al. 2002). Their size and complex morphology provide a heterogeneous habitat structure (Steneck et al. 2002) that accommodate a multitude of turf and subcanopy seaweed species, and diverse assemblages of sessile and mobile invertebrates and vertebrates (Mann 1973; Steneck et al. 2002), each depending on a wide suite of ecological services provided by the kelp forests (Gaines & Roughgarden 1987; Paul & Steneck 1993; Levin 1994; Willis & Anderson 2003; Anderson et al. 1997; Dayton 1985). Wave exposure and temperature are regarded as important environmental drivers of kelp forests, and play a role in the distribution (Gorman et al. 2013), abundance (Cavanaugh et al. 2011; Dayton et al. 1998), diversity (Wing et al. 2007; Wernberg & Goldberg 2008), composition (Leliaert et al. 2000; Dayton 1985; Norderhaug et al. 2012; Harley et al. 2012), growth (Cousens 1982) and productivity (Pedersen & Nejrup 2012; Dayton et al. 1998; Krumhansl & Scheibling 2012) of kelps. 

Wave exposure and temperature have also been shown to be the main drivers of morphological adaptation across various kelp species. Past research has shown that in highly wave exposed areas kelp morphology tends to take on characteristics which reduce drag, increase strength and increase flexibility (Denny & Gaylord 2002). For example, a study by Wernberg & Thomsen (2005) examined the consistency of wave exposure as a driver of *Ecklonia radiata* (C. Agardh) J. Agardh across a broad geographic range, and  showed trends towards drag-reducing (small size, narrow laterals and blades, low spinosity) and increased strength (large holdfast, thick stipe and thick blades and lamina) at high wave exposure sites. The morphological adaptation to wave exposure must be kept in balance with other important processes, such as nutrient assimilation and light absorption, which are dependent on the amount of surface area of the blades. Therefore, there is a trade-off between reducing overall drag and maintaining nutrient and photosynthetic ability. Temperature has also been shown to play a role in driving kelp morphology. For example, a study by Serisawa et al. (2002) compared the morphology of Ecklonia cava Kjellman growing in warm temperate and cool temperate morphologies. The results showed that wrinkles in the blade seem to be a characteristic of warm temperate regions. However this study did not take into account the interaction with other environmental variables such as wave exposure, which also affect kelp morphology. The morphological adapatibility of kelps is driven by a combination of environmental factors that in turn do not act independently of one another. A study by Wernberg et al. (2003) investigated the morphology of *E. radiata* in order to quantify the morphological variation and whether it was dependent on spatial differences along the Australasian coast. They found no correlation between spatial distance and morphological similarity and rather the morphology of kelps was representative of multiple environmental forcings on different morphological characters at different spatial scales (Wernberg et al. 2003). Due to the complex effects of environmental drivers on kelp morphology, one can also expect differences in morphology between deep and shallow water populations of the same species. Wave exposure may be greater in shallower environments, or it may be reduced through damping effects of kelp further offshore and natural barriers such as rock outcrops; also, seawater temperature may be higher in shallow water environments due to higher solar irradiance. 

Other species of kelp, such as *Laminaria pallida* and *Ecklonia maxima* (Osbeck) Papenfuss which are important habitat forming seaweeds that exist around the coast of South Africa, offer a unique opportunity to investigate the drivers of macroalgal morphological characteristics between deep and shallow water environments. Although both these species exist in the subtidal, *L. pallida* dominates deeper waters while *E. maxima* forms dense surface canopies in the shallower waters. Therefore, *E. maxima* is exposed to variations in wave, swell and temperature, while *L. pallida* is exposed to variations in waves and temperature. (Molloy & Bolton 1996) investigated the effect of depth and wave exposure on *L. pallida* at different depths and wave exposure and  showed that depth had a greater effect than wave exposure when considering all the morphological characteristics; when considering individual characteristics, however, wave exposure had the most significant effect on blade thickness. Another study by Rothman et al. (2017) investigated the changes in morphology in shallow populations of *L. pallida* and *E. maxima* along the South African coastline and into Namibia; *E. maxima* exhibited no morphological changes along the coast but the stipes of *L. pallida* become increasingly hollow further north along the coastline. They suggested that turbidity was the environmental driver responsible for this change. 

Measures of wave exposure in ecological studies often incorporate integrative measures of hydrodynamic conditions at a particular site which are based on cartographical models of wave exposure. Cartographical models of wave exposure are regarded as 'fetch-based-models' which measure the length of open water associated with a particular site in a straight line, and are regarded as simple measures of wave exposure. Advances in numerical modelling based on physical/linear wave theory incorporate more complexity (wind forcing, wave-wave interactions, wave breaking, diffraction and variation in wave direction) into the models and allow for a quantitave, reproducible approach for measuring wave exposure. Currently, no ecological studies investigating macroalgal communities have incorporated 3D spectral numerical modelling. Previous research investigating drivers of kelp morphological characteristics used qualitative estimates of wave exposure and did not consider other morphological characteristics. Furthermore, only shallow populations have been considered in previous research which ignores the effects of wave damping. No work currently exists where other morphological characters have been considered, quantitative estimates of environmental drivers have been calculated, and the addition of wind as a possible driver of morphological characteristics has been considered. The aim of this study is, therefore, to understand how temperature, wave exposure and wind can influence the morphology in two species of kelps around South Africa. This will be achieved by initially understanding the variation in temperature and waves and the consequences for morphological characteristics of *E. maxima* and *L. pallida*. 

# Materials and methods
## Site selection

Sites were chosen to represent an array of environmental gradients, as indicated in Fig. 1. St. Helena Bay and Betty's Bay constituted the north western and south eastern boundary sites, respectively. These sites are roughly 300 km apart, and lie within separate marine provinces[3] and cover a cline in wave exposure and temperature. Study sites  span across the majority of the south-west coast, in varying thermal and wave energy regimes. The region is dominated by kelp communities that persist in contrasting abiotic environments. The west coast region has been termed as a cool temperate region, which is defined as a region where mean monthly temperatures are always above 10°C and always below 15°C (Smit et al. 2013). East of Cape Point marks the beginning of an overlap or transition area, which is also referred to as the Benguela-Agulhas Transition Zone (Smit et al. 2013). The Agulhas Marine Province is characterised by a wide temperature range of up to 7°C difference between mean monthly temperatures between summer and winter (Smit et al. 2013). Due to the Cape Peninsula temperate latitude, winter months bring an increased frequency of frontal depressions that originate from the Southern Ocean (Reason et al. 2006). These low pressures are joined by large swells with increased wave energy. The nearshore environment, with the accompanied biota, therefore experiences high wave energy events, with increased frequency in winter (Veitch et al. 2018). The large peninsula acts as an obstruction for large south westerly swells, providing decreased wave energy along the west side of False Bay (Shipley 1964). Conversely, the west coast of Cape Point is battered by these large swells. Multiple sites, therefore, exist where kelps grow in diverse temperature and wave energy climates, in close proximity. 

The topography and elevation along the Cape Peninsula channel and shield winds along False Bay. This is however absent in winter, where strong northerly winds are prevalent from St. Helena Bay to Betty's Bay (Field et al. 1980; Jury et al. 1985; Andrews & Hutchings 1980; Jury 1980). Patterns are also evident in the wave data. Seasonal variations in significant wave height (Hs), wave period and wave direction are also present. The direction of the dominant swell changes to the south west in winter, generated by strong low pressures that originate from the southern ocean (Reason et al. 2006), which False Bay is sheltered from (Shipley 1964; Atkins 1970; Dufois & Rouault 2012). In summer, these swells rotate anticlockwise and are able to enter False Bay, providing an increased variability of Hs and Tp in this region. It should be noted that what is classified as sheltered around the South African coastline (a high energy coastline) might be classified as exposed in other regions of the world (Norderhaug et al. 2012; Leliaert et al. 2000). It is due to the near consistent south-westerly swell and the complex orography around the peninsula that the wave energy distribution around the Cape Peninsula varies significantly over a small geographical area.

## Abiotic environment
### Temperature

In order to compare abiotic variables for sites around the coast, large historical databases for temperature, wave energy and wind were accessed. Shallow water temperatures were sourced from The South African Coastal Temperature Network (SACTN) website (https://github.com/ajsmit/SACTN). In terms of nearshore temperature, in situ data are preferred over satellite SST, which have shown to exhibit large biases (Smit et al. 2013). Linear interpolated SST were calculated for sites where *in situ* recorders were absent. 

### wave environment

Wave model variable data formed part of the South African Coastal Vulnerability Assessment, presented to the Department of Environmental Affairs (DEA) and produced by the Council for Scientific and Industrial Research (CSIR) (Rautenbach 2015). The South African wave climate was modeled via 20 spectral numerical wave models that simulated the offshore wave climate to the nearshore. The boundary conditions of these models were obtained by using the NOAA Wave Watch III (WWIII) model output, distributed via the National Centers for Environmental Prediction (NCEP) product (Office of the Director 2000; Environmental Modeling Center / Marine Modeling Branch 2005). The particular hindcast product utilised during the DEA-CSIR study spans 1994-2013 at a 3-hour resolution. These data were then used to model swell propagation into the coastal models while wind waves (seas) were generated via stationary computations in the Simulating Waves in the Nearshore SWAN model (Booij et al. 1997). The assumption of stationary computations are acceptable as the model domains were small enough so the temporal variation of the model boundary were slower than the time it takes for that boundary condition to propagate to the coast.  SWAN allows one to extract wave variables from specific gridded locations in the nearshore. For False Bay, a resolution of 200 meters was modelled and output produced at both the 7 meter and 15 meter isobaths. A 200 meter resolution was used as the False Bay computational grid was nested within a larger grid (1 kilometer resolution). This allowed for a computational effective wave resolution of increasing resolution, from the NCEP, low resolution output to nested, high resolution coastal output. For Table Bay and east of Cape Hangklip the resolution was 500 meters and also had output at the 7 meters and 15 meter isobaths. These contour outputs were chosen in the original study by the CSIR as most engineering run-up calculations require wave parameter information at these contour depths and were the main focus of the original study. For this study the 7 meter contours were used. 

### Collection of kelp morphological characteristics

The morphological characteristics of both species are presented in Fig. 2. *Laminaria pallida* is characterised by a single smooth blade which is divided longitudinally into sections, and develops from a single meristematic region located at the junction between the blade and the stipe (Dyer 2018). This species has a solid stipe but develops a hollow stipe along the west coast northward and into Namibia (Rothman et al. 2017). *Ecklonia maxima* consists of a single primary blade which develops above a gas-filled float and a hollow stipe below. Secondary blades are produced laterally from the primary blade from several meristematic regions along the margins of the primary blade, known as digits (Dyer 2018). Both species are held to the substrate by finger-like haptera, collectively known as the holdfast. 

```{r echo=FALSE, fig.cap='Schematic of *E. maxima* on the left and *L. pallida* on the right. (Dyer 2018)'}
library(png)
library(grid)

img <- readPNG("figures/kelp_diagram.png")
grid.raster(img)
```

Morphological measurements of *L. pallida* and *E. maxima* were collected at 18 sites along the Western Cape coast of South Africa (Fig. 1) between October 2014 and April 2015. In each instance only the largest individuals were sampled to ensure that only mature and fully grown sporophytes were measured. Thirteen samples were collected for each species at each of the sites. The morphological traits named in Tables 1 and 2 were measured for comparison between sites. Because the macroalgae differ in morphological features, species-specific morphological characteristics were included. This allowed comparison between adjacent and non-adjacent sites around the peninsula. Between February 2017 and November 2018, morphological measurements for *E. maxima* individuals in shallow water (<1m) at seven sites along the Western Cape coast of South Africa were also collected. The same morphological characteristic measurements were taken as for the deeper *E. maxima*, and this allowed comparison between morphological characteristics between deep and shallow individuals within sites. Measurements were not collected for *L. pallida* in the shallow depths, as this species is largely absent from the shallow in this portion of the South African coastline. 

## Statisical analyses 

Site-specific summary statistics were calculated for each of the environmental variables considered in this study. The summary statistics calculated for temperature, waves and wind variables were minimum, maximum, mean, range and standard deviation for annual, February (Austral summer) and August (Austral winter) timescales, respectively. In addition, annual and seasonal median wave and wind direction were also calculated; all summary data and their respective abbreviation are presented in Table 3. The median was calculated for wind and wave direction, as issues arise when calculating the mean and standard deviation for compass metrics. Dot and whisker plots were used to present the summary statistics for both temperature and wave variables. Summary statistics for wind was not plotted and instead are discussed, as the data was course relative to the other environmental variables considered in this study. 

*insert paragraph about morphology*
Characterising and comparison of morphological characteristics between deep and shallow *E. maxima* was achieved by notched boxplots. Distance-based redundancy analysis was performed using the *rda* function in the *vegan* software package (Oksanen et al. 2016) in R (R Core Team, 2019). The role of temperature, waves and wind as drivers of kelp morphology was investigated. The abiotic data covered all study sites for both species of kelp. Both morphology and abiotic data (temperature, waves and wind) were standardised using the *decostand* function in the *vegan* software package; morphology data were used as response variables and the abiotic data as explanatory variables. To determine the explanatory variables that best describe patterns in the response data, a full RDA was performed using a complete set of explanatory variables. Forward selection was then used to reduce the number of explanatory variables as well as prevent the inflation of overall type I error. To further improve the model, pairwise coefficients and Variance Inflation Factor (VIF) were calculated to identify variables with high multicollinearity. The computation of the parsimonious RDA was followed by permutation tests of the adjusted *R*2 to assess significance of constraints. 

# Results
## Abiotic environment

The mean annual coastal water temperature for the study sites located on the western side of the peninsula ranged from 14.5 ± 0.9 ℃ (mean ± SD) at St. Helena Bay, the most northern site on the western side of the peninsula, to 14.6 ± 0.3 ℃ at Olifantsbos, the most southern site on the western side of the peninsula. For sites located on the eastern side of the peninsula (within False Bay), the annual mean coastal water temperatures ranged from 15.5 ± 0.9 ℃ at Buffelsbaai to 15.0 ± 0.9 ℃ at Betty’s Bay, the most eastern site on the coastline in this study. Oudekraal had the lowest annual mean coastal water temperature of 12.3 ± 0.9. Annual maximum coastal temperatures for study sites located on the western side of the peninsula ranged from 16.3 ℃ at St. Helena Bay to 15.1 ℃ at Olifantsbos. For sites located east of the peninsula, annual maximum coastal water temperatures ranged from 16 ℃ at Buffelsbaai to 16.5 ℃ at Betty’s Bay. Amongst all sites, Kalk Bay had the highest annual maximum temperature of 19 ℃. Annual minimum coastal water temperatures for the study sites on the western side of the peninsula ranged from 12.9 ℃ at St. Helena Bay to 14.1 ℃ at Olifantsbos, and on the western side of the peninsula ranged from 15.0 ℃ at Buffelsbaai to 13.6 ℃ at Betty’s Bay.  The annual range in temperature on the western side on the peninsula was 3.4 at St. Helena Bay to 0.9 at Olifantsbos, and on the eastern side on of the peninsula was 1.0 at Buffelsbaai to 2.9 at Betty’s Bay. As can be seen in Fig 3, the trend in the range of temperature decreases from St. Helena Bay to Miller’s point and then increases from Kalk Bay to Betty’s Bay. Also, annual range in temperatures within False Bay are larger in winter (August) compared to summer (February).

```{r software packages, message=TRUE, warning=FALSE, include=FALSE, echo=FALSE}
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(ggplot2)
library(ggord)
library(vegan)
```

```{r Temperature data prep, message=FALSE, warning=FALSE, include=FALSE}
## Data wrangling and preparation
## Preparing data
# Complete lon/lats
kelp_sites <- read.csv("metadata/site_meta_complete.csv", sep = ";")

# Ecklonia
eck_data <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop")

# Laminaria
lam_data <- read.csv("data/morph_data/lam_morph_data.csv", sep = ";") %>%
  mutate(site = replace(site, site == "Buffels Bay", "Buffelsbaai")) %>%
  # NB: Even though I am changing the name, there will still be no lon/lat values for this site
  # We need to decide how we want to handle this. Give it the same lon/lat as Buffelsbaai?
  mutate(site = replace(site, site == "Buffels Bay South", "Buffelsbaai South")) %>%
  # NB: This may also not be an appropriate change
  mutate(site = replace(site, site == "Bordjies reef North", "Bordjies Deep")) %>%
  # Not using Rocky Bank in this study
  filter(site != "Rocky Bank")

# NB: (RWS) I have removed Roman Rock as this has less than a year of temperature data

# The SACTN monthly data
load("data/temp_data/SACTNmonthly_v4.1.Rdata")

# The missing site temperatures
load("data/temp_data/interp_sites.Rdata")

# The patched Roman Rock temperatures
load("data/rr_patch.Rdata")

## Subset temperatures for collection sites
temps <- SACTNmonthly_v4.1 %>% 
  filter(site %in% eck_data$site | site %in% lam_data$site) %>% 
  select(site, date, temp) %>% 
  rbind(., interp_sites) %>% 
  filter(site!= "Roman Rock") %>% 
  rbind(., rr_patch)

## Temperature analyses
# Up next we need to calculate the relevant temperature statistics for each site. These are: #mean, range, and sd, for Annual, February, and August climatologies.
# Monthly clims

temp_feb_aug <- temps %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  group_by(site, date) %>% 
  summarise(mean_temp = mean(temp, na.rm = T),
            min_temp = min(temp, na.rm = T),
            max_temp = max(temp, na.rm = T),
            range_temp = range(temp, na.rm = T)[2]-range(temp, na.rm = T)[1],
            sd_temp = sd(temp, na.rm = T)) %>%
  filter(date %in% c("Feb", "Aug")) %>% 
  ungroup()

# Annual clims
temp_ann <- temps %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>%
  group_by(site, date) %>% 
  summarise(mean_temp = mean(temp, na.rm = T),
            min_temp = min(temp, na.rm = T),
            max_temp = max(temp, na.rm = T),
            range_temp = range(temp, na.rm = T)[2]-range(temp, na.rm = T)[1],
            sd_temp = sd(temp, na.rm = T)) %>% 
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean(., na.rm = T))) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything())

# Combine
temp_clim <- rbind(temp_feb_aug, temp_ann) %>% 
  group_by(site) %>% 
  gather(key = statistic, value = value, 
         mean_temp:sd_temp) %>% 
  mutate(clim_stat = paste(date, statistic, sep = "_")) %>% 
  select(-date, -statistic) %>% 
  spread(key = clim_stat, value = value)
```

```{r Temperature variable processing, message=FALSE, warning=FALSE, include=FALSE}
### Plots for temperature variables 
positions_temp <- c("Betty's Bay", "Roman Rock","Kalk Bay", "A-Frame", "Miller's Point", "Baboon Rock",  "Batsata Rock", "Buffelsbaai","Buffelsbaai South","Olifantsbos","Scarborough", "Soetwater", "Kommetjie","Hout Bay","Oudekraal","Sea Point","De Hoop", "St Helena Bay")

# Annual temp
temp_plot <- ggplot(data = temp_ann, aes(x = site, y = mean_temp)) +
  geom_point() + 
  scale_x_discrete(limits = positions_temp) + 
  ylim(8, 22) + 
  geom_errorbar(aes(x = site, ymin = mean_temp - sd_temp, ymax = mean_temp + sd_temp)) + 
  geom_point(data = temp_ann, aes(x = site, y = max_temp, colour = "blue")) + 
  geom_point(data = temp_ann, aes(x = site, y = min_temp, colour = "pink")) + 
  xlab("") + 
  ylab("") + 
  theme(plot.title = element_text(hjust = 0)) +
  theme(legend.position = "none") + 
  coord_flip() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())

```

```{r Temperature variables plot, echo=FALSE, warning=FALSE, fig.cap='Temperature variables at the collection sites around the Cape Peninsula. Temperature variables include minimum represented by blue dots, mean represented by balc dots, maximum by red dots and whiskers standard deviation.'}
temp_plot
```


```{r wave data prep, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
## Data wrangling and preparation
# Wave data 
# Load the loading functions
source("func/load.wave.R")
# Then load the data
fb_model <- load.model("data/wave_data/FB")
tb_model <- load.model("data/wave_data/TB")
he_model <- load.model("data/wave_data/HE")
sh_model <- load.model("data/wave_data/SH")

# Combine
wave_model <- rbind(fb_model, tb_model, he_model, sh_model)
rm(fb_model, tb_model)

# The site list key
wave_sites <- read_csv2("metadata/site_meta_complete.csv") %>% 
  select(site, wave_7, wave_15)

# Calculate the necessary stats
# Monthly clims
wave_feb_aug <- wave_model %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  filter(site != "FB025") %>% # FB_25 has issues with 'hs' and 'tp'
  group_by(site, date) %>% 
  summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T) %>%
  filter(date %in% c("Feb", "Aug")) %>% 
  ungroup()

# Annual clims
wave_ann <- wave_model %>% 
  mutate(date = lubridate::month(date, label = TRUE)) %>% 
  filter(site != "FB025") %>% # FB_25 has issues with 'hs' and 'tp'
  group_by(site, date) %>% 
  summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T) %>%
  ungroup() %>% 
  select(-date) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  mutate(date = "Ann") %>% 
  select(site, date, everything()) %>% 
  group_by(site) %>% 
  left_join(wave_sites, by = c("site" = "wave_7")) %>% 
  ungroup() %>% 
  select(-site, wave_15) %>%
  rename(site = site.y) %>% 
  select(site, everything()) %>% 
  na.omit()

wave_ann <- wave_ann[-c(9,15,20,22), -c(2,23)]

#remove useless coloumns
wave_ann <- wave_ann %>% 
  select(site, hs_mean, hs_min, hs_max, hs_sd, tp_mean, tp_min, tp_max, tp_sd) 
```

```{r wave variable processing, warning=FALSE, include=FALSE, echo = FALSE, message=FALSE}
### Plots for wave variables
#Annual wave plots
pos_temp <- c("Cool temperate", "Warm temperate")

wave_plot_A <- ggplot(data = wave_ann, aes(x = site, y = hs_mean)) +
  geom_point() + 
  scale_x_discrete(limits = positions_temp) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = hs_mean - hs_sd, ymax = hs_mean + hs_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  theme(plot.title = element_text(hjust = 0)) + 
  coord_flip() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())  

wave_plot_B <- ggplot(data = wave_ann, aes(x = site, y = tp_mean)) +
  geom_point() + 
  scale_x_discrete(limits = positions_temp) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5)) +
  geom_errorbar(aes(x = site, ymin = tp_mean - tp_sd, ymax = tp_mean + tp_sd)) + 
  xlab("") + 
  ylab("") + 
  theme(legend.position = "none") + 
  theme(plot.title = element_text(hjust = 0)) + 
  coord_flip() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())  
```

```{r wave variable plot, warming = FALSE, echo=FALSE, message = FALSE, include= TRUE, fig.cap='Wave variables at each collection site around the Western Cape coast. Mean variables are represented by dots and standard deviation by whiskers.'}
ggarrange(wave_plot_A, wave_plot_B, ncol = 2, nrow = 1)
```

Our data show the western side of the peninsula experiences higher significant wave heights and variation in wave heights compared to the eastern side of the peninsula on both an annual and seasonal scale. Annual mean significant wave height ranged from 0.5 ± 0.2 m (mean ± SD) at St. Helena Bay to 2.3  ± 0.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side of the peninsula it ranged from 0.9 ± 0.4 m at Buffelsbaai to 1.9 ± 0.6 m at Betty’s Bay (Fig. 4). The annual maximum significant wave height ranged from 1.4 m at St. Helena Bay to 4.7 m at Olifantsbos on the western side of the peninsula, and on the eastern side ranged from 2.6 m at Buffelsbaai to 4.2 m at Betty’s Bay. These wave heights and their variability are modulated by the relative sheltering against the predominant south-westerly swell direction and the size of the fetch for local wave generation. 

Annual mean wave peak period for sites on the western side of the peninsula ranged from 10.3 ± 3.5 s at St. Helena Bay to 11.0 ± 2.0 s at Olifantsbos, and ranged from 10.6 ± 3.0 s at Buffelsbaai to 10.8 ± 2.2 s at Betty’s Bay ([Fig. 4]. Annual peak wave period was 10.0 ± 3.0 s and 9.2 ± 3.1 s in winter and summer respectively, Miller’s point and had the lowest peak wave period amongst all sites. These data show that the western side of the peninsula has a lower variation (SD) compared to the eastern side of the peninsula, with Miller’s point showing the highest variation across timescales.  Annual maximum peak wave period ranged from 18.9 s at St. Helena Bay to 18.4 s at Olifantsbos for the western side of the peninsula, and ranged from 18.0 s at Buffelsbaai to 18.0 s at Betty’s Bay on the eastern side of the peninsula. Data for median wave direction showed no trend across timescales; however the variation (SD) in wave direction is lower on the western side of the peninsula compared to the eastern side both annually and for winter. Summer data were the exception and showed lower variation for the eastern side of the peninsula [Fig. 4]. Wave variables divided into Annual (top), Austral summer (middle) and Austral winter (bottom) respectively. This phenomenon can be explained by the sheltering effect of the Cape Peninsula, resulting in a wave climate with a narrower directional spreading on the eastern side of the peninsula (refer to Fig. 7). 

**Insert wave exposure maps here**

In Figure 5 the total coastal wave exposure of the Cape Peninsula is given in terms of wave energy (kW per meter wave crest length). The directional sheltering effect of the Cape Peninsula, against the dominant swell direction is clearly observed in the wave exposures presented in [Fig. 6]. The classification from fully sheltered to extremely exposed is based on the total wave energy upper and lower limits. The western periphery of the Cape peninsula is almost continuously exposed to high wave exposures while the eastern periphery of the peninsula (western coastline of False Bay) revealed sheltered wave exposures [Fig. 6]. THere the marked seasonality, with higher energy waves during winter, may be clearly observed once more. To clarify the averaged wave exposure maps presented, the propagation of a typical offshore wave spectrum as produced from a single time-step in SWAN is presented in [Fig. 7]. Tracing the wave height contours into False Bay its clear why this bay’s western periphery is predominantly sheltered. It should be mentioned that some of the annual winter frontal depression systems pass the Cape Peninsula from the west to east, resulting in wave propagating towards the continent from much more southerly directions. This results in positive and negative wave exposure anomalies all around the peninsula.

## Drivers of kelp morphological characteristics

```{r laminaria processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
#custom temperature categories position on x-axis
pos_temp <- c("Cool temperate", "Warm temperate")

#temperature and lamanaria  
LT1 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaWeight, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina weight") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT2 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina length") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT3 <- ggplot(data = lam_data, aes(x = temp_regime, y = laminaThickness, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Lamina thickness") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT4 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT5 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT6 <- ggplot(data = lam_data, aes(x = temp_regime, y = stipeDiameter, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe diameter (cm)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT7 <- ggplot(data = lam_data, aes(x = temp_regime, y = digits, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of digits") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT8 <- ggplot(data = lam_data, aes(x = temp_regime, y = thallusMass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Thallus mass (g)") +
  scale_fill_discrete(name="Temperature regime") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
LT9 <- ggplot(data = lam_data, aes(x = temp_regime, y = totalLength, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE, show.legend = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

lam_data$wave_exposure <- factor(lam_data$wave_exposure, levels=c("Very sheltered", "Very exposed", "Moderately exposed","Fully sheltered","Extremely sheltered"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed"))#wave exposure levels for lamanaria
pos_exposure_lam <- c("Fully sheltered", "Extremely sheltered", "Very sheltered", "Moderately exposed", "Very exposed")#custom positions

LW1 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaWeight, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina weight (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))

LW2 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))

LW3 <- ggplot(data = lam_data, aes(x = wave_exposure, y = laminaThickness, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Lamina thickness") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW4 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe mass (g)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW5 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW6 <- ggplot(data = lam_data, aes(x = wave_exposure, y = stipeDiameter, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Stipe diameter (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW7 <- ggplot(data = lam_data, aes(x = wave_exposure, y = digits, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam)  + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("No. of digits") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW8 <- ggplot(data = lam_data, aes(x = wave_exposure, y = thallusMass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Thallus mass (kg)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

LW9 <- ggplot(data = lam_data, aes(x = wave_exposure, y = totalLength, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_lam) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) +
  stat_compare_means(method = "kruskal.test") + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylab("Total length (cm)") + 
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
```

```{r laminaria plots, echo=FALSE, fig.cap='Boxplots of *L. pallida* morphological characteristics group by temperature regime and wave exposure category.', message=FALSE, warning=FALSE, include=FALSE}
ggarrange(LT1, LT2,LT3,LT4,LT5,LT6,LT7,LT8,LT9, LW1, LW2,LW3,LW4,LW5,LW6,LW7,LW8,LW9, labels = c("AUTO"), common.legend = FALSE, legend = "bottom")
```


```{r deep ecklonia processing, message=FALSE, warning=FALSE, include=FALSE}
## Preparing data
# Ecklonia
eck_data <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop")  
# group_by(wave_exposure, frond_mass) %>% 
# summarise(mean = mean(frond_mass:total_length, na.rm = TRUE)) %>% 
# ungroup()
eck_deep <- eck_data %>% 
  filter(population == "Deep")
eck_shall <- eck_data %>% 
  filter(population == "Shallow")
pos_temp <- c("Cool temperate", "Warm temperate") #custom temperature categories position on x-axis
#temperature plots made seperately for each morphological characteristic
ET1 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET2 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET3 <- ggplot(data = eck_deep, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET4 <- ggplot(data = eck_deep, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET5 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET6 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET7 <- ggplot(data = eck_deep, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe circ (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
ET8 <- ggplot(data = eck_deep, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET9 <- ggplot(data = eck_deep, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
ET10 <- ggplot(data = eck_deep, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

eck_deep$wave_exposure <- factor(eck_deep$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed"))

# custom positions for wave exposure categories and sites
pos_exposure <- c("Fully sheltered", "Extremely sheltered", "Very sheltered","Moderately exposed", "Exposed", "Very exposed")
#morphology and wave exposure
EW1 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW2 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW3 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW4 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW5 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW6 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW7 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe circumference (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW8 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("No of Tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
EW9 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
EW10 <- ggplot(data = eck_deep, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
```

```{r deep ecklonia plot, message=FALSE, warning= FALSE, fig.cap ='Boxplot of morphological characteristics for deep population *E. maxima* grouped by temperature regime and wave exposure.'}
ggarrange(ET1,ET2,ET3,ET4,ET5,ET6,ET7,ET8,ET9,ET10,EW1,EW2,EW3,EW4,EW5,EW6,EW7,EW8,EW9,EW10, labels = "AUTO", common.legend = FALSE, legend = "bottom")
```


```{r shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
EST1 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST2 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST3 <- ggplot(data = eck_shall, aes(x = temp_regime, y = primary_width, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) + 
  ylim(0, 20)
EST4 <- ggplot(data = eck_shall, aes(x = temp_regime, y = frond_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST5 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_mass, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST6 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST7 <- ggplot(data = eck_shall, aes(x = temp_regime, y = stipe_circ, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Stipe circ (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  ylim(0, 30)
EST8 <- ggplot(data = eck_shall, aes(x = temp_regime, y = tufts, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("No. of tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST9 <- ggplot(data = eck_shall, aes(x = temp_regime, y = epi_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 
EST10 <- ggplot(data = eck_shall, aes(x = temp_regime, y = total_length, fill = temp_regime)) +
  scale_x_discrete(limits = pos_temp) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "wilcox.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) 

# morphology grouped by wave exposure
eck_shall$wave_exposure <- factor(eck_shall$wave_exposure, levels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"), labels=c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed"))
# custom positions for wave exposure categories and sites
pos_exposure_shall <- c("Fully sheltered", "Extremely sheltered", "Sheltered", "Exposed", "Very exposed")
#morphology and wave exposure
ESW1 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW2 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW3 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = primary_width, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Primary width (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) + 
  ylim(0,25)
ESW4 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = frond_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Frond length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW5 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_mass, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe mass (g)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW6 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW7 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = stipe_circ, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Stipe circumference (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW8 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = tufts, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("No of Tufts") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level"))  
ESW9 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = epi_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA)  + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Epi length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 
ESW10 <- ggplot(data = eck_shall, aes(x = wave_exposure, y = total_length, fill = wave_exposure)) +
  scale_x_discrete(limits = pos_exposure_shall) + 
  geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = FALSE) + 
  stat_compare_means(method = "kruskal.test") + 
  xlab("") + 
  ylab("Total length (cm)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  scale_fill_brewer(palette="OrRd") +
  guides(fill=guide_legend(title="Wave exposure level")) 

```

```{r shallow ecklonia temp plots, echo=FALSE, message=FALSE, warning=FALSE, fig.cap ='Boxplot of morphological characteristics for shallow population *E. maxima* grouped by temperature regime and wave exposure.'}
ggarrange(EST1,EST2,EST3,EST4,EST5,EST6,EST7,EST8,EST9,EST10, ESW1,ESW2,ESW3,ESW4,ESW5,ESW6,ESW7,ESW8, ESW9, labels = "AUTO", common.legend = FALSE, legend = "bottom")
```

```{r rda analysis lamanaria, include=FALSE}

# remove unnecessary columns
lam_df <- subset(lam_data, select = -c(1,2,6))

#calculate mean values for lamanaria morphology
lam_mean <- lam_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup()

#subset sites into seperate object for aligning data sets
lam_sites <- subset(lam_mean, select = c(1))

#remove Bordjies North from data-frame
lam_mean <- lam_mean[-c(5),] 

lam_meta <- kelp_sites %>% 
  filter(population == "Deep") %>% 
  filter(species == "Both") 
  
lam_meta <- merge(lam_sites, kelp_sites, by = "site")
#drop useless columns
lam_meta <- lam_meta[-c(1,9,11), ]

#standardise all abiotic measurements
bio_lam <- lam_mean %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

#subset sites into seperate object for aligning data sets
lam_sites <- subset(lam_mean, select = c(1))

#bind site column back to dataframe
bio_lam <- cbind(lam_sites, bio_lam)

bio_lam <- bio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#subset sites into seperate object for aligning data sets
lam_sites <- subset(lam_mean, select = c(1))

# merge temp and wave data to create environmental data-frame
abio_clim <- merge(temp_ann, wave_ann, by = "site")

#use site lam_site to align appropriate data
abio_lam <- merge(lam_sites, abio_clim, by = "site")

#remove date column
abio_lam <- abio_lam[ , -c(2)]

# standardise all abiotic measurements
abio_lam <- abio_lam %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

abio_lam <- cbind(lam_sites, abio_lam)

abio_lam <- abio_lam %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_lam <- rda(bio_lam ~ ., data = abio_lam)

#summary of rda output
summary(rda_all_lam)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_lam ~ 1, data = abio_lam),
                         scope=formula(rda_all_lam), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
#vif.cca(rda_all_lam)

#use pearson correlations to determine best abiotic variables for model
cor_lam_abio <- round(cor(abio_lam, use = "pair"), 2)
cor_lam_abio

# Parsimonious RDA
rda_lam <- rda(bio_lam ~ tp_sd + max_temp + hs_mean, data = abio_lam)
summary(rda_lam)

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_lam)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_lam)$adj.r.squared
R2adj 

```

```{r rda plot lamanaria, echo=FALSE, message=FALSE, warning=FALSE}
# Plot RDA
ggord(rda_lam, lam_meta$region, ellipse = FALSE, hull = FALSE, grp_title = "Region", ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.9)  
```

```{r rda ecklonia processing, echo=FALSE, message=FALSE, warning=FALSE}

#filter to select only deep population ecklonia
eck_df <- eck_data %>% 
  filter(population == "Deep")

# remove unnecessary columns
eck_df <- subset(eck_df, select = -c(1,2,3,4,8,9,10))

#calculate mean values for lamanaria morphology
eck_mean <- eck_df %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup()

#remove St Helena Bay for now as wave model not available for that site
eck_mean <- eck_mean[-c(13), ]

#subset sites into seperate object for aligning data sets
eck_sites <- subset(eck_mean, select = c(1))

#remove Miller's Point site as it is causing issues, also this keeps the amount of western and eastern sites more balanced
eck_sites <- eck_sites %>% 
  filter(site != "Miller's Point")

eck_meta <- read.csv("metadata/eck_meta.csv", sep = ";") 
eck_meta <- eck_meta %>% 
  filter(population == "Deep") %>% 
  mutate(site = replace(site, site == "Miller's Point", "Miller's Point"))

eck_meta <- merge(eck_meta, eck_sites,  by = "site")

#standardise all abiotic measurements
bio_eck<- eck_mean %>%
  filter(site != "Miller's Point") %>% 
  subset(select = -c(1)) %>%
  decostand(method = "standardize")

#bind site column back to dataframe
bio_eck <- cbind(eck_sites, bio_eck)

bio_eck <- bio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_eck <- merge(eck_sites, abio_clim, by = "site")

#remove date column
abio_eck <- abio_eck[ , -c(2)]

# standardise all abiotic measurements
abio_eck <- abio_eck %>%
  filter(site != "Miller's Point") %>% 
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

abio_eck <- cbind(eck_sites, abio_eck)

abio_eck <- abio_eck %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_eck <- rda(bio_eck ~ ., data = abio_eck)

#summary of rda output
summary(rda_all_eck)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck ~ 1, data = abio_eck),
                         scope=formula(rda_all_eck), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
vif.cca(rda_all_eck)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck <- rda(bio_eck ~ tp_mean + hs_mean + tp_sd + hs_sd + mean_temp, data = abio_eck)
summary(rda_eck)

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck)$adj.r.squared
R2adj 

# Plot RDA
ggord(rda_eck, eck_meta$region, ellipse = FALSE, hull = FALSE, grp_title = "Sites", ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.95)  # looking at the raw code, this is plotting the 'wa scores', the blue 
```

```{r rda shallow ecklonia processing, message=FALSE, warning=FALSE, include=FALSE}

#filter to select only deep population ecklonia and remove Millers B and C for now...
eck_df_sh <- eck_data %>% 
  filter(population == "Shallow") %>% 
  filter(site != "Miller's Point B") %>% 
  filter(site != "Miller's Point C")

# remove unnecessary columns
eck_df_sh <- subset(eck_df_sh, select = -c(1,2,3,4,8,9,10))

#calculate mean values for lamanaria morphology
eck_mean_sh <- eck_df_sh %>% 
  subset(select = -c(1,2)) %>% 
  group_by(site) %>% 
  summarise_all(funs(mean), na.rm = T) %>% 
  ungroup()

#subset sites into seperate object for aligning data sets
eck_sites_sh <- subset(eck_mean_sh, select = c(1))

eck_meta_sh <- read.csv("metadata/eck_meta.csv", sep = ";") 
eck_meta_sh <- eck_meta_sh %>% 
  filter(population == "Shallow") 

eck_meta_sh <- merge(eck_meta_sh, eck_sites_sh,  by = "site")

#standardise all abiotic measurements
bio_eck_sh<- eck_mean_sh %>%
  subset(select = -c(1)) %>%
  decostand(method = "standardize")

#bind site column back to dataframe
bio_eck_sh <- cbind(eck_sites_sh, bio_eck_sh)

bio_eck_sh <- bio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#use site eck_site to align appropriate data from abio_clim data from the lamanaria processing section
abio_eck_sh <- merge(eck_sites_sh, abio_clim, by = "site")

#remove date column
abio_eck_sh <- abio_eck_sh[ , -c(2)]

# standardise all abiotic measurements
abio_eck_sh <- abio_eck_sh %>%
  subset(select = -c(1)) %>% 
  decostand(method = "standardize")

abio_eck_sh <- cbind(eck_sites_sh, abio_eck_sh)

abio_eck_sh <- abio_eck_sh %>%
  remove_rownames %>%
  column_to_rownames(var = "site")

#run RDA for abiotic variables
rda_all_eck <- rda(bio_eck_sh ~ ., data = abio_eck_sh)

#summary of rda output
summary(rda_all_eck)

# Forward selection using vegan's ordistep
# Note that is function does not use R^2adjusted-based stopping criterion

step.forward <- ordistep(rda(bio_eck ~ 1, data = abio_eck),
                         scope=formula(rda_all_eck), direction = "forward", pstep = 1000)
#calculate variance inlfation factor
vif.cca(rda_all_eck)

#use pearson correlations to determine best abiotic variables for model
cor_eck_abio <- round(cor(abio_eck, use = "pair"), 2)
cor_eck_abio

# Parsimonious RDA
rda_eck <- rda(bio_eck ~ tp_mean + hs_mean + tp_sd + hs_sd + mean_temp, data = abio_eck)
summary(rda_eck)

#visual screenshot of rda axes to help determine which axes explain the most variation
screeplot(rda_eck)

#retreive adjusted R2 value which measures the unbiased amount of explained variation
R2adj <- RsquareAdj(rda_eck)$adj.r.squared
R2adj 

# Plot RDA
ggord(rda_eck, eck_meta$region, ellipse = FALSE, hull = FALSE, grp_title = "Sites", ptslab = TRUE, parse = TRUE, addsize = 3.5, ext = 0.95)  # looking at the raw code, this is plotting the 'wa scores', the blue 






```

# Discussion

This study considered important drivers of kelp morphology that have been identified in previous research (Fowler-Walker et al. 2006; Miller et al. 2011; Fowler-Walker et al. 2005; Stewart et al. 2009; Wing et al. 2007; Molloy & Bolton 1996; Pedersen & Nejrup 2012; Wernberg & Thomsen 2005), namely temperature and wave exposure, around the Cape Peninsula on two prolific kelp species. Unlike previous research, this study used a numerical model to provide the various variables of wave exposure. We also considered wind in addition to temperature and wave variables, since wind has been shown to influence the extension capabilities of canopy kelp species (Denny et al. 1997). Furthermore, the protrusion of the primary blade of *E. maxima* out of the water may result in some direct effects of wind-drag on morphology. The results show that wave exposure the main driver of kelp morphology with temperature and wind playing only minor roles. Furthermore, the investigation of differences in morphological characteristics between shallow and deep populations of *E. maxima *suggests that in low wave exposure environments the role of temperature as a morphological driver increases. 

The complex geomorphology of the western Cape coastline creates an ideal natural laboratory for studies of kelps in interaction with their environment. This complex coastal environment created by the coastal wind and wave climate creates an ideal opportunity to explore the effects of waves and the thermal regime on the morphological development of kelp. The annual and seasonal patterns in both wind influence the thermal regime around the coastline by inducing upwelling. Upwelling brings deep, cool nutrient rich water to coastal areas and therefore induces a decrease in temperature (Field et al. 1980; Andrews & Hutchings 1980; Gill & Clarke 1974; Cram 1970; Rouault et al. 2010; Blanke et al. 2002. The wind speed and wind direction help drive upwelling in summer on the western side of the Cape peninsula, where southerly winds blow parallel to the coast and trigger upwelling (Field et al. 1980; Rouault et al. 2010). This is not the case for False Bay which is shielded from the dominating wind and swell the Cape Peninsula is subject to, with the exception being the winter months where upwelling becomes more favourable for the region due to the change in swell and wind direction, causing lower temperatures to dominate during this time (Rouault et al. 2010; Andrews & Hutchings 1980). Increased wind speed at sites along the west side of the peninsula in a southerly direction trigger upwelling events along the western side of the peninsula (Rouault et al. 2010; Field et al. 1980). We however see a possible lack of upwelling events for sites such as Betty’s Bay and Batsata Rock. 

We provide strong support for the idea that variations in the environmental variables, particularly wave exposure variables, are driving kelp morphological characteristics around the Cape Peninsula. Morphological adaptation due to water motion may manifest in a number of ways in high wave energy environments. For instance, reduction of blade thickness, blade elongation, increase of stipe length, increase in stipe circumference and force of attachment (Fowler-Walker et al. 2006; Wernberg & Thomsen 2005; Friedland & Denny 1995; Denny & Roberson 2002; Bekkby et al. 2014; Denny et al. 1997; Denny & Gaylord 2002) have been suggested in previous studies. Although this study did not measure force of attachment, other morphological responses to wave variables were evident. 

# Conclusion

Past research shows that macroalgal morphological characteristics are largely driven by a wave exposure while others have suggested a complex interaction between various environmental variables. We confirm that wave variables are the main driver of kelp morphological characteristics in both *E. maxima *and *L. pallida* populations around the Cape Peninsula, and differences in shallow and deep populations of *E. maxima* may reflect small differences in wave and temperature variables as drivers of kelp morphological characteristics. 

# Conflict of Interest Statement

The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest

# Author Contributions

RC conceptualised the scope of the research reported in this paper, collected samples, undertook the majority of numerical and statistical analyses, made the first round of interpretation, and did the majority of the writing. AS and CR provided guidance in terms of  writing, statistical analyses, and the final draft of the paper, as well some writing in the relevant sections. RS aided in fieldwork and statistical analyses for the temperature data. TP performed the initial analyses and interpretation of the data.

# Funding 

The research was funded by the South African National Research Foundation ([http://www.nrf.ac.za](http://www.nrf.ac.za)) programme "Thermal characteristics of the South African nearshore:implications for biodiversity" (CPRR14072378735).

Aside from funding provided, the funders had no role in the study design, data collection and analysis, decision to publish, or preparation of the manuscript. 

# Acknowledgments

Thank you to AS and CR for their guidance, and the honours class of 2014-2015 that aided in fieldwork. Carla Louise for making the GIS plot etc. 














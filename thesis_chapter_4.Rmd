---
title: "Chapter 4"
author: "Ross Coppin"
date: "11/12/2020"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r message=FALSE, warning=FALSE, include=FALSE}

library(tidyverse)
library(flextable)
library(tidync)
library(ncdf4)
library(lubridate)
library(gridExtra)
library(ggpubr)
library(jpeg)
library(gridExtra)

```

# Introduction

The raft-time is the amount of time macroalgae floats at the surface before becoming negatively buoyant and begins to sink to the ocean-floor. Raft-time, also referred to as raft longevity, is determined by epibiont load, macroalgal growth rate and the loss of kelp biomass over time through fragmentation. Epibiont load consists of epiphytic and bryozoan species which tend to grow more rapidly in higher light and temperature environments, such as the ocean surface [@thiel2005; @thiel2005; @graiff2016]. The increase in epibiont load reduces the buoyancy of floating macroalgal rafts over time eventually causing them to sink to the seafloor, while also potentially increasing drag [@hobday2000; @tala2013; @craw2018]. Fragmentation of kelp biomass over time may also reduce raft times further, while growth may counteract the effects of epibiont load and fragmentation provided the environmental conditions are favorable [@graiff2016; @macaya2016]. For instance a study by @rothausler2011 investigated the abiotic and biotic factors influencing raft time and dispersal potential of the giant kelp *M. pyrifera* by a combination of tethering experiments and field surveys. The results showed the physiological performance of kelp declined with increasing epiphyte biomass and that higher temperatures increased growth rate of epibionts and fragmentation of kelp. The authors concluded from the results of both the experiments and field surveys that *M. pyrifera* dispersal is dependent on low temperature and moderate irradiance conditions, with high temperatures and higher irradiance reducing overall raft-time and hence dispersal potential [@rothausler2011].

# Methods

## Raft-time
Raft-time or sometimes referred to as raft-longevity is the time a macroalgae raft remains afloat at the surface of the ocean after detachment before sinking. Raft-time was estimated from the results of past studies by @graiff2016 and @graiff2013 for each season. For summer the raft time was 22 days, autumn was 41 days, winter was 38 days, and spring was 33 days. 

```{r morphology surface area table, message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, fig.cap="TBD."}

# Read in morphology data

eck_df <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop") 
eck_df$site <- as.character(eck_df$site)
eck_df <- eck_df %>% 
  filter(population == "Deep") 
eck_long_df <- gather(eck_df, Morphology, measurement, frond_mass:total_length, factor_key=TRUE)

# Summary stats to make it easier to refer to later, these will not be used any analysis.
#site_list <- c("Kommetjie")

morph_data <- eck_long_df %>% 
  group_by(site, Morphology) %>% 
  summarise(maximum = max(measurement, na.rm = T)) %>% 
  ungroup() %>% 
  rename(Site = site) %>% 
  rename(Maximum = maximum) %>% 
  spread(Morphology, Maximum)

# Add in and/calculate estimates
morph_data$stipe_radius <- with(morph_data, stipe_circ/(pi*2))
morph_data$frond_width <- with(morph_data, 5)
morph_data$frond_thickness <- with(morph_data, 0.2)
morph_data$bulb_length <- with(morph_data, 10)
morph_data$bulb_base_radius <- with(morph_data, 5)
morph_data$top_radius <- with(morph_data, 3)
morph_data$bottom_radius <- with(morph_data, 10)
morph_data$stipe_radius <- with(morph_data, stipe_circ/(pi*2))
morph_data$height <- with(morph_data, 5)

# Define the value of pi 
pi <- 3.14

# Calculate the total cross-sectional areas for each site from all morphological characteristics
morph_data$total_Ac <- with(morph_data, ((2*frond_length*frond_width) + (2*frond_length*frond_thickness) + (2*frond_width*frond_thickness) + (primary_length * primary_width)/2 + (4*pi*bulb_base_radius*2) + (2*pi*bulb_base_radius*bulb_length) + 2*pi*stipe_radius*(stipe_radius*stipe_length) +  (pi*(2*top_radius + 2*bottom_radius) + pi*(top_radius + bottom_radius)*pi*(top_radius - bottom_radius)*2 + height*2))/1000)

# Calculate the total mass of kelp individual based on site morphological characteristics

morph_data$total_mass <- with(morph_data, (frond_mass*6) + (stipe_mass) )

# Calculate the volume fro each site for all morphological characteristics (meters^3)

morph_data$total_volume <- with(morph_data, (frond_thickness*frond_length*frond_width) + (primary_length * primary_width * frond_thickness) + (pi*(stipe_radius*stipe_radius)*stipe_length) + (pi*height*0.3333*((top_radius*top_radius) + (top_radius * bottom_radius) + (bottom_radius*bottom_radius))))

# Make table based on new entries
site_surface_area <- morph_data
site_surface_area <- flextable(data = site_surface_area)
#site_surface_area <- theme_zebra(site_surface_area, odd_header = "transparent", even_header = "transparent")
site_surface_area <- align(x= site_surface_area, align = "center", part = "all")
#area_table <- set_header_labels(area_table, Plant.characteristic = "Plant characteristic", Approximate.shape = "Approximate shape", Equation.used = "Equation Used", Plant.dimensions = "Plant dimensions")
#area_table <- set_header_labels(area_table, Ac.Minimum = "Ac Minimum", Ac.Mean = "Ac Mean", Ac.Maximum = "Ac Maximum")
site_surface_area <- set_table_properties(site_surface_area, width = 1, layout = "autofit")
#site_surface_area <- set_caption(site_surface_area, "Table 2:Summary of the atrributes and estimates used to calculate the overall surface area of Kommetjie kelp individuals used in the various simulation.")
site_surface_area
```

## Simulations

Simulations used daily outputs of velocity vectors (meridonal and zonal) and salinity (psu) for varying depths for the study region. To account for the role of morphological characteristics in influencing drift trajectory in terms of hydrodynamic and wind drag [@coppin2021] simulations were run separately for each site per season. Morphological characteristics of macroalgae has been shown to be based on the local wave and temperature environment, hence the need for site specific parameters with regards to morphological characteristics. Running simulations per season allowed incorporation of seasonal raft-times identified in pervious work [@graiff2016 and @graiff2013]. The outputs from each simulation (site) was pooled based on season. 

Simulations were run using the OceanParcels software (available from https://oceanparcels.org/). All simulations were run using a Runge-Kutte fourth order advection scheme, while custom kernels simulated the effects of hydrodynamic and wind drag on overall trajectory, seasonal raft-times, sinking and settling on seafloor of virtual kelp particles; all important processes in the determination of surface and bottom sinks. The simulations were run for 2019, which was divided into various seasons (see table??). For incorporating drag, the 'maximum exposure scenario' proposed by @coppin2021 was used for all simulations (85% hydrodynamic and 15% wind drag) while virtual kelp particles were on the surface and then would convert to full hydrodynamic drag exposure (100%) once the virtual kelp started sinking; as wind would no longer act as a direct influencer of trajectory once below the ocean surface. 

## Analysis

# Results
## Ocean analysis

```{r eval=FALSE, message=FALSE, echo=FALSE, include=FALSE}

map_chp4A <- rasterGrob(as.raster(readJPEG("figures/chapter_4/chapter_4_vectormap_summer.jpeg")))
map_chp4B <- rasterGrob(as.raster(readJPEG("figures/chapter_4/chapter_4_vectormap_autumn.jpeg")))
map_chp4C <- rasterGrob(as.raster(readJPEG("figures/chapter_4/chapter_4_vectormap_winter.jpeg")))
map_chp4D <- rasterGrob(as.raster(readJPEG("figures/chapter_4/chapter_4_vectormap_spring.jpeg")))

ggarrange(map_chp4A, map_chp4B, map_chp4C, map_chp4D)

```


```{r data wrangle, message=FALSE, warning=FALSE, include=FALSE}

houtbay_summer <- tidync("OceanParcels/chapter_4_output/hb_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
houtbay_summer$season <- "Summer" 
houtbay_summer$site <- "Hout Bay" 
houtbay_summer_mean <- houtbay_summer %>% # calculate mean trajectory
 group_by(t) %>% 
 summarise(across(lon:bathy, mean, na.rm= TRUE))
houtbay_summer_mean$season <- "Summer" 
houtbay_summer_mean$site <- "Hout Bay" 

houtbay_autumn <- tidync("OceanParcels/chapter_4_output/hb_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
houtbay_autumn$season <- "Autumn" 
houtbay_autumn$site <- "Hout Bay" 
houtbay_autumn_mean <- houtbay_autumn %>% # calculate mean trajectory
 group_by(t) %>% 
 summarise(across(lon:bathy, mean, na.rm= TRUE))
houtbay_autumn_mean$season <- "Autumn" 
houtbay_autumn_mean$site <- "Hout Bay" 

houtbay_winter <- tidync("OceanParcels/chapter_4_output/hb_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
houtbay_winter$season <- "Winter" 
houtbay_winter$site <- "Hout Bay" 
houtbay_winter_mean <- houtbay_winter %>% # calculate mean trajectory
 group_by(t) %>% 
 summarise(across(lon:bathy, mean, na.rm= TRUE))
houtbay_winter_mean$season <- "Winter" 
houtbay_winter_mean$site <- "Hout Bay" 

houtbay_spring <- tidync("OceanParcels/chapter_4_output/hb_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
houtbay_spring$season <- "Spring" 
houtbay_spring$site <- "Hout Bay" 
houtbay_spring_mean <- houtbay_spring %>% # calculate mean trajectory
 group_by(t) %>% 
 summarise(across(lon:bathy, mean, na.rm= TRUE))
houtbay_spring_mean$season <- "Spring" 
houtbay_spring_mean$site <- "Hout Bay" 

kom_summer <- tidync("OceanParcels/chapter_4_output/kom_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kom_summer$season <- "Summer" 
kom_summer$site <- "Kommetjie" 
kom_summer_mean <- kom_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kom_summer_mean$season <- "Summer" 
kom_summer_mean$site <- "Kommetjie" 

kom_autumn <- tidync("OceanParcels/chapter_4_output/kom_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kom_autumn$season <- "Autumn" 
kom_autumn$site <- "Kommetjie" 
kom_autumn_mean <- kom_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kom_autumn_mean$season <- "Autumn" 
kom_autumn_mean$site <- "Kommetjie" 

kom_winter <- tidync("OceanParcels/chapter_4_output/kom_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kom_winter$season <- "Winter" 
kom_winter$site <- "Kommetjie" 
kom_winter_mean <- kom_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kom_winter_mean$season <- "Winter" 
kom_winter_mean$site <- "Kommetjie" 

kom_spring <- tidync("OceanParcels/chapter_4_output/kom_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kom_spring$season <- "Spring" 
kom_spring$site <- "Kommetjie" 
kom_spring_mean <- kom_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kom_spring_mean$season <- "Spring" 
kom_spring_mean$site <- "Kommetjie" 

scar_summer <- tidync("OceanParcels/chapter_4_output/scar_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
scar_summer$season <- "Summer" 
scar_summer$site <- "Scarborough" 
scar_summer_mean <- scar_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
scar_summer_mean$season <- "Summer" 
scar_summer_mean$site <- "Scarborough" 

scar_autumn <- tidync("OceanParcels/chapter_4_output/scar_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
scar_autumn$season <- "Autumn" 
scar_autumn$site <- "Scarborough" 
scar_autumn_mean <- scar_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
scar_autumn_mean$season <- "Autumn" 
scar_autumn_mean$site <- "Scarborough" 

scar_winter <- tidync("OceanParcels/chapter_4_output/scar_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
scar_winter$season <- "Winter" 
scar_winter$site <- "Scarborough" 
scar_winter_mean <- scar_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
scar_winter_mean$season <- "Winter" 
scar_winter_mean$site <- "Scarborough" 

scar_spring <- tidync("OceanParcels/chapter_4_output/scar_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
scar_spring$season <- "Spring" 
scar_spring$site <- "Scarborough" 
scar_spring_mean <- scar_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
scar_spring_mean$season <- "Spring" 
scar_spring_mean$site <- "Scarborough" 

oude_summer <- tidync("OceanParcels/chapter_4_output/oudekraal_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
oude_summer$season <- "Summer" 
oude_summer$site <- "Oudekraal" 
oude_summer_mean <- oude_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
oude_summer_mean$season <- "Summer" 
oude_summer_mean$site <- "Oudekraal" 

oude_autumn <- tidync("OceanParcels/chapter_4_output/oudekraal_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
oude_autumn$season <- "Autumn" 
oude_autumn$site <- "Oudekraal" 
oude_autumn_mean <- oude_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
oude_autumn_mean$season <- "Autumn" 
oude_autumn_mean$site <- "Oudekraal" 

oude_winter <- tidync("OceanParcels/chapter_4_output/oudekraal_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
oude_winter$season <- "Winter" 
oude_winter$site <- "Oudekraal" 
oude_winter_mean <- oude_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
oude_winter_mean$season <- "Winter" 
oude_winter_mean$site <- "Oudekraal" 

oude_spring <- tidync("OceanParcels/chapter_4_output/oudekraal_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
oude_spring$season <- "Spring" 
oude_spring$site <- "Oudekraal" 
oude_spring_mean <- oude_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
oude_spring_mean$season <- "Spring" 
oude_spring_mean$site <- "Oudekraal" 

betty_summer <- tidync("OceanParcels/chapter_4_output/betty_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
betty_summer$season <- "Summer" 
betty_summer$site <- "Betty's Bay" 
betty_summer_mean <- betty_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
betty_summer_mean$season <- "Summer" 
betty_summer_mean$site <- "Betty's Bay" 

betty_autumn <- tidync("OceanParcels/chapter_4_output/betty_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
betty_autumn$season <- "Autumn" 
betty_autumn$site <- "Betty's Bay" 
betty_autumn_mean <- betty_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
betty_autumn_mean$season <- "Autumn" 
betty_autumn_mean$site <- "Betty's Bay" 

betty_winter <- tidync("OceanParcels/chapter_4_output/betty_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
betty_winter$season <- "Winter" 
betty_winter$site <- "Betty's Bay" 
betty_winter_mean <- betty_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
betty_winter_mean$season <- "Winter" 
betty_winter_mean$site <- "Betty's Bay" 

betty_spring <- tidync("OceanParcels/chapter_4_output/betty_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
betty_spring$season <- "Spring" 
betty_spring$site <- "Betty's Bay" 
betty_spring_mean <- betty_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
betty_spring_mean$season <- "Spring" 
betty_spring_mean$site <- "Betty's Bay" 

kalk_summer <- tidync("OceanParcels/chapter_4_output/kalk_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kalk_summer$season <- "Summer" 
kalk_summer$site <- "Kalk Bay" 
kalk_summer_mean <- kalk_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kalk_summer_mean$season <- "Summer" 
kalk_summer_mean$site <- "Kalk Bay" 

kalk_autumn <- tidync("OceanParcels/chapter_4_output/kalk_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kalk_autumn$season <- "Autumn" 
kalk_autumn$site <- "Kalk Bay" 
kalk_autumn_mean <- kalk_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kalk_autumn_mean$season <- "Autumn" 
kalk_autumn_mean$site <- "Kalk Bay" 

kalk_winter <- tidync("OceanParcels/chapter_4_output/kalk_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kalk_winter$season <- "Winter" 
kalk_winter$site <- "Kalk Bay" 
kalk_winter_mean <- kalk_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kalk_winter_mean$season <- "Winter" 
kalk_winter_mean$site <- "Kalk Bay" 

kalk_spring <- tidync("OceanParcels/chapter_4_output/kalk_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
kalk_spring$season <- "Spring" 
kalk_spring$site <- "Kalk Bay" 
kalk_spring_mean <- kalk_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
kalk_spring_mean$season <- "Spring" 
kalk_spring_mean$site <- "Kalk Bay" 

aframe_summer <- tidync("OceanParcels/chapter_4_output/aframe_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
aframe_summer$season <- "Summer" 
aframe_summer$site <- "A-Frame" 
aframe_summer_mean <- aframe_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
aframe_summer_mean$season <- "Summer" 
aframe_summer_mean$site <- "A-Frame" 

aframe_autumn <- tidync("OceanParcels/chapter_4_output/aframe_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
aframe_autumn$season <- "Autumn" 
aframe_autumn$site <- "A-Frame" 
aframe_autumn_mean <- aframe_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
aframe_autumn_mean$season <- "Autumn" 
aframe_autumn_mean$site <- "A-Frame" 

aframe_winter <- tidync("OceanParcels/chapter_4_output/aframe_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
aframe_winter$season <- "Winter" 
aframe_winter$site <- "A-Frame" 
aframe_winter_mean <- aframe_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
aframe_winter_mean$season <- "Winter" 
aframe_winter_mean$site <- "A-Frame" 

aframe_spring <- tidync("OceanParcels/chapter_4_output/aframe_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
aframe_spring$season <- "Spring" 
aframe_spring$site <- "A-Frame" 
aframe_spring_mean <- aframe_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
aframe_spring_mean$season <- "Spring" 
aframe_spring_mean$site <- "A-Frame" 

sthelena_summer <- tidync("OceanParcels/chapter_4_output/sthelena_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
sthelena_summer$season <- "Summer" 
sthelena_summer$site <- "St. Helena Bay" 
sthelena_summer_mean <- sthelena_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
sthelena_summer_mean$season <- "Summer" 
sthelena_summer_mean$site <- "St. Helena Bay" 

sthelena_autumn <- tidync("OceanParcels/chapter_4_output/sthelena_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
sthelena_autumn$season <- "Autumn" 
sthelena_autumn$site <- "St. Helena Bay" 
sthelena_autumn_mean <- sthelena_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
sthelena_autumn_mean$season <- "Autumn" 
sthelena_autumn_mean$site <- "St. Helena Bay" 

sthelena_winter <- tidync("OceanParcels/chapter_4_output/sthelena_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
sthelena_winter$season <- "Winter" 
sthelena_winter$site <- "St. Helena Bay" 
sthelena_winter_mean <- sthelena_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
sthelena_winter_mean$season <- "Winter" 
sthelena_winter_mean$site <- "St. Helena Bay" 

sthelena_spring <- tidync("OceanParcels/chapter_4_output/sthelena_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
sthelena_spring$season <- "Spring" 
sthelena_spring$site <- "St. Helena Bay" 
sthelena_spring_mean <- sthelena_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
sthelena_spring_mean$season <- "Spring" 
sthelena_spring_mean$site <- "St. Helena Bay" 

millers_summer <- tidync("OceanParcels/chapter_4_output/millers_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
millers_summer$season <- "Summer" 
millers_summer$site <- "Miller's Point" 
millers_summer_mean <- millers_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
millers_summer_mean$season <- "Summer" 
millers_summer_mean$site <- "Miller's Point" 

millers_autumn <- tidync("OceanParcels/chapter_4_output/millers_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
millers_autumn$season <- "Autumn" 
millers_autumn$site <- "Miller's Point" 
millers_autumn_mean <- millers_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
millers_autumn_mean$season <- "Autumn" 
millers_autumn_mean$site <- "Miller's Point" 

millers_winter <- tidync("OceanParcels/chapter_4_output/millers_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
millers_winter$season <- "Winter" 
millers_winter$site <- "Miller's Point" 
millers_winter_mean <- millers_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
millers_winter_mean$season <- "Winter" 
millers_winter_mean$site <- "Miller's Point" 

millers_spring <- tidync("OceanParcels/chapter_4_output/millers_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
millers_spring$season <- "Spring" 
millers_spring$site <- "Miller's Point" 
millers_spring_mean <- millers_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
millers_spring_mean$season <- "Spring" 
millers_spring_mean$site <- "Miller's Point" 

baboon_summer <- tidync("OceanParcels/chapter_4_output/baboon_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
baboon_summer$season <- "Summer" 
baboon_summer$site <- "Baboon Rock" 
baboon_summer_mean <- baboon_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
baboon_summer_mean$season <- "Summer" 
baboon_summer_mean$site <- "Baboon Rock" 

baboon_autumn <- tidync("OceanParcels/chapter_4_output/baboon_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
baboon_autumn$season <- "Autumn" 
baboon_autumn$site <- "Baboon Rock" 
baboon_autumn_mean <- baboon_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
baboon_autumn_mean$season <- "Autumn" 
baboon_autumn_mean$site <- "Baboon Rock" 

baboon_winter <- tidync("OceanParcels/chapter_4_output/baboon_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
baboon_winter$season <- "Winter" 
baboon_winter$site <- "Baboon Rock" 
baboon_winter_mean <- baboon_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
baboon_winter_mean$season <- "Winter" 
baboon_winter_mean$site <- "Baboon Rock" 

baboon_spring <- tidync("OceanParcels/chapter_4_output/baboon_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
baboon_spring$season <- "Spring" 
baboon_spring$site <- "Baboon Rock" 
baboon_spring_mean <- baboon_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
baboon_spring_mean$season <- "Spring" 
baboon_spring_mean$site <- "Baboon Rock" 

basata_summer <- tidync("OceanParcels/chapter_4_output/basata_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
basata_summer$season <- "Summer" 
basata_summer$site <- "Basata Rock" 
basata_summer_mean <- basata_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
basata_summer_mean$season <- "Summer" 
basata_summer_mean$site <- "Basata Rock" 

basata_autumn <- tidync("OceanParcels/chapter_4_output/basata_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
basata_autumn$season <- "Autumn" 
basata_autumn$site <- "Basata Rock" 
basata_autumn_mean <- basata_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
basata_autumn_mean$season <- "Autumn" 
basata_autumn_mean$site <- "Basata Rock" 

basata_winter <- tidync("OceanParcels/chapter_4_output/basata_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
basata_winter$season <- "Winter" 
basata_winter$site <- "Basata Rock" 
basata_winter_mean <- basata_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
basata_winter_mean$season <- "Winter" 
basata_winter_mean$site <- "Basata Rock" 

basata_spring <- tidync("OceanParcels/chapter_4_output/basata_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
basata_spring$season <- "Spring" 
basata_spring$site <- "Basata Rock" 
basata_spring_mean <- basata_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
basata_spring_mean$season <- "Spring" 
basata_spring_mean$site <- "Basata Rock" 

buffels_summer <- tidync("OceanParcels/chapter_4_output/buffels_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
buffels_summer$season <- "Summer" 
buffels_summer$site <- "Buffelsbaai" 
buffels_summer_mean <- buffels_summer %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
buffels_summer_mean$season <- "Summer" 
buffels_summer_mean$site <- "Buffelsbaai" 

buffels_autumn <- tidync("OceanParcels/chapter_4_output/buffels_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
buffels_autumn$season <- "Autumn" 
buffels_autumn$site <- "Buffelsbaai" 
buffels_autumn_mean <- buffels_autumn %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
buffels_autumn_mean$season <- "Autumn" 
buffels_autumn_mean$site <- "Buffelsbaai" 

buffels_winter <- tidync("OceanParcels/chapter_4_output/buffels_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
buffels_winter$season <- "Winter" 
buffels_winter$site <- "Buffelsbaai" 
buffels_winter_mean <- buffels_winter %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
buffels_winter_mean$season <- "Winter" 
buffels_winter_mean$site <- "Buffelsbaai" 

buffels_spring <- tidync("OceanParcels/chapter_4_output/buffels_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
buffels_spring$season <- "Spring" 
buffels_spring$site <- "Buffelsbaai" 
buffels_spring_mean <- buffels_spring %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:bathy, mean, na.rm= TRUE))
buffels_spring_mean$season <- "Spring" 
buffels_spring_mean$site <- "Buffelsbaai" 

soetwater_summer <- tidync("OceanParcels/chapter_4_output/soetwater_summer.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
soetwater_summer$season <- "Summer"
soetwater_summer$site <- "Soetwater"
soetwater_summer_mean <- soetwater_summer %>% # calculate mean trajectory
  group_by(t) %>%
  summarise(across(lon:bathy, mean, na.rm= TRUE))
soetwater_summer_mean$season <- "Summer"
soetwater_summer_mean$site <- "Soetwater"

soetwater_autumn <- tidync("OceanParcels/chapter_4_output/soetwater_autumn.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
soetwater_autumn$season <- "Autumn"
soetwater_autumn$site <- "Soetwater"
soetwater_autumn_mean <- soetwater_autumn %>% # calculate mean trajectory
  group_by(t) %>%
  summarise(across(lon:bathy, mean, na.rm= TRUE))
soetwater_autumn_mean$season <- "Autumn"
soetwater_autumn_mean$site <- "Soetwater"

soetwater_winter <- tidync("OceanParcels/chapter_4_output/soetwater_winter.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
soetwater_winter$season <- "Winter"
soetwater_winter$site <- "Soetwater"
soetwater_winter_mean <- soetwater_winter %>% # calculate mean trajectory
  group_by(t) %>%
  summarise(across(lon:bathy, mean, na.rm= TRUE))
soetwater_winter_mean$season <- "Winter"
soetwater_winter_mean$site <- "Soetwater"

soetwater_spring <- tidync("OceanParcels/chapter_4_output/soetwater_spring.nc") %>%
  hyper_tibble() %>%
  dplyr::select(time, trajectory, lon, lat, distance, Salinity, age, KelpDepth, SinkSpeed,       KelpVelU, KelpVelV, VelU, VelV, WindU, WindV, bathy) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
soetwater_spring$season <- "Spring"
soetwater_spring$site <- "Soetwater"
soetwater_spring_mean <- soetwater_spring %>% # calculate mean trajectory
  group_by(t) %>%
  summarise(across(lon:bathy, mean, na.rm= TRUE))
soetwater_spring_mean$season <- "Spring"
soetwater_spring_mean$site <- "Soetwater"

# Summer
total_summer <- rbind(kom_summer, houtbay_summer, scar_summer, oude_summer, betty_summer, kalk_summer, aframe_summer, sthelena_summer, millers_summer, baboon_summer, basata_summer, buffels_summer, soetwater_summer) 
total_summer$age <- with(total_summer, age/3600)

# Autumn

total_autumn <- rbind(kom_autumn, houtbay_autumn, scar_autumn, oude_autumn, betty_autumn, kalk_autumn, aframe_autumn, sthelena_autumn, millers_autumn, baboon_autumn, basata_autumn, buffels_autumn, soetwater_autumn) 
total_autumn$age <- with(total_autumn, age/3600)

# Winter

total_winter <- rbind(kom_winter, houtbay_winter, scar_winter, oude_winter, betty_winter, kalk_winter, aframe_winter, sthelena_winter, millers_winter, baboon_winter, basata_winter, buffels_winter, soetwater_winter) 
total_winter$age <- with(total_winter, age/3600)

# Spring

total_spring <- rbind(kom_spring, houtbay_spring, scar_spring, oude_spring, betty_spring, kalk_spring, aframe_spring, sthelena_spring, millers_spring, baboon_spring, basata_spring, buffels_spring, soetwater_spring) 
total_spring$age <- with(total_spring, age/3600)

# Summer
total_summer_mean <- rbind(kom_summer_mean, houtbay_summer_mean, scar_summer_mean, oude_summer_mean, betty_summer_mean, kalk_summer_mean, aframe_summer_mean, sthelena_summer_mean, millers_summer_mean, baboon_summer_mean, basata_summer_mean, buffels_summer_mean, soetwater_summer_mean) 

# Autumn
total_autumn_mean <- rbind(kom_autumn_mean, houtbay_autumn_mean, scar_autumn_mean, oude_autumn_mean, betty_autumn_mean, kalk_autumn_mean, aframe_autumn_mean, sthelena_autumn_mean, millers_autumn_mean, baboon_autumn_mean, basata_autumn_mean, buffels_autumn_mean, soetwater_autumn_mean) 

# Winter
total_winter_mean <- rbind(kom_winter_mean, houtbay_winter_mean, scar_winter_mean, oude_winter_mean, betty_winter_mean, kalk_winter_mean, aframe_winter_mean, sthelena_winter_mean, millers_winter_mean, baboon_winter_mean, basata_winter_mean, buffels_winter_mean, soetwater_winter_mean) 

# Spring
total_spring_mean <- rbind(kom_spring_mean, houtbay_spring_mean, scar_spring_mean, oude_spring_mean, betty_spring_mean, kalk_spring_mean, aframe_spring_mean, sthelena_spring_mean, millers_spring_mean, baboon_spring_mean, basata_spring_mean, buffels_spring_mean, soetwater_spring_mean) 

load("map/south_africa_coast_hi_res.Rdata")
load("map/sa_bathy.RData")

```

## Mean trajectory 

```{r message=FALSE, warning=FALSE, include=FALSE}

summer_mean <- ggplot()+
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID), size = 0.4, colour = "black",     fill = "grey") +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2) +
  geom_path(data = total_summer_mean, aes(x = lon, y = lat, linetype = site))+
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Summer") +
  guides(linetype=guide_legend(title="Simulation")) +
  coord_fixed(ratio=1, clip = "on", xlim = c(15, 20), ylim = c(-35, -31)) + # fix the aspect ratio of plot
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

autumn_mean <- ggplot()+
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID), size = 0.4, colour = "black",     fill = "grey") +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2) +
  geom_path(data = total_autumn_mean, aes(x = lon, y = lat, linetype = site))+
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Autumn") +
  guides(linetype=guide_legend(title="Simulation")) +
  coord_fixed(ratio=1, clip = "on", xlim = c(15, 20), ylim = c(-35, -31)) + # fix the aspect ratio of plot
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

winter_mean <- ggplot()+
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID), size = 0.4, colour = "black",     fill = "grey") +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2) +
  geom_path(data = total_winter_mean, aes(x = lon, y = lat, linetype = site))+
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Winter") +
  guides(linetype=guide_legend(title="Simulation")) +
  coord_fixed(ratio=1, clip = "on", xlim = c(15, 20), ylim = c(-35, -31)) + # fix the aspect ratio of plot
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

spring_mean <- ggplot()+
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID), size = 0.4, colour = "black",     fill = "grey") +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2) +
  geom_path(data = total_spring_mean, aes(x = lon, y = lat, linetype = site))+
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Spring") +
  guides(linetype=guide_legend(title="Simulation")) +
  coord_fixed(ratio=1, clip = "on", xlim = c(15, 20), ylim = c(-35, -31)) + # fix the aspect ratio of plot
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6, fig.width=6}

ggarrange(summer_mean, autumn_mean, winter_mean, spring_mean,common.legend = TRUE, font.label = list(size = 12, face = "bold"), legend = c("bottom"), ncol = 2, nrow = 2, labels = c("AUTO"))

```

## Heatmaps

```{r message=FALSE, warning=FALSE, include=FALSE}

total_summer_surface <- total_summer %>% 
filter(KelpDepth == 0)
total_summer_sink <- total_summer %>% 
filter(KelpDepth > 0)
total_autumn_surface <- total_autumn %>% 
filter(KelpDepth == 0)
total_autumn_sink <- total_autumn %>% 
filter(KelpDepth > 0)
total_winter_surface <- total_winter %>% 
filter(KelpDepth == 0)
total_winter_sink <- total_winter %>% 
filter(KelpDepth > 0)
total_spring_surface <- total_spring %>% 
filter(KelpDepth == 0)
total_spring_sink <- total_spring %>% 
filter(KelpDepth > 0)

## Load software need for entire script

load("map/south_africa_coast_hi_res.Rdata")
load("map/sa_bathy.RData")

# summer
summer_heatmap_surface <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_summer_surface, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "C", limits = c(1, 110000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Surface") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

summer_heatmap_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_summer_sink, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "B", limits = c(1, 1000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Sub-surface") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
# autumn
autumn_heatmap_surface <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_autumn_surface, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "C", limits = c(1, 110000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_autumn_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

autumn_heatmap_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_autumn_sink, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "B", limits = c(1, 1000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_autumn_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

# winter
winter_heatmap_surface <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_winter_surface, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "C", limits = c(1, 110000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_winter_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

winter_heatmap_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_winter_sink, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "B", limits = c(1, 1000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_winter_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

# spring
spring_heatmap_surface <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_spring_surface, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "C", limits = c(1, 11000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_spring_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 

spring_heatmap_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_hex(data = total_spring_sink, bins = 80, aes(x = lon, y = lat), legend = TRUE) +  
  scale_fill_viridis_c(aesthetics = "fill", option = "B", limits = c(1, 1000)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_spring_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
```

```{r message=FALSE, echo=FALSE, include=TRUE, warning=FALSE, fig.height=10, fig.width=6}
leg_heatmap_surface <- get_legend(summer_heatmap_surface)
leg_heatmap_sink <- get_legend(summer_heatmap_sink)

ggarrange(summer_heatmap_surface, summer_heatmap_sink, autumn_heatmap_surface, autumn_heatmap_sink, winter_heatmap_surface, winter_heatmap_sink, autumn_heatmap_surface, spring_heatmap_sink,as_ggplot(leg_heatmap_surface), as_ggplot(leg_heatmap_sink), font.label = list(size = 12, face = "bold"), legend = c("none"), ncol = 2, nrow = 5, labels = c("AUTO"))


```

# Point plots
## Depth distribution
```{r message=FALSE, echo=FALSE, warning=FALSE}
# summer
summer_depth_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_summer_sink, aes(x = lon, y = lat, colour = KelpDepth)) +
  scale_colour_viridis_c(aesthetics = "colour", option = "C", limits = c(0, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Summer") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
# autumn
autumn_depth_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_autumn_sink, aes(x = lon, y = lat, colour = KelpDepth)) +
  scale_colour_viridis_c(aesthetics = "colour", option = "C", limits = c(0, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Autumn") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12))
# winter
winter_depth_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_winter_sink, aes(x = lon, y = lat, colour = KelpDepth)) +
  scale_colour_viridis_c(aesthetics = "colour", option = "C", limits = c(0, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Winter") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
# spring
spring_depth_sink <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_spring_sink, aes(x = lon, y = lat, colour = KelpDepth)) +
  scale_colour_viridis_c(aesthetics = "colour", option = "C", limits = c(1, 500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Spring") +
  guides(fill=guide_legend(title="Number of particles")) +
  #theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
```

```{r message=FALSE, echo=FALSE, warning=FALSE, include=TRUE, fig.height=6, fig.width=6}

ggarrange(summer_depth_sink, autumn_depth_sink, winter_depth_sink, spring_depth_sink,common.legend = TRUE, font.label = list(size = 12, face = "bold"), legend = c("bottom"), ncol = 2, nrow = 2)

```

```{r message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}

# summer
summer_age <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_summer, aes(x = lon, y = lat, colour = age)) +
  scale_colour_viridis_b(aesthetics = "colour", option = "C", limits = c(0, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Summer") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
# autumn
autumn_age <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_autumn, aes(x = lon, y = lat, colour = age)) +
  scale_colour_viridis_b(aesthetics = "colour", option = "C", limits = c(0, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Autumn") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12))
# winter
winter_age <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_winter, aes(x = lon, y = lat, colour = age)) +
  scale_colour_viridis_b(aesthetics = "colour", option = "C", limits = c(0, 1300)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Winter") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
# spring
spring_age <- ggplot() +
  geom_contour(data = sa_bathy, aes(x = lon, y = lat, z = depth), colour = "grey", size = 0.2)+
  geom_point(data = total_spring, aes(x = lon, y = lat, colour = age)) +
  scale_colour_viridis_b(aesthetics = "colour", option = "C", limits = c(1, 1500)) +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 0.4, colour = "black", fill = "gray") +
  #geom_path(data = total_summer_mean,aes(x = lon, y = lat, color = 'red'), show.legend =     FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  labs(x = expression(Longitude*degree*S)) +
  labs(y = expression(Latitude*degree*E)) +
  ggtitle("Spring") +
  #theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12)) 
```

```{r message=FALSE, echo=FALSE, warning=FALSE, include=TRUE, fig.height=6, fig.width=6}

ggarrange(summer_age, autumn_age, winter_age, spring_age,common.legend = TRUE, font.label = list(size = 12, face = "bold"), legend = c("bottom"), ncol = 2, nrow = 2)

```

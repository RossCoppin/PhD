---
title: 'Numerical trajectory patterns of floating macroalgae'
author: "Ross Coppin"
output:
  html_document:
  word_document:
    reference_docx: markdown/thesis_template.docx
  pdf_document:
    fig_caption: yes
bibliography: references.bib
csl: markdown/frontiers.csl.txt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

There is a range of objects, both natural and anthropogenic, floating in the ocean of which macroalgae are regarded as one of the most important passive dispersal mechanisms of marine taxa. Floating kelp  acts as a passive dispersal mechanism for a range of marine taxa and is sometimes referred to as the 'tumble-weed' of the ocean [@edgar1987; @bushing1994; @norton1992; @helmuth1994; @holmquist1994; @smith2002; @McCormick2008]. Considerable research has been performed investigating macroalgae as a passive dispersal mechanism in the ocean, however, in recent years much of the focus has shifted towards microplastics. 

Some macroalgae species are negatively buoyant and sink to the seafloor when detached from the substrate, while other species of macroalgae have air-filled pneumatocysts or stipes which allow the plants to reach the surface where light is more abundant. In turn, the positively buoyant pneumatocysts cause plants to float to the surface when dislodged from the substratum. The structure and number of pneumatocysts varies between species. For example species from the genera *Macrocystis*, *Sargassum*, *Ascophyllum*, and *Fucus* have thalli with many small pneumatocysts, while other kelp species such as *Nereocystis luetkeana*, *Pelagophycus porra*, *Ecklonia radiata*, *Ecklonia maxima* have a single, large pneumatocysts [@dayton1985; @smith2002; @thiel2005; @graiff2016; @batista2018]. In some cases the stipe itself is air-filled, such as with *E. maxima* and *E. radiata*. Although there have been reports of floating Chlorophyta species and some Rhodophyta species, Phaeophyceae species are the most commonly reported forms of floating algae. This is most likely because the green and red species reported floating are not actually positively buoyant, but instead are kept at the surface by gas trapped inbetween or in the thalli [@dromgoole1982; @back2000]. The giant kelp *Macrocystis pyrifera* [@helmuth1994; @kingsford1995; @hobday2000; @macaya2005; @graiff2016; @batista2018] and the bull kelp *Durvillaea antarctica* [@collins2010; @tala2013 ; @tala2017; @saunders2014; @smith2002; @wichmann2012; @batista2018] have been the focus of much of the research regarding spatial and temporal dispersal patterns, the ecological role of rafting, marine connectivity and raft-time.

The raft-time is the amount of time macroalgae floats at the surface before becoming negatively buoyant and begins to sink to the ocean-floor. Raft-time, also referred to as raft longevity, is determined by epibiont load, macroalgal growth rate and the loss of kelp biomass over time through fragmentation. Epibiont load consists of epiphytic and bryozoan species which tend to grow more rapidly in higher light and temperature environments, such as the ocean surface [@thiel2005; @thiel2005; @graiff2016]. The increase in epibiont load reduces the buoyancy of floating macroalgal rafts over time eventually causing them to sink to the seafloor, while also potentially increasing drag [@hobday2000; @tala2013; @craw2018]. Fragmentation of kelp biomass over time may also reduce raft times further, while growth may counteract the effects of epibiont load and fragmentation provided the environmental conditions are favorable [@graiff2016; @macaya2016]. For instance a study by @rothausler2011 investigated the abiotic and biotic factors influencing raft time and dispersal potential of the giant kelp *M. pyrifera* by a combination of tethering experiments and field surveys. The results showed the physiological performance of kelp declined with increasing epiphyte biomass and that higher temperatures increased growth rate of epibionts and fragmentation of kelp. The authors concluded from the results of both the experiments and field surveys that *M. pyrifera* dispersal is dependent on low temperature and moderate irradiance conditions, with high temperatures and higher irradiance reducing overall raft-time and hence dispersal potential [@rothausler2011].

Many past authors have also taken various approaches to estimate not only the raft-time of macroalgal rafts but also the oceanographic influences of macroalgae trajectory. Past research points to macroalgae trajectory being largely determined by prevailing wind conditions and surface currents [@thiel2005, @thiel2005; @hobday2000; @fraser2011; @rothausler2011; @rothausler2011]. Although ocean currents are regarded as the primary influence, the relative importance of wind versus surface current is still not known; although the role of wind has been recognised as important in several studies. For example, a study by @harrold1989 investigated the seasonal trajectories of radio-transmitter tagged *M. pyrifera* in nearshore Monterrey Bay. The results showed that kelp rafts with little surface area exposed to the wind were largely driven by a combination of wind and wind waves, however the relative importance of wind and wind waves was not clear. In addition, the tagged kelp trajectories were more consistent with the formation of eddies during winter. Previous studies have identified wind as an important mechanism of dispersal in wind dominated ocean systems. For example the subAntartic latitudes the West Wind Drift causes continuous unidirectional surface flow and is regarded as an important potential mechanism for dispersal of floating kelp. Other studies have used genetic approaches to determine macroalgae raft trajectory characteristics by inferring source location from genetically similar populations [@nikula2013]. For example, a study by @fraser2011 on the rafting capabilities of *Durvillaea antarctica* used a combination of population genetics and relative age estimate of ‘goosebarnacles’ attached to the raft. The presence of goosebarnacles suggests a long raft time as these species have a slow growth rate; while the genetic analyses showed these species are able to raft up to $\sim$ 390km from their local origin. The authors suggested that wind and water-movement were the primary influences of trajectory, however, this was only inferred from the genetic results and local climatology data [@fraser2011]. 

Other aspects such as buoyancy and drag also play a role in determining the trajectory and rate of transport for surface floating material. However, the past research on macroalgal trajectory has not investigated these factors which have been shown to be important aspects of trajectory for other materials such as icebergs, marine craft and microplastics. The "sail" area of an object floating at sea is the surface area exposed to the wind which results in air form drag, while the area of the object below the surface of the water is exposed to surface currents which result in water form drag. Drag coefficients related to wind and surface current have been shown to be important properties to consider when estimating trajectory and forecasting drift for search and sea rescue operations. Drag is ultimately determined by the size and shape of the object which are properties that vary considerably with macroalgae species. In addition, past research conducted within the maritime industry has shown that the size and shape of a vessel determine the relative importance of waves or wind as drivers of trajectory, as well as orientation of the object. If the length of the object is longer than the significant wave height then waves will be the primary driver of trajectory while the opposite is true for smaller objects where the effect of waves is regarded as negligible [@breivik2011; @griffin2017]. 

Although various approaches have been used in the past to investigate floating macroalagae trajectory, very few studies have employed the use of Langrangian trajectory modelling. Furthermore, non of the existing studies using this modeling approach have considered macroalgal morphology (i.e. shape) as an aspect of drag and ultimately trajectory. Currently, work by @brooks2019 which investigated the effect of inertia and radial size on the trajectory of pelagic *Sargussum* rafts. The study used a custom growth model to estimate changes in biomass and ultimately radial size, while a customised Hybrid Coordinate Ocean Model (HYCOM) for the trajectory simulations was used. The results showed that trajectory of pelagic *Sargussum* was significantly influenced by inertia and the radial size of the rafts. Langrangian trajectory modeling is a useful tool, however, the various models available often assume the object to be a spherical particle, which is obviously not the case for both biological and anthropogenic forms of marine debris in nature. The radial size included by @brooks2019 is an improvement, however this approach does not take into account the complex morphology on an individual level into account.

To accurately determine the trajectory of marine macroalgae these aspects need to be taken into account. Past research by @allen1999 and @breivik2011 have provided estimates of drag for various objects based on experimental work, which consisted of both direct and indirect methods of the Leeway model. However, this work does not consider biological material such as macroalgae. Although drag estimates do exist, these have been calculated for macroalgae not detached from the substratum and are regarded as fixed-point estimates. Methods used in the field of chemical engineering provide an alternative approach to estimating drag of macroalgae by means of formulas to calculate drag based on shape. Chemical engineers in the field of fluid dynamics which come across similar problems when including drag use an approach known as a 'spherecity factor'. A spherecity factor is the ratio of the surface area of a sphere having the volume as the irregular shaped particle (s) to the actual surface area of the particle (s_d) such that $$\psi=s/s_d$$. The values are dependent on the shape of the object and a range of values have been 
determined based on numerous experimental work. A table of various shapes and the associated spherecity factor is provided in the appendix.

There are considerable gaps in the literature with regards to macroalgae trajectory such as buoyancy, air form drag, water form drag, epibiont load, growth, fragmentation, size, shape and orientation which have not been investigated numerically in the past. In this study, a hypothetical approach was used to shed light on the role of drag on macroalgal drift trajectory by means of Langrangian based trajectory simulations. These simulations aimed to determine the role that hydrodynamic and wind drag might play in drift trajectory of macroalgae. In terms of wind drag, the direct effect of wind on the kelp was estimated rather than its affect on surface-currents.  

# Methods

## Study site

```{r map, message=FALSE, warning=FALSE, include=FALSE}

## Load software:
library(ggplot2)
library(rgdal)
library(tidyverse)
library(viridis)
library(gridExtra)
source("map/scaleBarFunc.R")

load("map/south_africa_coast_hi_res.Rdata")

map_pen <- ggplot(data = south_africa_coast_hi_res) +
geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
            size = 1.0, colour = "black", fill = NA) +
  #geom_point(data = study_sites, aes(x = lon, y = lat), color = "red", nudge_x = 0, nudge_y = 0.1) +
  #geom_label(data = study_sites_edit, aes(x = lon, y = lat, label = site), nudge_x = 0, nudge_y = 0) +
  geom_rect(data = south_africa_coast_hi_res,aes(xmin=18.10, xmax=18.50, ymin=-33.70, ymax=-34.50), inherit.aes = FALSE, fill = "blue", alpha = 0.01) +
  geom_rect(data = south_africa_coast_hi_res,aes(xmin=18.40, xmax=18.90, ymin=-34.00, ymax=-34.50), inherit.aes = FALSE, fill = "red", alpha = 0.01) +
  #annotate("text", label = "Warm\nTemperate", x = 18.7, y = -34.5, size = 4.0, angle = 0, colour = "black") +
  #annotate("text", label = "Cool\nTemperate", x = 18.0, y = -34.0, size = 4.0, angle = 0, colour = "black") +
  annotate("text", label = "FALSE\nBAY", x =18.65, y = -34.25, size = 4.0, angle = 0, colour = "black") +
  scaleBar(lon = 17.8, lat = -34.45, distanceLon = 10, distanceLat = 10, distanceLegend = -10, dist.unit = "km",
  arrow.length = 10, arrow.distance = 15, arrow.North.size = 3) +
  coord_cartesian(xlim = c(17.75, 19.15), ylim = c(-32.50, -34.55)) +
  #theme(axis.ticks = element_blank()) + # Remove tick marks
  xlab("Latitude") +
  ylab("Longitude")

## Coastline of Southern Africa
load("map/south_africa_coast_hi_res.Rdata")

release_sites <- read.csv("metadata/release_sites.csv", sep = ";")

## Make 2nd map of just the peninsula
release_map <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  geom_point(data = release_sites, aes(x = lon, y = lat, colour = "red"), show.legend = FALSE) +
  geom_label(data = release_sites, aes(x = lon, y = lat, label = site), nudge_x = 0, nudge_y = 0) +
  coord_cartesian(xlim = c(18.275, 18.525), ylim = c(-34.375, -33.600)) +
  theme(axis.ticks = element_blank(), # Remove tick marks
        #axis.text = element_blank(), # Remove lat/ lon numbers
        axis.title = element_blank()) # Remove lat/ lon labels
#ggsave(filename = "map_B.jpg", plot = last_plot(), device = "jpeg", path = "map/")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(ggpubr)

ggarrange(map_pen, release_map, labels = c("AUTO"), align = c("hv"), ncol = 2, nrow = 1)

```

## Hydrodynamic model

The characteristics of the underlying numerical flow model will be explained here...

## Particle tracking model

The model is based on parameterisations that have been used for previous studies investigating iceberg, capsized marine vessels and microplastics. It should be noted that most of the previous studies regarding macroalgae trajectory have investigated rafts and not solitary floating individuals. A kelp raft will vary in size and can range from a few meters across to large dense mats the size of a sports field. Furthermore, some authors suggest that most macroalgae become entangled through ocean currents and not through the hydrodynamic forces that dislodge them. In addition, large kelp rafts are not a characteristics around the coast of the Cape Peninsula but rather solitary kelp are (Pers. Obs). Therefore, the trajectory of solitary *E. maxima* individuals will be considered. Previous studies have made the assumption that kelp rafts move with the same velocity as the ocean current, and instead model a ensemble of particles which trajectories are determined by a combination of ocean currents and/or the effects of winds on currents. In addition, these studies assume the particle is fully buoyant. 

Numerical calculations of particle trajectory with a Lagrangian method [@delandmeter2019], and be described by the equation

$$X(t+\Delta t) = X(t) + \int_{t}^{t+\Delta t} v(x, \tau)d \tau + \Delta X_b(t)$$
where $X$ is the three-dimensional position of a particle, $v(x,t)$ is the three-dimensional velocity field at the location in the ocean model, $X_b(t)$ is a change in position due to 'behavior' of the particle. This can range from swimming in fish to sinking or beaching. IN order to investigate the effects of drag components of trajectory of floating macroalgae, this study incorporated drag as the custom behavior. 

This study simulated two scenarios; one where the plant is fully submerged and only exposed to seawater drag and the other where parts of the plants are partially exposed resulting in a combination of seawater and air form drag. Unlike previous studies, drag based on shape based coefficients was used in the calculations for determining the reduction in velocity as a result of drag. A momentum energy equation was used to calculate the drag forces for the relevant simulation. This approach has been employed in modeling iceberg drift trajectory [@andersson2017; @lichey2001; @eik2009] and was adapted to suit this particular study. The energy momentum equation used to calculate the drag force exerted on the virtual kelp particle was, $$m({d_u/d_t})=F_c + F_a + F_f$$
where $m$ is kelp mass, $d_u$ the virtual kelp particle velocity, $F_c$ the hydrodynamic drag, $F_a$ is the wind drag, and $F_f$ the surface-current flow. The assumption made was that the mass of the kelp did not change for each virtual kelp particle over the course of the simulations. Hydrodynamic drag, wind drag and surface current-flow are two-dimensional vector quantities and were calculated before input into the model. 

## Cross-sectional area

In order to incorporate hydrodynamic and wind drag, the cross-sectional area of the kelp was calculated first. Known geometric shapes reflecting the relevant plant sections were used to estimate the surface area for various parts of the plant, for details please see image ???. The cross-sectional area calculated was site specific and the dimensions needed were garnered from morphology data from a previous study [@coppin] and estimated from figure \ref{fig:morphology}.

```{r morphology_wrangling, message=FALSE, warning=FALSE, include=FALSE}
# Investigate morphology data to assist in estimating surface area
# Load software
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(ggplot2)
library(ggord)
library(vegan)
# Read in morphology data
eck_data <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop")
eck_data$site <- as.character(eck_data$site)
eck_deep <- eck_data %>% 
  filter(population == "Deep")

eck_long <- gather(eck_deep, morphology, measurement, frond_mass:total_length, factor_key=TRUE)
# Summary stats to make it easier to refer to later, these will not be used any analysis.
eck_stats <- eck_long %>% 
  group_by(site, morphology) %>% 
  summarise(mean = mean(measurement, na.rm = T),
            min = min(measurement, na.rm = T),
            max = max(measurement, na.rm = T),
            range = range(measurement, na.rm = T)[2]-range(measurement, na.rm = T)[1],
            sd = sd(measurement, na.rm = T)) %>% 
  ungroup()
# Make custom positions
positionsEck <- c("Betty's Bay", "Kalk Bay", "A-Frame", 
                  "Miller's Point", "Baboon Rock", "Batsata Rock", 
                  "Buffelsbaai", "Scarborough", 
                  "Soetwater","Kommetjie","Hout Bay", 
                  "Oudekraal", "St Helena Bay")
# Make plots for each morphology feature and grouped by site.
frond_mass <- ggplot(data = eck_data, aes(x = site, y = frond_mass, fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Frond mass (g)") + 
           coord_flip() +
           xlab("") + 
           theme_bw()
primary_length <- ggplot(data = eck_data, aes(x = site, y = primary_length , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Primary Length  (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw()
primary_width <- ggplot(data = eck_data, aes(x = site, y = primary_width , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Primary Width (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
frond_length <- ggplot(data = eck_data, aes(x = site, y = frond_length , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Frond length (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
stipe_mass <- ggplot(data = eck_data, aes(x = site, y = stipe_mass , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe mass (g)") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
stipe_length <- ggplot(data = eck_data, aes(x = site, y = stipe_length , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe length (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
stipe_circ <- ggplot(data = eck_data, aes(x = site, y = stipe_circ , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Stipe circ (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
tufts <- ggplot(data = eck_data, aes(x = site, y = tufts , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("No. of tufts") + 
           coord_flip() +
           xlab("") + 
           theme_bw() 
epi_length <- ggplot(data = eck_data, aes(x = site, y = epi_length , fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Epi Length  (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw()

total_length <- ggplot(data = eck_data, aes(x = site, y = epi_length, fill = site)) +
           geom_boxplot(outlier.shape = NA, varwidth = TRUE, notch = TRUE, show.legend = FALSE) +
           stat_compare_means(method = "kruskal.test", label.x = 5) + 
           scale_x_discrete(limits = positionsEck) + 
           ylab("Total length  (cm)") + 
           coord_flip() +
           xlab("") + 
           theme_bw()
```

```{r morphology, echo=FALSE, , fig.height=7, fig.width=8, message=FALSE, warning=FALSE, fig.cap='\\label{fig:morphology}Boxplots representing *E. pallida* morphological characteristics grouped by site around the Western Cape coastline, with the *y*-axis depicting the specific morphology measured and with units provided. The lower and upper "hinges" correspond to the first and third quartiles. The whiskers represent the range, solid black lines represent the median and black dots are outliers.'}
# Plot the morphology data based on site (see previous section)
ggarrange(frond_length, frond_mass,primary_length, primary_width, stipe_circ, stipe_length, stipe_mass, total_length, tufts, common.legend = TRUE, legend = c("none"), align = c("hv"))
```




## Hydrodynamic drag

The use of shape coefficients was used as a novel approach to simulating biological drifting debris. The drag coefficient for a spherical particle was used in the calculation of hydrodynamic drag as the trajectory model assumes the particles are spherical. The cross-sectional area for each of the virtual kelp parts was determined and used in the calculation of hydrodynamic drag. The hydrodynamic/form drag can be calculated by: $$ F_d = 0.5 \rho A_c C_d U^2$$

## Windage

In order to calculate the direct effect of wind-drag on the kelp the wind velcocity is needed, which can be estimated by the surface-current velocity. 

The total wind drag effect was calculated for the hypothetical cross-sectional area of the kelp particle which was exposed above the water surface, which in this study, was estimated as 10% of the total cross-sectional area. 

## Raft-time

Raft-time or sometimes referred to as raft-longevity is the time a macroalgae raft remains afloat at the surface of the ocean after detachment. Raft-time was estimated from past studies by @graiff2016 and @graiff2013; which found mean raft times of approximately 30 days in moderate conditions. 


## Simulations

# Results


```{r}

# Read in data and data wrangling

library(tidync)
library(tidyverse)

p_particle <- tidync("OceanParcels/trajectory_data/PassiveFloat.nc") %>%
  hyper_tibble() %>%
  dplyr::select(lon, lat, time) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2002-01-01 00:00:00"))  

p_particle_mean <- p_particle %>% 
   group_by(t) %>% 
   summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T)

p_particle$type <- "passive" # add extra column 'type' to dataframe and assigned 'passive' label

k_particle <- tidync("OceanParcels/trajectory_data/KelpFloat.nc") %>%
  hyper_tibble() %>%
  dplyr::select(lon, lat, time) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2002-01-01 00:00:00"))

k_particle_mean <- k_particle %>% 
   group_by(t) %>% 
   summarise_all(funs(mean = mean, sd = sd, min = min, max = max), na.rm = T)

k_particle$type <- "kelp" # add extra column 'type' to dataframe and assigned 'kelp' label

total_data <- rbind(p_particle, k_particle)

```


## Simulations

```{r}

plot_A <- ggplot(data = p_particle, aes(x = lon, y = lat)) + 
  geom_point() + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  theme_bw() 

plot_B <- ggplot(data = k_particle, aes(x = lon, y = lat)) + 
  geom_point() + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  theme_bw()

```

```{r}

library(ggpubr)
ggarrange(plot_A,plot_B, labels = c("A","B"))

```

# Discussion

# Appendix

Insert table of spherecity factors. 

# References


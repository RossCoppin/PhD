---
title: 'Numerical trajectory patterns of floating macroalgae'
author:
- R Coppin^[University of the Western Cape]
- C Rautenbach^[South African Weather Service]
- AJ Smit^[University of the Western Cape]
output:
  word_document:
    reference_docx: markdown/frontiers_template.docx
  html_document:
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex
bibliography: references.bib
csl: markdown/frontiers.csl.txt
---

```{r software, message=FALSE, warning=FALSE, include=FALSE}
## Load software need for entire script

#library(computeMSD)
library(ggplot2)
library(rgdal)
library(gridExtra)
library(ggpubr)
library(ggord)
library(mapproj)
library(vegan)
library(dplyr)
library(ggpubr)
library(maps)
library(flextable)
library(officer)
library(tidync)
library(tidyverse)
library(hexbin)
library(lubridate)

```


# Introduction

There are a range of objects, both natural and anthropogenic, floating in the ocean of which macroalgae are regarded as one of the most important passive dispersal mechanisms of marine taxa. Floating kelp acts as a passive dispersal mechanism for a range of marine taxa and is sometimes referred to as the 'tumble-weed' of the ocean [@edgar1987; @bushing1994; @norton1992; @helmuth1994; @holmquist1994; @smith2002; @McCormick2008]. Some macroalgae species are negatively buoyant and sink to the seafloor when detached from the substrate, while other species of macroalgae have air-filled pneumatocysts or stipes which allow the plants to reach the surface where light is more abundant. In turn, the positively buoyant pneumatocysts cause plants to float to the surface when dislodged from the substratum. The structure and number of pneumatocysts varies between species. For example species from the genera *Macrocystis*, *Sargassum*, *Ascophyllum*, and *Fucus* have thalli with many small pneumatocysts, while other kelp species such as *Nereocystis luetkeana*, *Pelagophycus porra*, *Ecklonia radiata*, *Ecklonia maxima* have a single, large pneumatocysts [@dayton1985; @smith2002; @thiel2005; @graiff2016; @batista2018]. In some cases the stipe itself is air-filled, such as with *E. maxima* and *E. radiata*. Although there have been reports of floating Chlorophyta species and some Rhodophyta species, Phaeophyceae species are the most commonly reported forms of floating algae. This is most likely because the green and red species reported floating are not actually positively buoyant, but instead are kept at the surface by gas trapped inbetween or in the thalli [@dromgoole1982; @back2000]. The giant kelp *Macrocystis pyrifera* [@helmuth1994; @kingsford1995; @hobday2000; @macaya2005; @graiff2016; @batista2018] and the bull kelp *Durvillaea antarctica* [@collins2010; @tala2013 ; @tala2017; @saunders2014; @smith2002; @wichmann2012; @batista2018] have been the focus of much of the research regarding spatial and temporal dispersal patterns, the ecological role of rafting, marine connectivity and raft-time.

Past research points to macroalgae trajectory being largely determined by prevailing wind conditions and surface currents [@thiel2005; @hobday2000; @fraser2011; @rothausler2011; @rothausler2011]. Although ocean currents are regarded as the primary influence, the relative importance of wind versus surface current is still unknown although the role of wind has been recognised as important in several studies. For example, a study by @harrold1989 investigated the seasonal trajectories of radio-transmitter tagged *M. pyrifera* in nearshore Monterrey Bay. The results showed that kelp rafts, with little surface, area exposed to the wind were largely driven by a combination of wind and wind waves, however the relative importance of wind and wind waves was not clear. In addition, the tagged kelp trajectories were more consistent with the formation of eddies during winter. Previous studies have identified wind as an important mechanism of dispersal in wind dominated ocean systems. For example, the subAntartic latitudes the West Wind Drift causes continuous unidirectional surface flow and is regarded as an important potential mechanism for dispersal of floating kelp. Other studies have used genetic approaches to determine macroalgae raft trajectory characteristics by inferring source location from genetically similar populations [@nikula2013]. For example, a study by @fraser2011 on the rafting capabilities of *Durvillaea antarctica* used a combination of population genetics and relative age estimate of ‘goosebarnacles’ attached to the raft. The presence of goosebarnacles suggests a long raft time as these species have a slow growth rate; while the genetic analyses showed these species are able to raft up to $\sim$ 390km from their local origin. The authors suggested that wind and water-movement were the primary influences of trajectory, however, this was only inferred from the genetic results and local climatology data [@fraser2011]. 

Other aspects such as buoyancy and drag also play a role in determining the trajectory and rate of transport for surface floating material. However, the past research on macroalgal trajectory has not investigated these factors which have been shown to be important aspects of trajectory for other materials such as icebergs, marine craft and microplastics. The "sail" area of an object floating at sea is the surface area exposed to the wind which results in air form drag, while the area of the object below the surface of the water is exposed to surface currents which result in hydrodynamic form drag. Drag coefficients related to wind and surface current have been shown to be important properties to consider when estimating trajectory and forecasting drift for search and sea rescue operations. Drag is ultimately determined by the size and shape of the object which are properties that vary considerably with macroalgae species. In addition, past research conducted within the maritime industry has shown that the size and shape of a vessel determine the relative importance of waves or wind as drivers of trajectory, as well as orientation of the object. If the length of the object is longer than the significant wave height then waves will be the primary driver of trajectory while the opposite is true for smaller objects where the effect of waves is regarded as negligible [@breivik2011; @griffin2017]. 

To accurately determine the trajectory of marine macroalgae these aspects need to be taken into account. Past research by @allen1999 and @breivik2011 have provided estimates of drag for various objects based on experimental work, which consisted of both direct and indirect methods of the Leeway model. However, this work does not consider biological material such as macroalgae. Although drag estimates do exist, these have been applied for macroalgae not detached from the substratum and are regarded as fixed-point estimates. Although various approaches have been used in the past to investigate floating macroalagae trajectory, very few studies have employed the use of Langrangian trajectory modeling. Furthermore, none of the existing studies using this modeling approach have considered macroalgal morphology cross-sectional area (i.e. shape) as an aspect of drag and ultimately trajectory. Studies by @brooks2019, @putman2018, @putman2020 used lagrangian approaches to investigate the effects of inertia, raft-size, and windage on macroalgae trajectory. @brooks2019 used a custom growth model to estimate changes in biomass and ultimately radial size, while a customised Hybrid Coordinate Ocean Model (HYCOM) for the trajectory simulations was used. The results showed that trajectory of pelagic *Sargussum* was significantly influenced by inertia and the radial size of the rafts. Other work by @putman2020 investigated the effect of including windage in macroalgae trajectory simulations. The authors showed that including ad-hoc windage factors greatly improved accuracy regarding entrainment or expulsion from eddies when compared to tracked sargassum mats in the ocean. Langrangian trajectory modeling is a useful tool, however, the various models available often assume the object to be a spherical particle, which is obviously not the case for both biological and anthropogenic forms of marine debris in nature. The radial size included by @brooks2019 is an improvement, however this approach does not take into account the complex morphology on an individual level into account.

In this study, a numerical approach is used to shed light on the role of hydrodynamic and direct wind drag on macroalgal drift trajectory using lagrangian based trajectory simulations. This will be achieved by comparing the trajectory outputs of virtual 'passive' particles (no drag characteristics added) with kelp particles (drag characteristics added) of varying degrees of hydrodynamic and wind drag exposure. The different degrees of wave and wind exposure are meant to reflect the different buoyancy characteristics, as well as identify the role of magnitude of the drag components on overall trajectory. 

# Methods
## Study site

The region of interest for this study was the Cape Peninsula in the Western Cape (Figure 1A). A release site was chosen for this study, Kommetjie, which is located on the Atlantic side of the Cape Peninsula (Figure 2B). The hydrodynamics in the study region are driven by a complex interaction of wind and waves, which are also influenced by larger oceanic processes. In South Africa, the larger processes can largely be attributed to the Agulhas Current (AC) and the Benguela Current (BC)[@lutjeharms2000;@lutjeharms2007;@garzoli1996;@Hutchings2009;@rubio2009]. The AC is a component of the South-west Indian Ocean sub-gyre, flowing predominantly south-westward following the continental shelf edge and eventually retroflecting eastward back into the South Indian Ocean [@@lutjeharms2000;@lutjeharms2007]. The region where the retroflection occurs is known as the Agulhas retroflection and consists of some of the highest levels of mesoscale variability [@garzoli1996]. The variability results in shedding of rings and filaments known as the Agulhas Rings and have an average diameter of ~324km [@lutjeharms1988; @lutjeharms2006; @lutjeharms2007]. The Agulhas Rings are the main contributors to the Agulhas leakage which are the transport of warm water from the Indian Ocean to the South Atlantic Ocean [@garzoli1996; @lutjeharms2006; @beal2015]. The Agulhas leakage is also a source of meso-scale variability within the Benguela region as anticyclonic rings are shed and drift northwestward along the southern Benguela slope region [@rubio2009]. The Benguela region is characterised by strong coastal upwelling cells which are primarily driven by equatorward winds [@shannon1996; @hardman2003], and is known as the Benguela upwelling region. The Benguela upwelling region starts at 27$^\circ$S and extends southward to 35$^\circ$S [@shannon1996]. The region is also characterised by high amounts of mesoscale variability in the form of eddies and filaments [@blanke2002; @blanke2005; @rubio2009]. The Benguela inshore region is dominated by a northwestward flow as a result of topographical steering, wind stress and interactions with passing Agulhas rings and eddies [@veitch2010]. 

```{r map, echo=FALSE, message=FALSE, warning=FALSE, strip.white=TRUE, fig.cap="Figure 1:Map of the study domain. This is a temporary map until issues with the map script are resolved."}
library(png)
library(grid)
library(gridExtra)

#map_chp3A <- rasterGrob(as.raster(readPNG("map/chp3_mapA.png")))
#map_chp3B <- rasterGrob(as.raster(readPNG("map/chp3_mapB.png")))
#ggarrange(map_chp3A, map_chp3B, ncol = 2, nrow = 1, labels = "AUTO", align = c("h"))
map_chp3_combined <- rasterGrob(as.raster(readPNG("map/chp3_map_combined_hz.png")))
ggarrange(map_chp3_combined)
```

## Particle tracking model

The model is based on parameterisations that have been used for previous studies investigating iceberg, capsized marine vessels and microplastics. It should be noted that most of the previous studies regarding macroalgae trajectory have investigated rafts and not solitary floating individuals. A kelp raft will vary in size and can range from a few meters across to large dense mats the size of a sports field. Furthermore, some authors suggest that most macroalgae become entangled through ocean currents and not through the hydrodynamic forces that dislodge them. In addition, large kelp rafts are not a characteristics around the coast of the Cape Peninsula but rather solitary kelp are (Pers. Obs). Therefore, the trajectory of only solitary *E. maxima* individuals will be considered. Numerical calculations of particle trajectory with a Lagrangian method [@delandmeter2019], and be described by the equation

$$X(t+\Delta t) = X(t) + \int_{t}^{t+\Delta t} v(x, \tau)d \tau + \Delta X_b(t)$$
where $X$ is the three-dimensional position of a particle, $v(x,t)$ is the three-dimensional velocity field at the location in the ocean model at particle point in time, $t$ is time, $X_b(t)$ is a change in position due to 'behavior' of the particle at a particular point in time. This can range from swimming in fish to sinking or beaching. In order to investigate the effects of drag components of trajectory of floating macroalgae, this study incorporated drag as the custom behavior. 

This study simulated two scenarios; one where the plant is fully submerged and only exposed to hydrodynamic drag; and the other where parts of the plants are partially exposed resulting in a combination of hydrodynamic and air form drag. Drag based on shape-based coefficients were used in the calculations for determining the overall kelp velocity vectors. A momentum energy equation was used to calculate the drag forces for the relevant simulation. This approach has been employed in modeling iceberg drift trajectory [@andersson2017; @lichey2001; @eik2009] and was adapted to suit this particular study. The energy momentum equation used to calculate the drag force exerted on the virtual kelp particle was, $$m({d_u/d_t})=F_d + F_a + F_f$$
where $m$ is kelp mass, $d_u$ the virtual kelp particle velocity, $F_d$ the hydrodynamic drag, $F_a$ is the wind drag, $F_f$ the surface-current flow, and $d_t$ is the time step. The assumption made was that the mass of the kelp did not change for each virtual kelp particle over the course of the simulations. Hydrodynamic drag, wind drag and surface current-flow are two-dimensional vector quantities and were calculated for each time step for each simulation. 

## Simulations

Virtual particles were released with no drag or wind effects from the study site in order to act as a reference for comparison to simulations with varying degrees of hydrodynamic and wind drag, and are referred to hereafter as 'passive particles'. All simulations have the same release location and were run for 30 days with hourly outputs using a fourth order Runge-Kutte advection scheme [@North2009; @VanSebille2018]. Brownian motion was also incorporated in order to account for any stochasticity not resolved by the model. These are standard practices for Lagrangian trajectory studies [@North2009;@delandmeter2019; @VanSebille2018]. To test the different magnitudes that hydrodynamic and wind drag might play in the overall trajectory, simulations were run with varying degrees of drag exposure scenarios. These scenarios were meant to act as proxy for buoyancy, which determines the surface area exposed to hydrodynamic and wind drag. These estimates were expressed as percentages which were used to calculate hydrodynamic and wind drag for applicable simulation. For example, if 85% of the plant is submerged and 15% of above water, then the overall hydrodynamic and wind drag forces would be 85% and 15% of the total drag forces respectively. The exposure scenarios used in this study were 100%, 95%, 90%, and 85% for hydrodynamic drag; 0 %, 5%, 10%, and 15% for wind (see table 1).

```{r sim table, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Details for each simulation run for the study"}
set_flextable_defaults(fonts_ignore=TRUE)

sim_table <- read.csv("tables/chapter_3/simulation_table.csv", sep = ";")

sim_table <- flextable(data = sim_table)
sim_table <- theme_zebra(sim_table, odd_header = "transparent", even_header = "transparent")
sim_table <- set_header_labels(sim_table, Cross.sectional.area = "Cross-sectional area", Drag.Exposure = "Drag Exposure level")
sim_table <- align(x= sim_table, align = "center", part = "all")
sim_table <- set_table_properties(sim_table, width = 1, layout = "autofit")
sim_table <- set_caption(sim_table, "Table 1:Details for each simulation executed for the study.")
sim_table
```

In order to determine the influence of cross-sectional area on drag components, simulations were performed for the minimum, mean and maximum cross-sectional areas for Kommetjie kelp forest population (Figure 1). In order to determine the direct effect of wind on trajectory, simulations were run for varying magnitudes of wind exposure for each type of cross-sectional area. The magnitudes of exposure where based on personal observations of drifting *E. maxima* from previous studies and fieldwork. The virtual particles released with the hydrodynamic or wind drag components are referred to as 'kelp particles'.  

## Model inputs
### Ocean and wind model

Both passive and kelp particles were simulated around the South African coastline within hind-cast outputs from the Copernicus Marine Environment Monitoring Service. The Copernicus outputs used in this study contains 3D daily current information from the top layer to the bottom (Global Analysis Forecast PHY_001_024). The model has a spatial resolution of 0.08$^\circ$ and is interpolated on an Arakawa C native grid. 

In order to incorporate the effects of direct wind drag within the simulations, the Copernicus Marine Environment Monitoring Service global wind product was used (WIND_L4_NRT_OBSERVATIONS_012_004). The outputs from the model is composed of 6-hourly averaged fields of surface 10m wind velocity vectors with a spatial resolution of 0.25$^\circ$. Both averaged ocean current and wind data are stored as meridonal and zonal velocity vectors. 

### Hydrodynamic and wind drag

The drag coefficient for a spherical particle was used in the calculation of hydrodynamic drag as the trajectory model assumes the particles are spherical. The drag equation used was: $F_d = 0.5 \rho A_c C_d U^2$, where $\rho$ is the density of seawater or air, $A_c$ is the cross-sectional area exposed to hydrodynamic or wind drag, $C_d$ is the drag coefficient for a spherical particle and $U$ is the surface velocity vector of the flow-/wind- field. Hydrodynamic and wind drag components were calculated separately for both the meridonal and zonal velocity vectors. Since drag force is dependent on the velocity vectors which vary with time, the meridonal and zonal velocities were interpolated and used in the drag force calculation for each time-step. The same approach was used for the wind drag force. The equation that was used to calculate hydrodynamic drag, was also used to calculate wind. 

### Cross-sectional area

In order to incorporate hydrodynamic and wind drag, the cross-sectional area of the kelp was calculated first. Known geometric shapes reflecting the relevant plant sections were used to estimate the surface area for various parts of the plant, for details please refer to figure 2. The dimensional data needed was estimated in cases were data was not available for that particular morphological characteristic. The bulb/pneumatocyst is a highly variable morphological characteristic and in some cases can appear absent, the same is true for the holdfast. Therefore, a standard cross-sectional area was used for both the bulb and holdfast, for all simulations. 

```{r message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, fig.height=4, fig.width=7, fig.cap="Figure 2:Diagram of the *E.maxima* morphological characteristics considered in this study, along with the associated geometric shapes used to calculate the overall surface area of each morphological characteristic."}

kelp_shape_figure <- rasterGrob(as.raster(readPNG("figures/chapter_3/chp3_shapedrawing.png")))
ggarrange(kelp_shape_figure)

```

The cross-sectional area calculated was site specific and the dimensions needed were garnered from morphology data from a previous study [@coppin2020]. The minimum, mean and maximum were calculated for each morphological characteristic, which were used for calculating the overall minimum, mean and maximum cross-sectional areas needed to run the various simulations (see table 1). The trajectory of these "types" of cross-sectional areas (minimum, mean and maximum overall cross-sectional area) were used to determine the influence of drag, both hydrodynamic and wind, on overall trajectory. 

```{r morphology wrangling, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
# Investigate morphology data to assist in estimating surface area

# Read in morphology data
eck_df <- read.csv("data/morph_data/eck_morph_data.csv", sep = ";") %>%
  filter(site!= "Rocky Bank") %>%   # Not using Rocky Bank in this study
  filter(site!= "De Hoop") 
eck_df$site <- as.character(eck_df$site)
eck_df <- eck_df %>% 
  filter(population == "Deep") 
eck_long_df <- gather(eck_df, Morphology, measurement, frond_mass:total_length, factor_key=TRUE)
# Summary stats to make it easier to refer to later, these will not be used any analysis.
site_list <- c("Kommetjie")
eck_stats <- eck_long_df %>% 
  group_by(site, Morphology) %>% 
  summarise(mean = mean(measurement, na.rm = T),
            minimum = min(measurement, na.rm = T),
            maximum = max(measurement, na.rm = T)) %>% 
  ungroup() %>% 
  filter(site %in% site_list) %>% 
  rename(Site = site) %>% 
  rename(Mean = mean) %>% 
  rename(Minimum = minimum) %>% 
  rename(Maximum = maximum)

#eck_stats <- flextable(data = eck_stats)
#eck_stats <- theme_zebra(eck_stats, odd_header = "transparent", even_header = "transparent")
#eck_stats <- align(x= eck_stats, align = "center", part = "all")
#eck_stats <- set_table_properties(eck_stats, width = 1, layout = "autofit")

```

```{r morphology table, message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, fig.cap="Table summarising the atrributes and estimates used to calculate the overall surface area of Kommetjie kelp individuals used in the various simulation."}

set_flextable_defaults(fonts_ignore=TRUE)

area_table <- read.csv("tables/chapter_3/area_table.csv", sep = ";")
area_table <- flextable(data = area_table)
area_table <- theme_zebra(area_table, odd_header = "transparent", even_header = "transparent")
area_table <- align(x= area_table, align = "center", part = "all")
area_table <- set_header_labels(area_table, Plant.characteristic = "Plant characteristic", Approximate.shape = "Approximate shape", Equation.used = "Equation Used", Plant.dimensions = "Plant dimensions")
area_table <- set_header_labels(area_table, Ac.Minimum = "Ac Minimum", Ac.Mean = "Ac Mean", Ac.Maximum = "Ac Maximum")
area_table <- set_table_properties(area_table, width = 1, layout = "autofit")
area_table <- set_caption(area_table, "Table 2:Summary of the atrributes and estimates used to calculate the overall surface area of Kommetjie kelp individuals used in the various simulation.")
area_table
```
## Analysis

In order to compare trajectories between cross-sectional area types and wind exposure scenarios, mean trajectories were calculated and density distribution maps were produced. Density distribution maps are an effective method for assessing pathways and ocean connectivity [@vanSebille2018]. In addition, mean trajectory was calculated and included in the density distribution maps to further aid in comparing simulation outputs. The distance that particles traveled was also measured and used to produce boxplots. Distance traveled from the release site can help reveal topographic steering and momentum energy transfer from the wind field to kelp particle [@VanSebille2018]. If the wind direction is in the same direction as the current the virtual particles will cover larger distances due to an increase in the velocity as a result of momentum energy transfer [@putman2020; @putman2018; @vanSebille2018]. 

# Results

```{r data wrangling, message=FALSE, warning=FALSE, include=FALSE}

# Read in simulation data and data wrangling

p_RK4 <- tidync("OceanParcels/trajectory_data/RK4_PFloat.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00")) 
p_RK4_mean <- p_RK4 %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

p_RK4$type <- "RK4" # add extra column 'type' to dataframe and assigned 'RK4' label

Min_Kfloat_H100_W00 <- tidync("OceanParcels/trajectory_data/Min_KFloat_H100_W00.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Min_Kfloat_H100_W00_mean <- Min_Kfloat_H100_W00 %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Min_Kfloat_H100_W00$type <- "Min_Kfloat_H100_W00" # add extra column 'type' to dataframe and assigned 'kelp' label
Min_Kfloat_H100_W00$velocity <- with(Min_Kfloat_H100_W00, sqrt(kelpvelU^2 + kelpvelV^2))

Min_Kfloat_H095_W05 <- tidync("OceanParcels/trajectory_data/Min_KFloat_H095_W05.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Min_Kfloat_H095_W05_mean <- Min_Kfloat_H095_W05 %>% # calculate mean trajectory
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Min_Kfloat_H095_W05$type <- "Min_Kfloat_H095_W05" # add extra column 'type' to dataframe and assigned 'kelp' label
Min_Kfloat_H095_W05$velocity <- with(Min_Kfloat_H095_W05, sqrt(kelpvelU^2 + kelpvelV^2))

Min_Kfloat_H090_W10 <- tidync("OceanParcels/trajectory_data/Min_KFloat_H090_W10.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Min_Kfloat_H090_W10_mean <- Min_Kfloat_H090_W10 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Min_Kfloat_H090_W10$type <- "Min_Kfloat_H090_W10" # add extra column 'type' to dataframe and assigned 'kelp' label
Min_Kfloat_H090_W10$velocity <- with(Min_Kfloat_H090_W10, sqrt(kelpvelU^2 + kelpvelV^2))

Min_Kfloat_H085_W15 <- tidync("OceanParcels/trajectory_data/Min_KFloat_H085_W15.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Min_Kfloat_H085_W15_mean <- Min_Kfloat_H085_W15 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Min_Kfloat_H085_W15$type <- "Min_Kfloat_H085_W15" # add extra column 'type' to dataframe and assigned 'kelp' label
Min_Kfloat_H085_W15$velocity <- with(Min_Kfloat_H085_W15, sqrt(kelpvelU^2 + kelpvelV^2))

Mean_Kfloat_H100_W00 <- tidync("OceanParcels/trajectory_data/Mean_KFloat_H100_W00.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Mean_Kfloat_H100_W00_mean <- Mean_Kfloat_H100_W00 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Mean_Kfloat_H100_W00$type <- "Mean_Kfloat_H100_W00" # add extra column 'type' to dataframe and assigned 'kelp' label
Mean_Kfloat_H100_W00$velocity <- with(Mean_Kfloat_H100_W00, sqrt(kelpvelU^2 + kelpvelV^2))

Mean_KFloat_H095_W05 <- tidync("OceanParcels/trajectory_data/Mean_KFloat_H095_W05.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Mean_KFloat_H095_W05_mean <- Mean_KFloat_H095_W05 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Mean_KFloat_H095_W05$type <- "Mean_KFloat_H095_W05" # add extra column 'type' to dataframe and assigned 'kelp' label
Mean_KFloat_H095_W05$velocity <- with(Mean_KFloat_H095_W05, sqrt(kelpvelU^2 + kelpvelV^2))

Mean_KFloat_H090_W10 <- tidync("OceanParcels/trajectory_data/Mean_KFloat_H090_W10.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Mean_KFloat_H090_W10_mean <- Mean_KFloat_H090_W10 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Mean_KFloat_H090_W10$type <- "Mean_KFloat_H090_W10" # add extra column 'type' to dataframe and assigned 'kelp' label
Mean_KFloat_H090_W10$velocity <- with(Mean_KFloat_H090_W10, sqrt(kelpvelU^2 + kelpvelV^2))

Mean_KFloat_H085_W15 <- tidync("OceanParcels/trajectory_data/Mean_KFloat_H085_W15.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Mean_KFloat_H085_W15_mean <- Mean_KFloat_H085_W15 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE)) 

Mean_KFloat_H085_W15$type <- "Mean_KFloat_H085_W15" # add extra column 'type' to dataframe and assigned 'kelp' label
Mean_KFloat_H085_W15$velocity <- with(Mean_KFloat_H085_W15, sqrt(kelpvelU^2 + kelpvelV^2))

Max_Kfloat_H100_W00 <- tidync("OceanParcels/trajectory_data/Max_KFloat_H100_W00.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Max_Kfloat_H100_W00_mean <- Max_Kfloat_H100_W00 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Max_Kfloat_H100_W00$type <- "Max_KFloat_H100_W00" # add extra column 'type' to dataframe and assigned 'kelp' label
Max_Kfloat_H100_W00$velocity <- with(Max_Kfloat_H100_W00, sqrt(kelpvelU^2 + kelpvelV^2))

Max_Kfloat_H095_W05 <- tidync("OceanParcels/trajectory_data/Max_KFloat_H095_W05.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Max_Kfloat_H095_W05_mean <- Max_Kfloat_H095_W05 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Max_Kfloat_H095_W05$type <- "Max_KFloat_H095_W05" # add extra column 'type' to dataframe and assigned 'kelp' label
Max_Kfloat_H095_W05$velocity <- with(Max_Kfloat_H095_W05, sqrt(kelpvelU^2 + kelpvelV^2))

Max_Kfloat_H090_W10 <- tidync("OceanParcels/trajectory_data/Max_KFloat_H090_W10.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Max_Kfloat_H090_W10_mean <- Max_Kfloat_H090_W10 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Max_Kfloat_H090_W10$type <- "Max_KFloat_H090_W10" # add extra column 'type' to dataframe and assigned 'kelp' label
Max_Kfloat_H090_W10$velocity <- with(Max_Kfloat_H090_W10, sqrt(kelpvelU^2 + kelpvelV^2))

Max_Kfloat_H085_W15 <- tidync("OceanParcels/trajectory_data/Max_KFloat_H085_W15.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
Max_Kfloat_H085_W15_mean <- Max_Kfloat_H085_W15 %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

Max_Kfloat_H085_W15$type <- "Max_KFloat_H085_W15" # add extra column 'type' to dataframe and assigned 'kelp' label
Max_Kfloat_H085_W15$velocity <- with(Max_Kfloat_H085_W15, sqrt(kelpvelU^2 + kelpvelV^2))

total_data <- rbind(Min_Kfloat_H100_W00 , Min_Kfloat_H095_W05, Min_Kfloat_H090_W10, Min_Kfloat_H085_W15, Mean_Kfloat_H100_W00, Mean_KFloat_H095_W05, Mean_KFloat_H090_W10, Mean_KFloat_H085_W15, Max_Kfloat_H100_W00, Max_Kfloat_H095_W05, Max_Kfloat_H090_W10, Max_Kfloat_H085_W15)

```

## Trajectory comparison

The mean trajectories of the different cross-sectional areas are similar to the mean trajectory of the passive particles (Figure 2A). When comparing mean trajectories between the different cross-sectional areas for the 100% hydrodynamic drag simulations, no differences can be seen with only slight variation. The results from the simulations including different hydrodynamic and wind drag exposures and cross-sectional area types show differences in mean trajectory when compared to the passive simulation (Figure 2B). The end points of the simulations including hydrodynamic and wind drag were different compared to the passive simulations, as well as being further from the release site. When comparing the different hydrodynamic and wind drag simulations to each other, only slight variation in mean trajectories was evident. In all simulations particles flowed in a north-westward direction. 

```{r meantraj, message=FALSE, warning=FALSE, include=FALSE, echo = FALSE}

waterdrag_plot <- ggplot()+
  geom_path(data = p_RK4_mean, aes(x = lon, y = lat), color = 'black')+
  geom_path(data = Mean_Kfloat_H100_W00_mean, aes(x = lon, y = lat), color = 'blue')+
  geom_path(data = Mean_Kfloat_H100_W00_mean, aes(x = lon, y = lat), color = 'orange')+
  geom_path(data = Max_Kfloat_H100_W00_mean, aes(x = lon, y = lat), color = 'red')+
  xlab("Longtitude") + 
  ylab("Latitude") + 
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_bw() 

wwdrag_plot <- ggplot()+
  geom_path(data = p_RK4_mean, aes(x = lon, y = lat), color = 'black')+
  geom_path(data = Min_Kfloat_H095_W05_mean, aes(x = lon, y = lat), color = 'grey')+
  geom_path(data = Min_Kfloat_H090_W10_mean, aes(x = lon, y = lat), color = 'green')+
  geom_path(data = Min_Kfloat_H085_W15_mean, aes(x = lon, y = lat), color = 'pink')+
  geom_path(data = Mean_KFloat_H095_W05_mean, aes(x = lon, y = lat), color = 'yellow')+
  geom_path(data = Mean_KFloat_H090_W10_mean, aes(x = lon, y = lat), color = 'orange')+
  geom_path(data = Mean_KFloat_H085_W15_mean, aes(x = lon, y = lat), color = 'red')+
  geom_path(data = Max_Kfloat_H095_W05_mean, aes(x = lon, y = lat), color = 'blue')+
  geom_path(data = Max_Kfloat_H090_W10_mean, aes(x = lon, y = lat), color = 'orange')+
  geom_path(data = Max_Kfloat_H085_W15_mean, aes(x = lon, y = lat), color = 'red')+
  xlab("Longtitude") + 
  ylab("Latitude") + 
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_bw() 

```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=6, fig.cap="Figure 2: Comparison of mean trajectories. Plot A is the comparison of mean trajectories for only hydrodynamic drag and plot B is the comparison of mean trajectories for simulations with varying degrees of hydrodynamic and wind drag. In plot A, the black line represents simulation 1, the blue line 2, the orange line 6 and the red line 10. In plot B, the black line represents simulation 1, the grey line simulation 3, the green 4, the pink 5, the yellow 7, orange 8, red 9, blue 11, bronze 12, and cherry 13."}
ggarrange(waterdrag_plot, wwdrag_plot, labels = "AUTO")
```

## Comparison of density distributions

Across all simulations particles flowed in a north-westward direction (Figure 3). The density plots for simulations that considered any form of drag showed a higher density of particles along the mean trajectory path compared to the passive simulation which has an almost even density of particles across grids (Figure 3A, 3E, 3I). In addition the density plots show that the particles in simulations that considered any form of drag got entrained in a vorticy while particles in the passive simulation deflected away (Figure 3). Comparison of cross-sectional areas and different drag exposure scenarios show no differences in mean trajectory and spatial patterns in density, with only slight variations across types. 

```{r density plots, message=FALSE, warning=FALSE, echo=FALSE}
## Heatmaps of study domain, use previous data for study site map and histograms

## Coastline of Southern Africa
load("map/south_africa_coast_hi_res.Rdata")

heatmap_RK4 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_RK4, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = p_RK4, bins = 80, aes(x = lon, y = lat), legend = FALSE) +  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = p_RK4_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  ggtitle("1") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Min_Kfloat_H100_W00 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_EE, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Min_Kfloat_H100_W00, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",        limits = c(1, 13000)) +
  geom_path(data = Min_Kfloat_H100_W00_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  #ggtitle("H100W100") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Min_Kfloat_H095_W05 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_EE, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Min_Kfloat_H095_W05, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",        limits = c(1, 13000)) +
  geom_path(data = Min_Kfloat_H095_W05_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  #ggtitle("H095W05") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Min_Kfloat_H090_W10 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_EE, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Min_Kfloat_H090_W10, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",        limits = c(1, 13000)) +
  geom_path(data = Min_Kfloat_H090_W10_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  #ggtitle("H090W10") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Min_Kfloat_H085_W15 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_EE, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Min_Kfloat_H085_W15, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",        limits = c(1, 13000)) +
  geom_path(data = Min_Kfloat_H085_W15_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  #ggtitle("H085W15") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Mean_Kfloat_H100_W00 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = p_EE, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Mean_Kfloat_H100_W00, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",       limits = c(1, 13000)) +
  geom_path(data = Mean_Kfloat_H100_W00_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Mean_KFloat_H095_W05 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app1, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Mean_KFloat_H095_W05, bins = 80, aes(x = lon, y = lat)) +  scale_fill_continuous(type = "gradient",       limits = c(1, 13000)) +
  geom_path(data = Mean_KFloat_H095_W05_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Mean_KFloat_H090_W10 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Mean_KFloat_H090_W10, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Mean_KFloat_H090_W10_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Mean_KFloat_H085_W15 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Mean_KFloat_H085_W15, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Mean_KFloat_H085_W15_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Max_KFloat_H100_W00 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Max_Kfloat_H100_W00, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Max_Kfloat_H100_W00_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Max_KFloat_H095_W05 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Max_Kfloat_H095_W05, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Max_Kfloat_H095_W05_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Max_KFloat_H090_W10 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Max_Kfloat_H090_W10, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Max_Kfloat_H090_W10_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))


heatmap_Max_KFloat_H085_W15 <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = Max_Kfloat_H085_W15, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = Max_Kfloat_H085_W15_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap='Figure 3: Comparison of density of particles within each grid cell for the end run time of each scenario. Plots A-D represents the minimum, plots E-H are the mean and plots I-L the maximum cross-sectional areas. The bottom plot is the density plot for the passive simulation.', fig.height=10.2, fig.width=7.5}

figure_a <- ggarrange(heatmap_Min_Kfloat_H100_W00, heatmap_Min_Kfloat_H095_W05,heatmap_Min_Kfloat_H090_W10,heatmap_Min_Kfloat_H085_W15, heatmap_Mean_Kfloat_H100_W00, heatmap_Mean_KFloat_H095_W05, heatmap_Mean_KFloat_H090_W10, heatmap_Mean_KFloat_H085_W15, heatmap_Max_KFloat_H100_W00,heatmap_Max_KFloat_H095_W05, heatmap_Max_KFloat_H090_W10, heatmap_Max_KFloat_H085_W15, labels = c("2","3","4","5","6","7","8","9","10","11","12","13"), common.legend = TRUE, legend = c("none"))

figure_b <- ggarrange(heatmap_RK4, legend = c("right"))

ggarrange(figure_a, figure_b, ncol = 1, nrow = 2)

```

## Comparison of distances 

There were significant differences among the median distances travelled for all particles in each simulation (Figure 4; p < 0.05). The simulations that considered for 100% hydrodynamic drag travelled less distance than particles for simulations which considered a combination of hydrodynamic and wind drag scenarios. Comparison between simulations that considered hydrodynamic and wind drag show no significant differences with only slight variations among simulations. 

```{r distance plot processing, message=FALSE, warning=FALSE, include=FALSE, fig.height=3, fig.width=4}

pos <- c("RK4",
         "Min_Kfloat_H100_W00",
         "Min_Kfloat_H095_W05",
         "Min_Kfloat_H090_W10",
         "Min_Kfloat_H085_W15",
         "Mean_Kfloat_H100_W00",
         "Mean_Kfloat_H095_W05",
         "Mean_Kfloat_H090_W10",
         "Mean_Kfloat_H085_W15",
         "Max_Kfloat_H100_W00",
         "Max_Kfloat_H095_W05",
         "Max_Kfloat_H090_W10",
         "Max_Kfloat_H085_W15")

dis_plot <- ggplot(data = total_data, aes(x = type, y = distance, show.legend = FALSE))+
  geom_boxplot(notch = TRUE, notchwidth = 1, show.legend = FALSE, stat = "boxplot") +
  #scale_x_discrete(limits = pos)+
  stat_compare_means(method = "kruskal.test", label = "p.signif")+
  theme_bw()+
  ylab("Distance (km)")+
  xlab("Type")+
  #coord_flip() +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

custom_labs <- c("1","2", "3", "4", "5", "7", "8", "9", "10", "11", "12", "13") #create custom labels and add them to dis_plot

dis_plot <- dis_plot +
  scale_x_discrete(labels= custom_labs)
  

```

```{r distance plot, message=FALSE, warning=FALSE, echo = FALSE, fig.cap="Figure 4: Boxplots of total distance of all particles from the release site over the course of the simulation for each exposure scenario."}
dis_plot
```

## Comparison of coefficents

The comparison of mean trajectories between the sphere and cylindrical shape coefficients revealed no dissimilarity (Figure 5A). This was also reflected when comparing distance travelled by particles and particle density plots (Figure 5B). The simulation which used a cylindrical shape coefficient showed higher density in an eddy compared to the simulation which used a sphere for the shape coefficient (Figure 5C-D). 

```{r shape data, message=FALSE, echo=FALSE, warning=FALSE}

sphere <- tidync("OceanParcels/trajectory_data/Max_KFloat_H100_W00.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
sphere_mean <- sphere %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

sphere$type <- "Sphere" # add extra column 'type' to dataframe and assigned 'kelp' label
sphere_mean$type <- "Sphere" # add extra column 'type' to dataframe and assigned 'kelp' label

# read in data again for one max simulation, as cannot sort issue out with rename df...
cyl <- tidync("OceanParcels/trajectory_data/Max_ShapeFloat_H100_W00.nc") %>%
  hyper_tibble() %>%
  dplyr::select(trajectory, lon, lat, time, distance, kelpvelU, kelpvelV) %>%
  dplyr::rename(t = time) %>%
  mutate(t = as.POSIXct(t, origin = "2018-01-01 00:00:00"))
cyl_mean <- cyl %>% #calculate mean trajectory 
  group_by(t) %>% 
  summarise(across(lon:lat, mean, na.rm= TRUE))

cyl$type <- "Cylinder" # add extra column 'type' to dataframe and assigned 'kelp' label
cyl_mean$type <- "Cylinder" # add extra column 'type' to dataframe and assigned 'kelp' label


# Make mean trajectory plot
shape_plot <- ggplot()+
  geom_path(data = p_RK4_mean, aes(x = lon, y = lat), color = 'black')+
  geom_path(data = sphere_mean, aes(x = lon, y = lat), color = 'blue')+
  geom_path(data = cyl_mean, aes(x = lon, y = lat), color = 'orange')+
  xlab("Longtitude") + 
  ylab("Latitude") +
  ggtitle("Mean trajectory comparison") +
  #guides(fill=guide_legend(title="Number of particles")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

# make density map
heatmap_sphere <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = sphere, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = sphere_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  guides(fill=guide_legend(title="Number of particles")) +
  ggtitle("Cylinder") + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

heatmap_cyl <- ggplot() +
  geom_polygon(data = south_africa_coast_hi_res, aes(x = lon, y = lat, group = PID),
               size = 1.0, colour = "black", fill = NA) +
  #geom_bin2d(data = k_app2, bins = 80, aes(x = lon, y = lat)) +
  geom_hex(data = cyl, bins = 80, aes(x = lon, y = lat)) +
  scale_fill_continuous(type = "gradient", limits = c(1, 13000)) +
  geom_path(data = cyl_mean,aes(x = lon, y = lat, color = 'red'), show.legend = FALSE) +
  coord_cartesian(xlim = c(14, 20), ylim = c(-35, -30)) + 
  xlab("Longtitude") + 
  ylab("Latitude") + 
  ggtitle("Sphere") +
  guides(fill=guide_legend(title="Number of particles")) +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

shape_data_total <- rbind(sphere, cyl)

shape_dis_plot <- ggplot(data = shape_data_total, aes(x = type, y = distance, show.legend = FALSE))+
  geom_boxplot(notch = TRUE, notchwidth = 1, show.legend = FALSE, stat = "boxplot") +
  #scale_x_discrete(limits = pos)+
  stat_compare_means(method = "kruskal.test", label = "p.signif")+
  ylab("Distance (km)")+
  xlab("Type") + 
  ggtitle("Comparison of distance travelled") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

```

```{r shape data outputs, warning=FALSE, echo=FALSE, message=FALSE, fig.cap="Figure 5: Comparison of trajectory data between a kelp sphere and kelp cylinder. Plot A is the comparison of mean trajectories, plot B is the comparison of distance travelled by all particles, and plot C and D are the density plots for simulations using a sphere and cylinderical shape coefficient.", fig.height=8, fig.width=8}

ggarrange(shape_plot, shape_dis_plot, heatmap_sphere, heatmap_cyl, labels = c("AUTO"), common.legend = TRUE, legend = c("bottom"), ncol = 2, nrow = 2)

```

# Discussion

The treatment of drifting macroalgae as purely lagrangian will not be able to accurately determine patterns of passive dispersal, such as entrainment in eddies or vortices [@fossette2012; @miron2020]. Although past research has shown the inclusion of inertia and windage greatly increase observed macroalgae trajectory and entrainment characteristics [@putman2018; @brooks2018;@brooks2019; @putman2020], current research has focused on large macroalgae-rafts which can vary greatly in size and surface area. None of the past research has taken advantage of the advancement in numerical ocean models and lagrangian trajectory modeling to investigate how aspects of drag (hydrodynamic and wind) affect the trajectory patterns of solitary drifting macroalgae. This study compared particles trajectories with simulations that included no forms of drag with simulations that included various forms of both hydrodynamic and wind drag. The mean virtual kelp trajectory deviated from the mean passive  trajectory when including varying levels of hydrodynamic and wind drag scenarios. The results from this study show the inclusion of hydrodynamic and wind drag improves entrainment patterns, and also our understanding of how surface area plays a role in solitary drifting macroalgae trajectory, in this case *E.maxima*.

Past research has inferred from direct and indirect techniques that drifting macroalgae tend to follow the prevailing surface currents [@thiel2005; @hobday2000; @fraser2011; @rothausler2011; @rothausler2011]. The results from this numerical experiment confirm that drifting macroalgae do follow the surface current in the study region when considering only hydrodynamic drag. In addition, not only are the trajectories similar but so are the end points at the end of simulation. However, when ad-hoc wind drag (windage) is considered in combination with hydrodynamic drag the trajectories differ greatly when compared to purely lagrangian particle trajectories. The inclusion of wind drag causes the particles to flow further away from the coast and with a greater distance travelled from the release location. The difference in trajectory and distance covered can be attributed to the inclusion of wind drag. Wind drag adds to the effects of hydrodynamic drag when the wind direction and current direction are opposite to each other. However, when the wind direction is in the same or similar direction to that of the current, momentum energy from the wind is transferred to the object [@hackett2006; @putman2020]. This causes the particles to travel further as well as exposed to different time varying flows. Past studies have shown this when including windage as a function of inertia [@putman2018;@brooks2019; @putman2020]. A study by @putman2020 used ad-hoc windage factors that was based on the surface current velocity to assess the approach for improving transport predictions of pelagic Sargassum. The results showed that including ad-hoc windage factors improved virtual trajectories compared to tracked Sargassum mats which was partly due to the inclusion of momemtum energy transfer from wind. This is also reflected in the analysis comparing distances travelled by all the particles in each simulation. The particles in the simulations that included wind drag traveled significantly greater distances compared to the passive or hydrodynamic only drag. 

The addition of drag forces into the simulation also causes the particles to cluster together along the mean trajectory compared to that of the passive particles which are more evenly dispersed. This is most likely due to the shared drag characteristics among the particles which included the plants weight and surface area into the calculation. Other studies investigating flotsam trajectory characteristics have found similar results [@breivik2011; @olascoaga2020; @miron2020]. A study by @miron2020 conducted field experiments using a range of objects such as spheres, cubes, cuboids to compare to investigate the effect of inertia on particles dynamics. The results from the study showed that objects tended to cluster according to the shape of the object which the authors attributed to shared characteristics of inertia. Although drag forces were used in this study and not inertia, the same conclusion applies, drag is an important characteristic to consider when investigating or predicting solitary drifting macroalgae. 

The ocean is made up of varying time-varying flows and changes in an objects velocity can cause the object to be exposed to different flow patterns over time. The lack of dissimilarity between different cross-sectional area types (minimum, mean and maximum) suggests that reduction in velocity in relation to cross-sectional area is negligible. A similar result was found by @gouvello2020 who investigated the effects of swimming behavior on sea turtle hatchling dispersal in the Agulhas region. The results suggested that the hatchlings trajectories are mostly influenced by the ocean currents in the first year of hatching due to low swimming speeds of juveniles. Therefore, the differences in cross-sectional area types may not be significant enough in order to have a significant effect on the relevant velocity vectors (zonal and meridonal). Another possible reason is the resolution of the ocean model used. The resolution of the underlying ocean model is an important aspect of lagrangian ocean modeling and must be able to resolve sub-grid scale ocean processes for finer scale applications. A study by @hart2018 assessed the inclusion of stochastic motion, wind and currents into forecasting for search and rescue using the same model ocean model used in this study. The authors found that the inclusion of brownian motion greatly increased the accuracy in representing sub-grid scale processes and that the inclusion of wind, currents and stochastic motion greatly improved forecasting applications. Therefore, the authors argue that the lack of dissimilarity between simulations of different cross-sectional area and drag exposure scenarios is not as a result of the resolution of the model. 

The same is also true when comparing different hydrodynamic and wind drag exposure scenarios. These scenarios reflect different buoyancy situations which result in different amounts of surface area exposed to hydrodynamic and/or wind drag. The similarities between the different combined drag scenarios suggests that higher magnitudes of wind exposure do not significantly alter trajectories. Instead, the results from this study suggest that the inclusion of drag forces in simulating macroalgal trajectory may result in improving accuracy of entrainment patterns. All the simulations that included any form of drag resulted in a fairly high density of particles entrained in a vortex. The entrainment and expulsion from eddies and vortices is an important characteristic of floating macroalgae. Accuracy in predicting entrainment and expulsion of macroalgae-rafts from eddies has been investigated previously by @putman2018 and @putman2020, who show that including windage greatly improves entrainment patterns when comparing virtual and real Sargassum rafts. However, the aforementioned studies investigated large rafts and not floating individuals. Inertia is based on the size/weight of the raft, while hydrodynamic and wind drag are based on current velocity and surface area. Therefore, the role of inertia may be negligible for a solitary individual and rather other forms of drag should be considered. The results from this study suggest that the inclusion of hydrodynamic and/or wind drag is an important component when simulating virtual kelp particles will greatly increase the accuracy of entrainment and expulsion from sub-grid mesoscale oceanographic features, such as eddies and vortices. The use of a cylindrical shape coefficient instead of a sphere in the calculation of drag force also had no effect on the mean trajectory. Instead, the inclusion of a different shape coefficient increased to the density of particles entrained in an eddy field. This suggest that inclusion of different shape coefficients play a role in further improving estimates and hindcasts of macroalgal dispersal patterns.

# Conclusion

Most of the past research has focused on large macroalgae rafts which can vary greatly in size and shape, however no research exists attempting to clarify the drifting characteristics of solitary macroalgae. Understanding how to accurately model the distribution of solitary kelp can lead to be understanding of accumulation zones and sinks and ultimately the ecological links pertaining to those processes. The findings from this study indicate that solitary floating virtual *E. maxima* particles tend to follow the prevailing surface currents and the inclusion of wind causes the trajectories to differ greatly from that of a purely lagrangian particle. Furthermore, the inclusion of both hydrodynamic and wind drag cause clustering of particles along the trajectory as well causing particles to become entrained in eddies. Different cross-sectional areas exposed to hydrodynamic and wind drag had no effect on overall trajectory suggesting that those differences are negligible when investigating dispersal patterns of drifting *E.maxima*. In addition, the use of a cylindrical shape coefficient has no effect on mean trajectory but also causes higher density of particles to become entrained in an eddy. Overall the inclusion of drag forces is an important aspect to consider when investigating the dispersal patterns of solitary macroalgae, while differences in cross-sectional areas are not. This study also provides an approach which can be adapted to model any floating solitary macroalgae, provided the surface area can be estimated accurately. Gaps in the research exist when considering what oceanographic processes play a role in solitary macroalgal dispersal as well as how these vary seasonally. The identification of biological and physical factors that play a role in accumulation zones is also needed, as well as better estimates for sinking rates and raft-times. 

# Appendix

## Domain features

```{r, message=FALSE, warning = FALSE, include= TRUE, echo = FALSE, fig.height=8, fig.width=8}

library(jpeg)
library(grid)
library(gridExtra)

vector_2 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day2.jpg")))
vector_5 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day5.jpg")))
vector_10 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day10.jpg")))
vector_15 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day15.jpg")))
vector_20 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day20.jpg")))
vector_25 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day25.jpg")))
vector_30 <- rasterGrob(as.raster(readJPEG("OceanParcels/trajectory_data/vector_outputs/jpeg/vector_day30.jpg")))

ggarrange(vector_2, vector_5, vector_10, vector_15, vector_20, vector_25, vector_30, labels = "AUTO")
```


# References

